.subckt customFIR IN OUT 0.1 0.2 0.3 0.4 GROUND params: ;default parameters
+ sigma=0.5 nT=0 a0=0.2 a1=0.4 a2=0.3 a3=53m a4=-3m
+ Win=1 Func=1 sim=1 SH=1 Norm=1
+ f0=5k fp1=500 fs1=400 fp2=2k fs2=2.5k
+ G=1 As=60 N=33
+ tr=1m/absf0 td=0 ref=0.5
*** preliminary calculations
.param BWp=if(fp2==0,fp1,fp2-fp1) BWs=if(fp2==0,fs1,fs2-fs1) fc=if(fp2==0,0,(fp1+fp2)/2)
+ wtw1=2*pi*abs(BWs-BWp)/(1+u(fc))/absf0 Type=1+mod(M,2)+2*(Func>4)
+ wc1=pi*abs(4*fc-(BWs+BWp))/(1+u(fc))/absf0 wc2=if( fc==0, 0, 2*pi*(fc+(BWs+BWp)/4)/absf0 )
+ M=N-1 case=1
*** topology functions and constants
.func mod(x,y) {x-int(x/y)*y}
.func Gh_out(x) {(mod(x,sqrtM)+1.2)*(x<=M)}
.func Gh_in_row(x) {if(x<sqrtM,667,if(x==M,floorM,mod(int(x/sqrtM),ceilM)))*(x<=M)}
.func Gh_in(x) {if(x==M,floorM,mod(int(x/sqrtM),ceilM))*(x<=M)}
.func Tz_IO(x,y) {x*(y<=floorM)}
.func Tx_IO(x,y) {x*(sqrtM==1|sqrtM>=y)}
.func Gx_out(x) {1.1*(sqrtM>=x)}
.func Gx_in(x,y) {x*(sqrtM>=y)}
.param sqrtM=ceil(M**0.5) absf0=abs(f0) floorM=int(M/sqrtM) ceilM=ceil(M/sqrtM) tz1=sqrtM/absf0 tz2=1/absf0
*** coefficients, h[n]
.func hn(x) {table(x,0,1,1,0.15625418909331,2,1.931287552511987,3,0.35276317269117,
+ 4,2.831977424010354,5,0.57150543441384,6,3.713157241392879,
+ 7,0.80555794042662,8,4.579911837887784,9,1.051382392786302,
+ 10,5.435075105037407,11,1.306891602744754,12,6.280406043306775,
+ 13,1.570745149893394,14,7.117071603501314,15,1.8420337948921,
+ 16,7.945880213634465,17,2.120117760898214,18,8.767408033241634,
+ 19,2.40453560196738,20,9.58207298079302,21,2.694949052261723,
+ 22,10.39018091288203,23,2.991107729406297,24,11.1919558777079,
+ 25,3.292825491307478,26,11.98756073975333,27,3.599963977868674,
+ 28,12.77711171245939,29,3.912420761154619,30,13.56068888814943,
+ 31,4.230120545937423,32,14.3383440523816,33,4.55300843813426,
+ 34,15.11010660446335,35,4.881044637069453,36,15.8759881248457,
+ 37,5.214200112547587,38,16.63598595446048,39,5.552452954208896,
+ 40,17.39008603776435,41,5.895785158458674,42,18.13826520593599,
+ 43,6.244179663944895,44,18.88049302496987,45,6.597617468919338,
+ 46,19.61673329646618,47,6.95607466670602,48,20.34694527093528,
+ 49,7.319519218883162,50,21.07108461019798,51,7.687907245636023,
+ 52,21.78910411330834,53,8.061178539660041,54,22.50095419526122,
+ 55,8.43925088590463,56,23.20658307373962,57,8.822012560647174,
+ 58,23.90593656638977,59,9.209312026084195,60,24.59895731081175,
+ 61,9.600943205657866,62,25.28558305333095,63,9.996623562861486,
+ 64,25.96574332734412,65,10.39595994837255,66,26.6393531634657,
+ 67,10.79839250090847,68,27.30630095229966,69,11.20309637787808,
+ 70,27.96642385728174,71,11.60879496228316,72,28.61945398728483,
+ 73,12.01336395943754,74,29.26488618674687,75,12.41285232337886,
+ 76,29.90159131911249,77,12.79840637858697,78,30.52630234787528,
+ 79,13.14131514232937,80,31.12268197336483,81,13.14131514232938,
+ 82,30.52630234787527,83,12.79840637858698,84,29.90159131911249,
+ 85,12.41285232337887,86,29.26488618674687,87,12.01336395943755,
+ 88,28.61945398728484,89,11.60879496228317,90,27.96642385728174,
+ 91,11.2030963778781,92,27.30630095229965,93,10.79839250090849,
+ 94,26.6393531634657,95,10.39595994837257,96,25.96574332734411,
+ 97,9.996623562861508,98,25.28558305333096,99,9.600943205657888,
+ 100,24.59895731081175,101,9.20931202608422,102,23.90593656638977,
+ 103,8.822012560647202,104,23.20658307373961,105,8.439250885904668,
+ 106,22.50095419526121,107,8.061178539660076,108,21.78910411330834,
+ 109,7.687907245636061,110,21.07108461019797,111,7.319519218883196,
+ 112,20.34694527093527,113,6.956074666706056,114,19.61673329646618,
+ 115,6.597617468919375,116,18.88049302496987,117,6.244179663944927,
+ 118,18.13826520593599,119,5.895785158458706,120,17.39008603776435,
+ 121,5.552452954208928,122,16.63598595446048,123,5.214200112547619,
+ 124,15.87598812484569,125,4.881044637069488,126,15.11010660446335,
+ 127,4.553008438134293,128,14.33834405238159,129,4.230120545937456,
+ 130,13.56068888814942,131,3.91242076115465,132,12.77711171245938,
+ 133,3.599963977868704,134,11.98756073975332,135,3.292825491307504,
+ 136,11.19195587770789,137,2.99110772940632,138,10.39018091288203,
+ 139,2.694949052261742,140,9.582072980793015,141,2.404535601967394,
+ 142,8.767408033241633,143,2.120117760898228,144,7.945880213634462,
+ 145,1.842033794892112,146,7.117071603501313,147,1.570745149893405,
+ 148,6.280406043306776,149,1.306891602744761,150,5.43507510503741,
+ 151,1.051382392786307,152,4.579911837887788,153,0.80555794042662,
+ 154,3.713157241392883,155,0.57150543441384,156,2.831977424010357,
+ 157,0.35276317269117,158,1.93128755251199,159,0.15625418909331,160,1)}
*** sum of terms for...
.param Sum=hn(0)+hn(1)+hn(2)+hn(3)+hn(4)+hn(5)+hn(6)+hn(7)+hn(8)+hn(9)+hn(10)+
+ hn(11)+hn(12)+hn(13)+hn(14)+hn(15)+hn(16)+hn(17)+hn(18)+hn(19)+hn(20)+
+ hn(21)+hn(22)+hn(23)+hn(24)+hn(25)+hn(26)+hn(27)+hn(28)+hn(29)+hn(30)+
+ hn(31)+hn(32)+hn(33)+hn(34)+hn(35)+hn(36)+hn(37)+hn(38)+hn(39)+hn(40)+
+ hn(41)+hn(42)+hn(43)+hn(44)+hn(45)+hn(46)+hn(47)+hn(48)+hn(49)+hn(50)+
+ hn(51)+hn(52)+hn(53)+hn(54)+hn(55)+hn(56)+hn(57)+hn(58)+hn(59)+hn(60)+
+ hn(61)+hn(62)+hn(63)+hn(64)+hn(65)+hn(66)+hn(67)+hn(68)+hn(69)+hn(70)+
+ hn(71)+hn(72)+hn(73)+hn(74)+hn(75)+hn(76)+hn(77)+hn(78)+hn(79)+hn(80)/2
*** ...gain normalization
.param Gain=if(Norm, 2*Sum, 1)
*** buffered input
Gin 0 999 in GROUND 2
Rin 999 0 1
Vbypass {inv(SH)*999} {inv(SH)*667}
*** S&H input
Ash {999*SH} 0 {0.4*SH} 0 0 0 {667*SH} 0 SAMPLEHOLD Rout=1 Vhigh=1G Vlow=-1G ref={ref}
Vsh {SH*u(f0)*0.4} 0 pulse 0 1 {td} {tr} 0 0 {1/absf0}
*** intermediary stage
Rinter {floorM} 0 1
*** output stage...
Rout 0 1.1 1
Gexit GROUND out 1.1 0 {G/Gain/sqrtM**(Func==1&inv(Norm))}
Rexit out GROUND 1
*** row of delay lines
Tz1 667 0 1 0 Td={tz1} Z0=1
Tz2 {1*(2<=floorM)} 0 {2*(2<=floorM)} 0 Td={tz1} Z0=1
Tz3 {2*(3<=floorM)} 0 {3*(3<=floorM)} 0 Td={tz1} Z0=1
Tz4 {3*(4<=floorM)} 0 {4*(4<=floorM)} 0 Td={tz1} Z0=1
Tz5 {4*(5<=floorM)} 0 {5*(5<=floorM)} 0 Td={tz1} Z0=1
Tz6 {5*(6<=floorM)} 0 {6*(6<=floorM)} 0 Td={tz1} Z0=1
Tz7 {6*(7<=floorM)} 0 {7*(7<=floorM)} 0 Td={tz1} Z0=1
Tz8 {7*(8<=floorM)} 0 {8*(8<=floorM)} 0 Td={tz1} Z0=1
Tz9 {8*(9<=floorM)} 0 {9*(9<=floorM)} 0 Td={tz1} Z0=1
Tz10 {9*(10<=floorM)} 0 {10*(10<=floorM)} 0 Td={tz1} Z0=1
Tz11 {10*(11<=floorM)} 0 {11*(11<=floorM)} 0 Td={tz1} Z0=1
Tz12 {11*(12<=floorM)} 0 {12*(12<=floorM)} 0 Td={tz1} Z0=1
Tz13 {12*(13<=floorM)} 0 {13*(13<=floorM)} 0 Td={tz1} Z0=1
Tz14 {13*(14<=floorM)} 0 {14*(14<=floorM)} 0 Td={tz1} Z0=1
Tz15 {14*(15<=floorM)} 0 {15*(15<=floorM)} 0 Td={tz1} Z0=1
Tz16 {15*(16<=floorM)} 0 {16*(16<=floorM)} 0 Td={tz1} Z0=1
*** h[0:M], filling the array in sequential order, the rest - disabled
*** first one is always active
RGh 0 1.2 1
Gh_0 0 1.2 667 0 {hn(0)}
*** there can be maximum 16 multipliers/column with input node 667;
*** these take care of it
Gh_1 0 {Gh_out(1)} {Gh_in_row(1)} 0 {hn(1)}
Gh_2 0 {Gh_out(2)} {Gh_in_row(2)} 0 {hn(2)}
Gh_3 0 {Gh_out(3)} {Gh_in_row(3)} 0 {hn(3)}
Gh_4 0 {Gh_out(4)} {Gh_in_row(4)} 0 {hn(4)}
Gh_5 0 {Gh_out(5)} {Gh_in_row(5)} 0 {hn(5)}
Gh_6 0 {Gh_out(6)} {Gh_in_row(6)} 0 {hn(6)}
Gh_7 0 {Gh_out(7)} {Gh_in_row(7)} 0 {hn(7)}
Gh_8 0 {Gh_out(8)} {Gh_in_row(8)} 0 {hn(8)}
Gh_9 0 {Gh_out(9)} {Gh_in_row(9)} 0 {hn(9)}
Gh_10 0 {Gh_out(10)} {Gh_in_row(10)} 0 {hn(10)}
Gh_11 0 {Gh_out(11)} {Gh_in_row(11)} 0 {hn(11)}
Gh_12 0 {Gh_out(12)} {Gh_in_row(12)} 0 {hn(12)}
Gh_13 0 {Gh_out(13)} {Gh_in_row(13)} 0 {hn(13)}
Gh_14 0 {Gh_out(14)} {Gh_in_row(14)} 0 {hn(14)}
Gh_15 0 {Gh_out(15)} {Gh_in_row(15)} 0 {hn(15)}
Gh_16 0 {Gh_out(16)} {Gh_in_row(16)} 0 {hn(16)}
*** the rest of the array's 'coefficients'
Gh_17 0 {Gh_out(17)} {Gh_in(17)} 0 {hn(17)}
Gh_18 0 {Gh_out(18)} {Gh_in(18)} 0 {hn(18)}
Gh_19 0 {Gh_out(19)} {Gh_in(19)} 0 {hn(19)}
Gh_20 0 {Gh_out(20)} {Gh_in(20)} 0 {hn(20)}
Gh_21 0 {Gh_out(21)} {Gh_in(21)} 0 {hn(21)}
Gh_22 0 {Gh_out(22)} {Gh_in(22)} 0 {hn(22)}
Gh_23 0 {Gh_out(23)} {Gh_in(23)} 0 {hn(23)}
Gh_24 0 {Gh_out(24)} {Gh_in(24)} 0 {hn(24)}
Gh_25 0 {Gh_out(25)} {Gh_in(25)} 0 {hn(25)}
Gh_26 0 {Gh_out(26)} {Gh_in(26)} 0 {hn(26)}
Gh_27 0 {Gh_out(27)} {Gh_in(27)} 0 {hn(27)}
Gh_28 0 {Gh_out(28)} {Gh_in(28)} 0 {hn(28)}
Gh_29 0 {Gh_out(29)} {Gh_in(29)} 0 {hn(29)}
Gh_30 0 {Gh_out(30)} {Gh_in(30)} 0 {hn(30)}
Gh_31 0 {Gh_out(31)} {Gh_in(31)} 0 {hn(31)}
Gh_32 0 {Gh_out(32)} {Gh_in(32)} 0 {hn(32)}
Gh_33 0 {Gh_out(33)} {Gh_in(33)} 0 {hn(33)}
Gh_34 0 {Gh_out(34)} {Gh_in(34)} 0 {hn(34)}
Gh_35 0 {Gh_out(35)} {Gh_in(35)} 0 {hn(35)}
Gh_36 0 {Gh_out(36)} {Gh_in(36)} 0 {hn(36)}
Gh_37 0 {Gh_out(37)} {Gh_in(37)} 0 {hn(37)}
Gh_38 0 {Gh_out(38)} {Gh_in(38)} 0 {hn(38)}
Gh_39 0 {Gh_out(39)} {Gh_in(39)} 0 {hn(39)}
Gh_40 0 {Gh_out(40)} {Gh_in(40)} 0 {hn(40)}
Gh_41 0 {Gh_out(41)} {Gh_in(41)} 0 {hn(41)}
Gh_42 0 {Gh_out(42)} {Gh_in(42)} 0 {hn(42)}
Gh_43 0 {Gh_out(43)} {Gh_in(43)} 0 {hn(43)}
Gh_44 0 {Gh_out(44)} {Gh_in(44)} 0 {hn(44)}
Gh_45 0 {Gh_out(45)} {Gh_in(45)} 0 {hn(45)}
Gh_46 0 {Gh_out(46)} {Gh_in(46)} 0 {hn(46)}
Gh_47 0 {Gh_out(47)} {Gh_in(47)} 0 {hn(47)}
Gh_48 0 {Gh_out(48)} {Gh_in(48)} 0 {hn(48)}
Gh_49 0 {Gh_out(49)} {Gh_in(49)} 0 {hn(49)}
Gh_50 0 {Gh_out(50)} {Gh_in(50)} 0 {hn(50)}
Gh_51 0 {Gh_out(51)} {Gh_in(51)} 0 {hn(51)}
Gh_52 0 {Gh_out(52)} {Gh_in(52)} 0 {hn(52)}
Gh_53 0 {Gh_out(53)} {Gh_in(53)} 0 {hn(53)}
Gh_54 0 {Gh_out(54)} {Gh_in(54)} 0 {hn(54)}
Gh_55 0 {Gh_out(55)} {Gh_in(55)} 0 {hn(55)}
Gh_56 0 {Gh_out(56)} {Gh_in(56)} 0 {hn(56)}
Gh_57 0 {Gh_out(57)} {Gh_in(57)} 0 {hn(57)}
Gh_58 0 {Gh_out(58)} {Gh_in(58)} 0 {hn(58)}
Gh_59 0 {Gh_out(59)} {Gh_in(59)} 0 {hn(59)}
Gh_60 0 {Gh_out(60)} {Gh_in(60)} 0 {hn(60)}
Gh_61 0 {Gh_out(61)} {Gh_in(61)} 0 {hn(61)}
Gh_62 0 {Gh_out(62)} {Gh_in(62)} 0 {hn(62)}
Gh_63 0 {Gh_out(63)} {Gh_in(63)} 0 {hn(63)}
Gh_64 0 {Gh_out(64)} {Gh_in(64)} 0 {hn(64)}
Gh_65 0 {Gh_out(65)} {Gh_in(65)} 0 {hn(65)}
Gh_66 0 {Gh_out(66)} {Gh_in(66)} 0 {hn(66)}
Gh_67 0 {Gh_out(67)} {Gh_in(67)} 0 {hn(67)}
Gh_68 0 {Gh_out(68)} {Gh_in(68)} 0 {hn(68)}
Gh_69 0 {Gh_out(69)} {Gh_in(69)} 0 {hn(69)}
Gh_70 0 {Gh_out(70)} {Gh_in(70)} 0 {hn(70)}
Gh_71 0 {Gh_out(71)} {Gh_in(71)} 0 {hn(71)}
Gh_72 0 {Gh_out(72)} {Gh_in(72)} 0 {hn(72)}
Gh_73 0 {Gh_out(73)} {Gh_in(73)} 0 {hn(73)}
Gh_74 0 {Gh_out(74)} {Gh_in(74)} 0 {hn(74)}
Gh_75 0 {Gh_out(75)} {Gh_in(75)} 0 {hn(75)}
Gh_76 0 {Gh_out(76)} {Gh_in(76)} 0 {hn(76)}
Gh_77 0 {Gh_out(77)} {Gh_in(77)} 0 {hn(77)}
Gh_78 0 {Gh_out(78)} {Gh_in(78)} 0 {hn(78)}
Gh_79 0 {Gh_out(79)} {Gh_in(79)} 0 {hn(79)}
Gh_80 0 {Gh_out(80)} {Gh_in(80)} 0 {hn(80)}
Gh_81 0 {Gh_out(81)} {Gh_in(81)} 0 {hn(81)}
Gh_82 0 {Gh_out(82)} {Gh_in(82)} 0 {hn(82)}
Gh_83 0 {Gh_out(83)} {Gh_in(83)} 0 {hn(83)}
Gh_84 0 {Gh_out(84)} {Gh_in(84)} 0 {hn(84)}
Gh_85 0 {Gh_out(85)} {Gh_in(85)} 0 {hn(85)}
Gh_86 0 {Gh_out(86)} {Gh_in(86)} 0 {hn(86)}
Gh_87 0 {Gh_out(87)} {Gh_in(87)} 0 {hn(87)}
Gh_88 0 {Gh_out(88)} {Gh_in(88)} 0 {hn(88)}
Gh_89 0 {Gh_out(89)} {Gh_in(89)} 0 {hn(89)}
Gh_90 0 {Gh_out(90)} {Gh_in(90)} 0 {hn(90)}
Gh_91 0 {Gh_out(91)} {Gh_in(91)} 0 {hn(91)}
Gh_92 0 {Gh_out(92)} {Gh_in(92)} 0 {hn(92)}
Gh_93 0 {Gh_out(93)} {Gh_in(93)} 0 {hn(93)}
Gh_94 0 {Gh_out(94)} {Gh_in(94)} 0 {hn(94)}
Gh_95 0 {Gh_out(95)} {Gh_in(95)} 0 {hn(95)}
Gh_96 0 {Gh_out(96)} {Gh_in(96)} 0 {hn(96)}
Gh_97 0 {Gh_out(97)} {Gh_in(97)} 0 {hn(97)}
Gh_98 0 {Gh_out(98)} {Gh_in(98)} 0 {hn(98)}
Gh_99 0 {Gh_out(99)} {Gh_in(99)} 0 {hn(99)}
Gh_100 0 {Gh_out(100)} {Gh_in(100)} 0 {hn(100)}
Gh_101 0 {Gh_out(101)} {Gh_in(101)} 0 {hn(101)}
Gh_102 0 {Gh_out(102)} {Gh_in(102)} 0 {hn(102)}
Gh_103 0 {Gh_out(103)} {Gh_in(103)} 0 {hn(103)}
Gh_104 0 {Gh_out(104)} {Gh_in(104)} 0 {hn(104)}
Gh_105 0 {Gh_out(105)} {Gh_in(105)} 0 {hn(105)}
Gh_106 0 {Gh_out(106)} {Gh_in(106)} 0 {hn(106)}
Gh_107 0 {Gh_out(107)} {Gh_in(107)} 0 {hn(107)}
Gh_108 0 {Gh_out(108)} {Gh_in(108)} 0 {hn(108)}
Gh_109 0 {Gh_out(109)} {Gh_in(109)} 0 {hn(109)}
Gh_110 0 {Gh_out(110)} {Gh_in(110)} 0 {hn(110)}
Gh_111 0 {Gh_out(111)} {Gh_in(111)} 0 {hn(111)}
Gh_112 0 {Gh_out(112)} {Gh_in(112)} 0 {hn(112)}
Gh_113 0 {Gh_out(113)} {Gh_in(113)} 0 {hn(113)}
Gh_114 0 {Gh_out(114)} {Gh_in(114)} 0 {hn(114)}
Gh_115 0 {Gh_out(115)} {Gh_in(115)} 0 {hn(115)}
Gh_116 0 {Gh_out(116)} {Gh_in(116)} 0 {hn(116)}
Gh_117 0 {Gh_out(117)} {Gh_in(117)} 0 {hn(117)}
Gh_118 0 {Gh_out(118)} {Gh_in(118)} 0 {hn(118)}
Gh_119 0 {Gh_out(119)} {Gh_in(119)} 0 {hn(119)}
Gh_120 0 {Gh_out(120)} {Gh_in(120)} 0 {hn(120)}
Gh_121 0 {Gh_out(121)} {Gh_in(121)} 0 {hn(121)}
Gh_122 0 {Gh_out(122)} {Gh_in(122)} 0 {hn(122)}
Gh_123 0 {Gh_out(123)} {Gh_in(123)} 0 {hn(123)}
Gh_124 0 {Gh_out(124)} {Gh_in(124)} 0 {hn(124)}
Gh_125 0 {Gh_out(125)} {Gh_in(125)} 0 {hn(125)}
Gh_126 0 {Gh_out(126)} {Gh_in(126)} 0 {hn(126)}
Gh_127 0 {Gh_out(127)} {Gh_in(127)} 0 {hn(127)}
Gh_128 0 {Gh_out(128)} {Gh_in(128)} 0 {hn(128)}
Gh_129 0 {Gh_out(129)} {Gh_in(129)} 0 {hn(129)}
Gh_130 0 {Gh_out(130)} {Gh_in(130)} 0 {hn(130)}
Gh_131 0 {Gh_out(131)} {Gh_in(131)} 0 {hn(131)}
Gh_132 0 {Gh_out(132)} {Gh_in(132)} 0 {hn(132)}
Gh_133 0 {Gh_out(133)} {Gh_in(133)} 0 {hn(133)}
Gh_134 0 {Gh_out(134)} {Gh_in(134)} 0 {hn(134)}
Gh_135 0 {Gh_out(135)} {Gh_in(135)} 0 {hn(135)}
Gh_136 0 {Gh_out(136)} {Gh_in(136)} 0 {hn(136)}
Gh_137 0 {Gh_out(137)} {Gh_in(137)} 0 {hn(137)}
Gh_138 0 {Gh_out(138)} {Gh_in(138)} 0 {hn(138)}
Gh_139 0 {Gh_out(139)} {Gh_in(139)} 0 {hn(139)}
Gh_140 0 {Gh_out(140)} {Gh_in(140)} 0 {hn(140)}
Gh_141 0 {Gh_out(141)} {Gh_in(141)} 0 {hn(141)}
Gh_142 0 {Gh_out(142)} {Gh_in(142)} 0 {hn(142)}
Gh_143 0 {Gh_out(143)} {Gh_in(143)} 0 {hn(143)}
Gh_144 0 {Gh_out(144)} {Gh_in(144)} 0 {hn(144)}
Gh_145 0 {Gh_out(145)} {Gh_in(145)} 0 {hn(145)}
Gh_146 0 {Gh_out(146)} {Gh_in(146)} 0 {hn(146)}
Gh_147 0 {Gh_out(147)} {Gh_in(147)} 0 {hn(147)}
Gh_148 0 {Gh_out(148)} {Gh_in(148)} 0 {hn(148)}
Gh_149 0 {Gh_out(149)} {Gh_in(149)} 0 {hn(149)}
Gh_150 0 {Gh_out(150)} {Gh_in(150)} 0 {hn(150)}
Gh_151 0 {Gh_out(151)} {Gh_in(151)} 0 {hn(151)}
Gh_152 0 {Gh_out(152)} {Gh_in(152)} 0 {hn(152)}
Gh_153 0 {Gh_out(153)} {Gh_in(153)} 0 {hn(153)}
Gh_154 0 {Gh_out(154)} {Gh_in(154)} 0 {hn(154)}
Gh_155 0 {Gh_out(155)} {Gh_in(155)} 0 {hn(155)}
Gh_156 0 {Gh_out(156)} {Gh_in(156)} 0 {hn(156)}
Gh_157 0 {Gh_out(157)} {Gh_in(157)} 0 {hn(157)}
Gh_158 0 {Gh_out(158)} {Gh_in(158)} 0 {hn(158)}
Gh_159 0 {Gh_out(159)} {Gh_in(159)} 0 {hn(159)}
Gh_160 0 {Gh_out(160)} {Gh_in(160)} 0 {hn(160)}
Gh_161 0 {Gh_out(161)} {Gh_in(161)} 0 {hn(161)}
Gh_162 0 {Gh_out(162)} {Gh_in(162)} 0 {hn(162)}
Gh_163 0 {Gh_out(163)} {Gh_in(163)} 0 {hn(163)}
Gh_164 0 {Gh_out(164)} {Gh_in(164)} 0 {hn(164)}
Gh_165 0 {Gh_out(165)} {Gh_in(165)} 0 {hn(165)}
Gh_166 0 {Gh_out(166)} {Gh_in(166)} 0 {hn(166)}
Gh_167 0 {Gh_out(167)} {Gh_in(167)} 0 {hn(167)}
Gh_168 0 {Gh_out(168)} {Gh_in(168)} 0 {hn(168)}
Gh_169 0 {Gh_out(169)} {Gh_in(169)} 0 {hn(169)}
Gh_170 0 {Gh_out(170)} {Gh_in(170)} 0 {hn(170)}
Gh_171 0 {Gh_out(171)} {Gh_in(171)} 0 {hn(171)}
Gh_172 0 {Gh_out(172)} {Gh_in(172)} 0 {hn(172)}
Gh_173 0 {Gh_out(173)} {Gh_in(173)} 0 {hn(173)}
Gh_174 0 {Gh_out(174)} {Gh_in(174)} 0 {hn(174)}
Gh_175 0 {Gh_out(175)} {Gh_in(175)} 0 {hn(175)}
Gh_176 0 {Gh_out(176)} {Gh_in(176)} 0 {hn(176)}
Gh_177 0 {Gh_out(177)} {Gh_in(177)} 0 {hn(177)}
Gh_178 0 {Gh_out(178)} {Gh_in(178)} 0 {hn(178)}
Gh_179 0 {Gh_out(179)} {Gh_in(179)} 0 {hn(179)}
Gh_180 0 {Gh_out(180)} {Gh_in(180)} 0 {hn(180)}
Gh_181 0 {Gh_out(181)} {Gh_in(181)} 0 {hn(181)}
Gh_182 0 {Gh_out(182)} {Gh_in(182)} 0 {hn(182)}
Gh_183 0 {Gh_out(183)} {Gh_in(183)} 0 {hn(183)}
Gh_184 0 {Gh_out(184)} {Gh_in(184)} 0 {hn(184)}
Gh_185 0 {Gh_out(185)} {Gh_in(185)} 0 {hn(185)}
Gh_186 0 {Gh_out(186)} {Gh_in(186)} 0 {hn(186)}
Gh_187 0 {Gh_out(187)} {Gh_in(187)} 0 {hn(187)}
Gh_188 0 {Gh_out(188)} {Gh_in(188)} 0 {hn(188)}
Gh_189 0 {Gh_out(189)} {Gh_in(189)} 0 {hn(189)}
Gh_190 0 {Gh_out(190)} {Gh_in(190)} 0 {hn(190)}
Gh_191 0 {Gh_out(191)} {Gh_in(191)} 0 {hn(191)}
Gh_192 0 {Gh_out(192)} {Gh_in(192)} 0 {hn(192)}
Gh_193 0 {Gh_out(193)} {Gh_in(193)} 0 {hn(193)}
Gh_194 0 {Gh_out(194)} {Gh_in(194)} 0 {hn(194)}
Gh_195 0 {Gh_out(195)} {Gh_in(195)} 0 {hn(195)}
Gh_196 0 {Gh_out(196)} {Gh_in(196)} 0 {hn(196)}
Gh_197 0 {Gh_out(197)} {Gh_in(197)} 0 {hn(197)}
Gh_198 0 {Gh_out(198)} {Gh_in(198)} 0 {hn(198)}
Gh_199 0 {Gh_out(199)} {Gh_in(199)} 0 {hn(199)}
Gh_200 0 {Gh_out(200)} {Gh_in(200)} 0 {hn(200)}
Gh_201 0 {Gh_out(201)} {Gh_in(201)} 0 {hn(201)}
Gh_202 0 {Gh_out(202)} {Gh_in(202)} 0 {hn(202)}
Gh_203 0 {Gh_out(203)} {Gh_in(203)} 0 {hn(203)}
Gh_204 0 {Gh_out(204)} {Gh_in(204)} 0 {hn(204)}
Gh_205 0 {Gh_out(205)} {Gh_in(205)} 0 {hn(205)}
Gh_206 0 {Gh_out(206)} {Gh_in(206)} 0 {hn(206)}
Gh_207 0 {Gh_out(207)} {Gh_in(207)} 0 {hn(207)}
Gh_208 0 {Gh_out(208)} {Gh_in(208)} 0 {hn(208)}
Gh_209 0 {Gh_out(209)} {Gh_in(209)} 0 {hn(209)}
Gh_210 0 {Gh_out(210)} {Gh_in(210)} 0 {hn(210)}
Gh_211 0 {Gh_out(211)} {Gh_in(211)} 0 {hn(211)}
Gh_212 0 {Gh_out(212)} {Gh_in(212)} 0 {hn(212)}
Gh_213 0 {Gh_out(213)} {Gh_in(213)} 0 {hn(213)}
Gh_214 0 {Gh_out(214)} {Gh_in(214)} 0 {hn(214)}
Gh_215 0 {Gh_out(215)} {Gh_in(215)} 0 {hn(215)}
Gh_216 0 {Gh_out(216)} {Gh_in(216)} 0 {hn(216)}
Gh_217 0 {Gh_out(217)} {Gh_in(217)} 0 {hn(217)}
Gh_218 0 {Gh_out(218)} {Gh_in(218)} 0 {hn(218)}
Gh_219 0 {Gh_out(219)} {Gh_in(219)} 0 {hn(219)}
Gh_220 0 {Gh_out(220)} {Gh_in(220)} 0 {hn(220)}
Gh_221 0 {Gh_out(221)} {Gh_in(221)} 0 {hn(221)}
Gh_222 0 {Gh_out(222)} {Gh_in(222)} 0 {hn(222)}
Gh_223 0 {Gh_out(223)} {Gh_in(223)} 0 {hn(223)}
Gh_224 0 {Gh_out(224)} {Gh_in(224)} 0 {hn(224)}
Gh_225 0 {Gh_out(225)} {Gh_in(225)} 0 {hn(225)}
Gh_226 0 {Gh_out(226)} {Gh_in(226)} 0 {hn(226)}
Gh_227 0 {Gh_out(227)} {Gh_in(227)} 0 {hn(227)}
Gh_228 0 {Gh_out(228)} {Gh_in(228)} 0 {hn(228)}
Gh_229 0 {Gh_out(229)} {Gh_in(229)} 0 {hn(229)}
Gh_230 0 {Gh_out(230)} {Gh_in(230)} 0 {hn(230)}
Gh_231 0 {Gh_out(231)} {Gh_in(231)} 0 {hn(231)}
Gh_232 0 {Gh_out(232)} {Gh_in(232)} 0 {hn(232)}
Gh_233 0 {Gh_out(233)} {Gh_in(233)} 0 {hn(233)}
Gh_234 0 {Gh_out(234)} {Gh_in(234)} 0 {hn(234)}
Gh_235 0 {Gh_out(235)} {Gh_in(235)} 0 {hn(235)}
Gh_236 0 {Gh_out(236)} {Gh_in(236)} 0 {hn(236)}
Gh_237 0 {Gh_out(237)} {Gh_in(237)} 0 {hn(237)}
Gh_238 0 {Gh_out(238)} {Gh_in(238)} 0 {hn(238)}
Gh_239 0 {Gh_out(239)} {Gh_in(239)} 0 {hn(239)}
Gh_240 0 {Gh_out(240)} {Gh_in(240)} 0 {hn(240)}
Gh_241 0 {Gh_out(241)} {Gh_in(241)} 0 {hn(241)}
Gh_242 0 {Gh_out(242)} {Gh_in(242)} 0 {hn(242)}
Gh_243 0 {Gh_out(243)} {Gh_in(243)} 0 {hn(243)}
Gh_244 0 {Gh_out(244)} {Gh_in(244)} 0 {hn(244)}
Gh_245 0 {Gh_out(245)} {Gh_in(245)} 0 {hn(245)}
Gh_246 0 {Gh_out(246)} {Gh_in(246)} 0 {hn(246)}
Gh_247 0 {Gh_out(247)} {Gh_in(247)} 0 {hn(247)}
Gh_248 0 {Gh_out(248)} {Gh_in(248)} 0 {hn(248)}
Gh_249 0 {Gh_out(249)} {Gh_in(249)} 0 {hn(249)}
Gh_250 0 {Gh_out(250)} {Gh_in(250)} 0 {hn(250)}
Gh_251 0 {Gh_out(251)} {Gh_in(251)} 0 {hn(251)}
Gh_252 0 {Gh_out(252)} {Gh_in(252)} 0 {hn(252)}
Gh_253 0 {Gh_out(253)} {Gh_in(253)} 0 {hn(253)}
Gh_254 0 {Gh_out(254)} {Gh_in(254)} 0 {hn(254)}
Gh_255 0 {Gh_out(255)} {Gh_in(255)} 0 {hn(255)}
Gh_256 0 {Gh_out(256)} {Gh_in(256)} 0 {hn(256)}
*** column of delay lines
Tx2 2.2 0 0 2.3 Td={tz2} Z0=1
Tx3 {Tx_IO(3.2,3)} 0 {Tx_IO(3.3,3)} 0 Td={2*tz2} Z0=1
Tx4 {Tx_IO(4.2,4)} 0 0 {Tx_IO(4.3,4)} Td={3*tz2} Z0=1
Tx5 {Tx_IO(5.2,5)} 0 {Tx_IO(5.3,5)} 0 Td={4*tz2} Z0=1
Tx6 {Tx_IO(6.2,6)} 0 0 {Tx_IO(6.3,6)} Td={5*tz2} Z0=1
Tx7 {Tx_IO(7.2,7)} 0 {Tx_IO(7.3,7)} 0 Td={6*tz2} Z0=1
Tx8 {Tx_IO(8.2,8)} 0 0 {Tx_IO(8.3,8)} Td={7*tz2} Z0=1
Tx9 {Tx_IO(9.2,9)} 0 {Tx_IO(9.3,9)} 0 Td={8*tz2} Z0=1
Tx10 {Tx_IO(10.2,10)} 0 0 {Tx_IO(10.3,10)} Td={9*tz2} Z0=1
Tx11 {Tx_IO(11.2,11)} 0 {Tx_IO(11.3,11)} 0 Td={10*tz2} Z0=1
Tx12 {Tx_IO(12.2,12)} 0 0 {Tx_IO(12.3,12)} Td={11*tz2} Z0=1
Tx13 {Tx_IO(13.2,13)} 0 {Tx_IO(13.3,13)} 0 Td={12*tz2} Z0=1
Tx14 {Tx_IO(14.2,14)} 0 0 {Tx_IO(14.3,14)} Td={13*tz2} Z0=1
Tx15 {Tx_IO(15.2,15)} 0 {Tx_IO(15.3,15)} 0 Td={14*tz2} Z0=1
Tx16 {Tx_IO(16.2,16)} 0 0 {Tx_IO(16.3,16)} Td={15*tz2} Z0=1
*** load resistances for the tlines making the rows
RTx2 0 2.3 1
RTx3 0 {Tx_IO(3.3,3)} 1
RTx4 0 {Tx_IO(4.3,4)} 1
RTx5 0 {Tx_IO(5.3,5)} 1
RTx6 0 {Tx_IO(6.3,6)} 1
RTx7 0 {Tx_IO(7.3,7)} 1
RTx8 0 {Tx_IO(8.3,8)} 1
RTx9 0 {Tx_IO(9.3,9)} 1
RTx10 0 {Tx_IO(10.3,10)} 1
RTx11 0 {Tx_IO(11.3,11)} 1
RTx12 0 {Tx_IO(12.3,12)} 1
RTx13 0 {Tx_IO(13.3,13)} 1
RTx14 0 {Tx_IO(14.3,14)} 1
RTx15 0 {Tx_IO(15.3,15)} 1
RTx16 0 {Tx_IO(16.3,16)} 1
*** summers for the rows of delays
Gx1 0 1.1 1.2 2.3 1
Gx3 0 {Gx_out(3)} {Gx_in(3.3,3)} {Gx_in(4.3,4)} 1
Gx5 0 {Gx_out(5)} {Gx_in(5.3,5)} {Gx_in(6.3,6)} 1
Gx7 0 {Gx_out(7)} {Gx_in(7.3,7)} {Gx_in(8.3,8)} 1
Gx9 0 {Gx_out(9)} {Gx_in(9.3,9)} {Gx_in(10.3,10)} 1
Gx11 0 {Gx_out(11)} {Gx_in(11.3,11)} {Gx_in(12.3,12)} 1
Gx13 0 {Gx_out(13)} {Gx_in(13.3,13)} {Gx_in(14.3,14)} 1
Gx15 0 {Gx_out(15)} {Gx_in(15.3,15)} {Gx_in(16.3,16)} 1
*** testing area
VM 0.1 0 {M} AC {10**(M/20)} {M}
.param simM=M/sim hnGain=1/Gain/sqrtM**(Func==1&inv(Norm))
Bcoef 0.3 0 v=hn(round(time*simM))*hnGain
.ends customFIR
