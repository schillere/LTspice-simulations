Version 4
SHEET 1 3660 1056
WIRE -32 -304 -80 -304
WIRE 240 -304 32 -304
WIRE 304 -304 240 -304
WIRE 496 -304 464 -304
WIRE 800 -304 496 -304
WIRE 1056 -304 960 -304
WIRE 1264 -304 1120 -304
WIRE 1312 -304 1264 -304
WIRE 1472 -304 1376 -304
WIRE 1472 -288 1472 -304
WIRE -240 -272 -272 -272
WIRE -176 -272 -240 -272
WIRE 32 -272 -80 -272
WIRE 240 -272 96 -272
WIRE 304 -272 240 -272
WIRE 592 -272 464 -272
WIRE 800 -272 592 -272
WIRE 1120 -272 960 -272
WIRE 1264 -272 1184 -272
WIRE 1312 -272 1264 -272
WIRE -240 -256 -240 -272
WIRE 96 -240 -80 -240
WIRE 240 -240 160 -240
WIRE 304 -240 240 -240
WIRE 688 -240 464 -240
WIRE 800 -240 688 -240
WIRE 1184 -240 960 -240
WIRE 1264 -240 1248 -240
WIRE 1280 -240 1264 -240
WIRE 1312 -240 1280 -240
WIRE 1408 -240 1376 -240
WIRE 304 -208 256 -208
WIRE 784 -208 464 -208
WIRE 800 -208 784 -208
WIRE 1040 -208 960 -208
WIRE 1408 -208 1408 -240
WIRE 1472 -208 1472 -224
WIRE -240 -176 -240 -192
WIRE 1840 -176 1792 -176
WIRE 1952 -176 1920 -176
WIRE 2368 -176 2320 -176
WIRE 2480 -176 2448 -176
WIRE -16 -160 -16 -288
WIRE 48 -160 48 -256
WIRE 112 -160 112 -224
WIRE 1040 -160 1040 -208
WIRE 1072 -160 1072 -288
WIRE 1136 -160 1136 -256
WIRE 1200 -160 1200 -224
WIRE 496 -144 496 -304
WIRE 512 -144 496 -144
WIRE 784 -144 784 -208
WIRE 784 -144 576 -144
WIRE 1280 -144 1280 -240
WIRE 1312 -144 1280 -144
WIRE 1472 -144 1376 -144
WIRE 1872 -144 1792 -144
WIRE 2400 -144 2320 -144
WIRE 1952 -128 1952 -176
WIRE 2480 -128 2480 -176
WIRE 496 -112 496 -144
WIRE 1840 -96 1792 -96
WIRE 1952 -96 1920 -96
WIRE 2080 -96 2032 -96
WIRE 2368 -96 2320 -96
WIRE 2480 -96 2448 -96
WIRE 2608 -96 2560 -96
WIRE 1312 -80 1280 -80
WIRE 1408 -80 1376 -80
WIRE 592 -64 592 -272
WIRE 608 -64 592 -64
WIRE 784 -64 784 -144
WIRE 784 -64 672 -64
WIRE 1872 -64 1792 -64
WIRE 2400 -64 2320 -64
WIRE 1408 -48 1408 -80
WIRE 1472 -48 1472 -64
WIRE 1280 -32 1280 -80
WIRE 1840 -16 1792 -16
WIRE 1952 -16 1952 -64
WIRE 1952 -16 1920 -16
WIRE 2368 -16 2320 -16
WIRE 2480 -16 2480 -64
WIRE 2480 -16 2448 -16
WIRE 592 0 592 -64
WIRE 1872 16 1792 16
WIRE 2400 16 2320 16
WIRE 688 48 688 -240
WIRE 704 48 688 48
WIRE 784 48 784 -64
WIRE 784 48 768 48
WIRE 880 48 784 48
WIRE 880 64 880 48
WIRE 688 112 688 48
WIRE 880 144 880 128
WIRE 496 224 496 -32
WIRE 592 224 592 80
WIRE 592 224 496 224
WIRE 688 224 688 192
WIRE 688 224 592 224
WIRE 784 224 784 48
WIRE 784 224 688 224
WIRE -240 304 -256 304
WIRE 0 304 -32 304
WIRE 144 304 112 304
WIRE 2032 304 2000 304
WIRE 2144 304 2112 304
WIRE 2288 304 2224 304
WIRE 2448 304 2368 304
WIRE 384 320 368 320
WIRE 496 320 464 320
WIRE 608 320 576 320
WIRE 752 320 720 320
WIRE 832 320 752 320
WIRE 944 320 912 320
WIRE 1152 320 1136 320
WIRE 1264 320 1232 320
WIRE 1376 320 1344 320
WIRE 1536 320 1504 320
WIRE 1728 320 1536 320
WIRE 1856 320 1808 320
WIRE 2976 320 2896 320
WIRE 3104 320 3056 320
WIRE -240 336 -256 336
WIRE 0 336 -32 336
WIRE 144 336 112 336
WIRE 2064 336 2000 336
WIRE 2320 336 2272 336
WIRE 416 352 368 352
WIRE 864 352 816 352
WIRE 1184 352 1136 352
WIRE 2720 352 2688 352
WIRE 2896 352 2896 320
WIRE 2896 352 2832 352
WIRE 3008 352 2944 352
WIRE 0 368 -32 368
WIRE 144 368 112 368
WIRE 1536 368 1536 320
WIRE 1568 368 1536 368
WIRE 1760 368 1760 352
WIRE 1760 368 1680 368
WIRE 2032 368 2000 368
WIRE 2176 368 2176 336
WIRE 2176 368 2112 368
WIRE -240 384 -256 384
WIRE 384 384 368 384
WIRE 528 384 528 352
WIRE 528 384 464 384
WIRE 1152 384 1136 384
WIRE 1296 384 1296 352
WIRE 1296 384 1232 384
WIRE 2720 384 2688 384
WIRE 2976 384 2832 384
WIRE 3104 384 3056 384
WIRE 2064 400 2000 400
WIRE -240 416 -256 416
WIRE 0 416 -32 416
WIRE 144 416 112 416
WIRE 416 416 368 416
WIRE 1184 416 1136 416
WIRE 2720 416 2688 416
WIRE 2896 416 2832 416
WIRE 2944 416 2944 352
WIRE 3008 416 2944 416
WIRE 752 432 752 320
WIRE 832 432 752 432
WIRE 944 432 912 432
WIRE 0 448 -32 448
WIRE 144 448 112 448
WIRE 2896 448 2896 416
WIRE 2976 448 2896 448
WIRE 3104 448 3056 448
WIRE -240 464 -256 464
WIRE 864 464 816 464
WIRE 0 480 -32 480
WIRE 144 480 112 480
WIRE 2032 480 2000 480
WIRE 2144 480 2112 480
WIRE 2288 480 2224 480
WIRE 2448 480 2368 480
WIRE 2944 480 2944 416
WIRE 3008 480 2944 480
WIRE -240 496 -256 496
WIRE 1152 496 1136 496
WIRE 1264 496 1232 496
WIRE 1392 496 1344 496
WIRE 1616 496 1552 496
WIRE 1744 496 1680 496
WIRE 2944 496 2944 480
WIRE 2064 512 2000 512
WIRE 2272 512 2272 336
WIRE 2320 512 2272 512
WIRE 1184 528 1136 528
WIRE 2032 544 2000 544
WIRE 2176 544 2176 512
WIRE 2176 544 2112 544
WIRE 1152 560 1136 560
WIRE 1296 560 1296 528
WIRE 1296 560 1232 560
WIRE 448 576 352 576
WIRE 768 576 592 576
WIRE 784 576 768 576
WIRE 1600 576 1552 576
WIRE 1744 576 1664 576
WIRE 2064 576 2000 576
WIRE 1184 592 1136 592
WIRE 640 640 592 640
WIRE 768 640 688 640
WIRE 784 640 768 640
WIRE 2016 656 2000 656
WIRE 2032 656 2016 656
WIRE 2144 656 2112 656
WIRE 2272 656 2272 512
WIRE 2272 656 2224 656
WIRE 2016 688 2016 656
WIRE 2064 688 2016 688
WIRE 2016 752 2000 752
WIRE 2032 752 2016 752
WIRE 2176 752 2176 688
WIRE 2176 752 2112 752
WIRE 2016 784 2016 752
WIRE 2064 784 2016 784
FLAG -176 336 0
FLAG -256 304 a
FLAG -256 336 nul
FLAG -176 416 0
FLAG -256 416 nul
FLAG -176 496 0
FLAG -256 496 nul
FLAG -256 384 b
FLAG -256 464 c
FLAG -32 304 v_a
FLAG -32 336 v_b
FLAG -32 368 v_c
FLAG 144 304 v_alpha
FLAG 144 336 v_beta
FLAG 144 368 v_zero
FLAG -176 304 v_a
FLAG -176 384 v_b
FLAG -176 464 v_c
FLAG -32 416 i_a
FLAG -32 448 i_b
FLAG -32 480 i_c
FLAG 144 416 i_alpha
FLAG 144 448 i_beta
FLAG 144 480 i_zero
FLAG 368 320 v_alpha
FLAG 368 384 v_beta
FLAG 1136 528 i_alpha
FLAG 1136 592 i_beta
FLAG 1504 320 p
FLAG 1552 496 q
FLAG 1552 576 i_zero
FLAG 1856 320 p*
FLAG 1744 496 q*
FLAG 1744 576 i_zero*
FLAG 2000 304 p*
FLAG 2000 368 q*
FLAG 2000 480 p*
FLAG 2000 544 q*
FLAG 2688 416 i_zero*
FLAG 2688 352 i_alpha*
FLAG 2688 384 i_beta*
FLAG 2448 480 i_beta*
FLAG 2448 304 i_alpha*
FLAG 2080 -96 power_in
FLAG 2608 -96 power_out
FLAG 944 320 v`a
FLAG 1392 496 q
FLAG 3104 320 i_a*
FLAG 3104 384 i_b*
FLAG 3104 448 i_c*
FLAG 2944 576 0
FLAG 240 -304 a
FLAG 240 -272 b
FLAG 240 -240 c
FLAG -272 -272 nul
FLAG 1104 -288 0
FLAG 1072 -160 i_a
FLAG 1168 -256 0
FLAG 1136 -160 i_b
FLAG 1232 -224 0
FLAG 1200 -160 i_c
FLAG 448 -96 i_a*
FLAG 544 16 i_b*
FLAG 640 128 i_c*
FLAG 448 -48 0
FLAG 544 64 0
FLAG 640 176 0
FLAG 496 -304 PCC1
FLAG 592 -272 PCC2
FLAG 688 -240 PCC3
FLAG 256 -208 nul
FLAG 1040 -160 COM
FLAG 784 -208 PCCN
FLAG -240 -176 0
FLAG 1568 400 0
FLAG 880 144 0
FLAG 1264 -304 _a
FLAG 1264 -272 _b
FLAG 1264 -240 _c
FLAG 1280 -32 COM
FLAG 1472 -48 0
FLAG 1408 -48 0
FLAG 1472 -208 0
FLAG 1408 -208 0
FLAG 16 -288 0
FLAG -16 -160 ina
FLAG 80 -256 0
FLAG 48 -160 inb
FLAG 144 -224 0
FLAG 112 -160 inc
FLAG 1792 -176 a
FLAG 1792 -144 ina
FLAG 1792 -96 b
FLAG 1792 -64 inb
FLAG 1792 -16 c
FLAG 1792 16 inc
FLAG 1984 -128 0
FLAG 1984 -64 0
FLAG 2320 -176 _a
FLAG 2320 -96 _b
FLAG 2320 -16 _c
FLAG 2512 -128 0
FLAG 2512 -64 0
FLAG 2320 -144 i_a
FLAG 2320 -64 i_b
FLAG 2320 16 i_c
FLAG 608 352 0
FLAG 816 352 i`a
FLAG 768 576 i`a
FLAG 816 464 i`b
FLAG 768 640 i`b
FLAG 944 432 v`b
FLAG 1136 352 i_alpha
FLAG 1136 416 i_beta
FLAG 1136 320 v`a
FLAG 1136 560 v`a
FLAG 1136 384 v`b
FLAG 1136 496 v`b
FLAG 1376 320 p
FLAG 368 352 i`a
FLAG 368 416 i`b
FLAG 2000 336 v`a
FLAG 2000 400 v`b
FLAG 2000 512 v`b
FLAG 2000 576 v`a
FLAG 2000 656 v`a
FLAG 2000 752 v`b
FLAG 352 656 0
SYMBOL Vsense -224 320 R0
SYMATTR InstName U2
SYMBOL Misc\\jumper 1648 432 R0
WINDOW 0 1 71 Invisible 2
SYMATTR InstName X1
SYMBOL Filter 1632 368 R0
WINDOW 38 -10 48 Center 2
SYMATTR SpiceModel RRS
SYMATTR SpiceLine2 G=1 Asc=3 Ap=1 As=40 N=20
SYMATTR SpiceLine f0=50*20 fp1=10 fs1=200 fp2=0 fs2=0
SYMATTR InstName U11
SYMATTR Value2 Win=1 Choice=0 sim=1 test=0 SH=0 Fact=1
SYMBOL Transforms 48 336 R0
SYMATTR InstName U5
SYMBOL Transforms 48 448 R0
SYMATTR InstName U8
SYMBOL Transforms 2768 384 R0
SYMATTR SpiceModel AB0/abc
SYMATTR InstName U12
SYMBOL Math2r 416 320 R0
SYMATTR SpiceModel x
SYMATTR InstName U6
SYMBOL Math2r 416 384 R0
SYMATTR SpiceModel x
SYMATTR InstName U13
SYMBOL Math2r 528 320 R0
SYMATTR SpiceModel +
SYMATTR InstName U14
SYMBOL Math2r 1184 496 R0
SYMATTR SpiceModel x
SYMATTR InstName U15
SYMBOL Math2r 1184 560 R0
SYMATTR SpiceModel x
SYMATTR InstName U16
SYMBOL Math2r 1296 496 R0
SYMATTR InstName U17
SYMBOL Math2r 2064 304 R0
SYMATTR SpiceModel x
SYMATTR InstName U19
SYMBOL Math2r 2064 368 R0
SYMATTR SpiceModel x
SYMATTR InstName U20
SYMBOL Math2r 2176 304 R0
SYMATTR InstName U21
SYMATTR SpiceModel +
SYMBOL Math2r 2064 480 R0
SYMATTR SpiceModel x
SYMATTR InstName U22
SYMBOL Math2r 2064 544 R0
SYMATTR SpiceModel x
SYMATTR InstName U23
SYMBOL Math2r 2176 480 R0
SYMATTR InstName U24
SYMBOL Math2r 2320 304 R0
SYMATTR InstName U25
SYMATTR SpiceModel /
SYMBOL Math2r 2320 480 R0
SYMATTR SpiceModel /
SYMATTR InstName U26
SYMBOL Math2r 2176 656 R0
SYMATTR SpiceModel +
SYMATTR InstName U27
SYMBOL Math2r 3008 320 R0
SYMATTR SpiceModel x
SYMATTR InstName U28
SYMBOL Math2r 3008 384 R0
SYMATTR SpiceModel x
SYMATTR InstName U29
SYMBOL Math2r 3008 448 R0
SYMATTR SpiceModel x
SYMATTR InstName U30
SYMBOL 3ph_gen -128 -272 R0
SYMATTR InstName Ug
SYMATTR Value sym=0 f={f} amp=325 phi=0 Ro=0.1 N=7
SYMATTR SpiceLine2 a=1 b=1 c=3 d=0 e=0 p=1 q=0 xp=1.618 xq=1
SYMBOL Isense 1088 -304 R0
SYMATTR InstName U9
SYMBOL g 496 -128 R0
WINDOW 0 5 8 Left 2
WINDOW 3 9 103 Left 2
SYMATTR InstName Ga
SYMATTR Value 1
SYMBOL g 592 -16 R0
WINDOW 0 6 6 Left 2
WINDOW 3 5 102 Left 2
SYMATTR InstName Gb
SYMATTR Value 1
SYMBOL g 688 96 R0
WINDOW 0 3 1 Left 2
WINDOW 3 8 99 Left 2
SYMATTR InstName Gc
SYMATTR Value 1
SYMBOL Cable 384 -256 R0
SYMATTR InstName Ucin
SYMATTR SpiceLine phi=2m  f=50  len=1  CuAl=1
SYMATTR SpiceLine2 Space=5m  Dins=6m  TriPlan=1  T=27
SYMBOL Cable 880 -256 R0
SYMATTR InstName Ucout
SYMATTR SpiceLine phi=2m  f=50  len=20  CuAl=1
SYMATTR SpiceLine2 Space=5m  Dins=6m  TriPlan=1  T=27
SYMBOL cap -256 -256 R0
SYMATTR InstName C3
SYMATTR Value 1n
SYMATTR SpiceLine Rser=1 Rpar=1e6
SYMBOL cap 512 -128 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C4
SYMATTR Value 1n
SYMBOL cap 608 -48 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C5
SYMATTR Value 1n
SYMBOL cap 704 64 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C6
SYMATTR Value 1n
SYMBOL cap 864 64 R0
SYMATTR InstName C7
SYMATTR Value 1n
SYMATTR SpiceLine Rser=1 Rpar=1e6
SYMBOL voltage 2944 480 R0
SYMATTR InstName V1
SYMATTR Value pulse 0 1 {start} 0.1m rser=1 cpar=0.1m
SYMBOL BrdgRect 1344 -112 R0
SYMATTR InstName U1
SYMATTR SpiceLine2 Rs=10meg Cs=1n
SYMBOL ind 1456 -160 R0
SYMATTR InstName L1
SYMATTR Value 100m rser=10
SYMATTR SpiceLine Rpar=10k
SYMBOL BrdgRect 1344 -272 R0
SYMATTR InstName U7
SYMATTR SpiceLine2 Rs=10meg Cs=1n
SYMBOL cap 1456 -288 R0
SYMATTR InstName C1
SYMATTR Value 1m rser=1 rpar=20
SYMBOL Isense 1152 -272 R0
SYMATTR InstName U10
SYMBOL Isense 1216 -240 R0
SYMATTR InstName U31
SYMBOL Vsense -224 400 R0
SYMATTR InstName U3
SYMBOL Vsense -224 480 R0
SYMATTR InstName U4
SYMBOL Isense 0 -304 R0
SYMATTR InstName U32
SYMBOL Isense 64 -272 R0
SYMATTR InstName U33
SYMBOL Isense 128 -240 R0
SYMATTR InstName U34
SYMBOL Math2r 2064 656 R0
SYMATTR SpiceModel x
SYMATTR InstName U35
SYMBOL Math2r 2064 752 R0
SYMATTR SpiceModel x
SYMATTR InstName U36
SYMBOL Math2r 1872 -176 R0
SYMATTR SpiceModel x
SYMATTR InstName U37
SYMBOL Math2r 1872 -96 R0
SYMATTR SpiceModel x
SYMATTR InstName U38
SYMBOL Math2r 1872 -16 R0
SYMATTR SpiceModel x
SYMATTR InstName U39
SYMBOL Math2r 2400 -176 R0
SYMATTR SpiceModel x
SYMATTR InstName U41
SYMBOL Math2r 2400 -96 R0
SYMATTR SpiceModel x
SYMATTR InstName U42
SYMBOL Math2r 2400 -16 R0
SYMATTR SpiceModel x
SYMATTR InstName U43
SYMBOL Filter 672 320 R0
WINDOW 38 -10 48 Center 2
SYMATTR SpiceModel RRS
SYMATTR SpiceLine2 G=1 Asc=3 Ap=1 As=40 N=20
SYMATTR SpiceLine f0=50*20 fp1=10 fs1=200 fp2=0 fs2=0
SYMATTR InstName U45
SYMATTR Value2 Win=1 Choice=0 sim=1 test=0 SH=0 Fact=1
SYMBOL Math5 1984 -96 R0
SYMATTR InstName U40
SYMBOL Math5 2512 -96 R0
SYMATTR InstName U44
SYMBOL Math2r 864 320 R0
SYMATTR SpiceModel x
SYMATTR InstName U46
SYMBOL Math2r 864 432 R0
SYMATTR SpiceModel x
SYMATTR InstName U47
SYMBOL SpecialFunctions\\modulate2 448 576 R0
WINDOW 3 16 -26 Left 2
SYMATTR Value mark={f} space=0
SYMATTR InstName A1
SYMBOL Gain 656 640 R0
SYMATTR InstName U48
SYMBOL Misc\\jumper 1632 512 R0
WINDOW 0 1 71 Invisible 2
SYMATTR InstName X2
SYMBOL Math2r 1184 320 R0
SYMATTR SpiceModel x
SYMATTR InstName U49
SYMBOL Math2r 1184 384 R0
SYMATTR SpiceModel x
SYMATTR InstName U50
SYMBOL Math2r 1296 320 R0
SYMATTR SpiceModel +
SYMATTR InstName U51
SYMBOL Math2r 1760 320 R0
SYMATTR InstName U18
SYMBOL voltage 352 560 R0
SYMATTR InstName V2
SYMATTR Value pulse 0 1 0 1u
TEXT 1704 -392 Left 2 !.param f=50 start=96m
TEXT 1704 -432 Left 2 !.tran .2 uic
TEXT -328 744 Left 2 ;Isolated\ntransducers\nfor voltage\ndetection.
TEXT -88 792 Left 2 ;The Clarke matrices for\nvoltage and currents.
TEXT 288 792 Left 2 ;The power calculations as defined\nby Akagi.
TEXT 1472 768 Left 2 ;Selection of powers to be\ncompensated. Here, only\noscillating real power is chosen.
TEXT 1912 824 Left 2 ;Inverse power matrices for alpha/beta components.
TEXT 2600 768 Left 2 ;Inverse matrix for compensated\ncurrents. I1 determines the start\ntime of the APF.
TEXT 688 -648 Left 5 ;Shunt Active Power Filter
TEXT 832 -592 Left 2 ;(p-q theory, sinusoidal strategy)
TEXT -304 -112 Left 2 ;Grid side. 3rd, 5th and 7th\nharmonics present. Add\ndifferent unbalance\nconditions to see how the\nresult is affected.
TEXT 312 -384 Left 2 ;1m of cables from\ngrid to APF...
TEXT 720 -376 Left 2 ;...the rest 20m go\naround the house.
TEXT 216 80 Left 2 ;Since this is a cvasi-\nideal schematic,\nreactive storage\ndevices or switching\nbridges are represented\nby current sources.
TEXT 1032 -432 Left 2 ;An unbalanced, nonlinear load.
TEXT 560 424 Left 2 ;.ic v(p)=0
TEXT 1976 72 Left 2 ;Input and output powers. Because the\ncompensation is for balanced currents,\nthe input power still has oscillating\ncomponents (voltages are untouched).
LINE Normal 2800 256 -352 256
LINE Normal 3296 304 3296 272
LINE Normal 3248 304 3296 304
LINE Normal 3248 432 3248 304
LINE Normal 3296 432 3248 432
LINE Normal 3296 464 3296 432
LINE Normal 3392 368 3296 464
LINE Normal 3296 272 3392 368
LINE Normal 64 80 64 48
LINE Normal 16 80 64 80
LINE Normal 16 208 16 80
LINE Normal 64 208 16 208
LINE Normal 64 240 64 208
LINE Normal 160 144 64 240
LINE Normal 64 48 160 144
RECTANGLE Normal -112 848 -336 272 2
RECTANGLE Normal 256 848 -96 272 2
RECTANGLE Normal 992 848 272 272 2
RECTANGLE Normal 1888 848 1456 272 2
RECTANGLE Normal 2576 848 1904 272 2
RECTANGLE Normal 3232 848 2592 272 2
RECTANGLE Normal 176 32 -320 -464 2
RECTANGLE Normal 992 -192 192 -464 2
RECTANGLE Normal 992 240 192 -176 2
RECTANGLE Normal 1672 240 1008 -464 2
RECTANGLE Normal 1440 848 1008 272 2
