Version 4
SHEET 1 3480 916
WIRE -64 -304 -112 -304
WIRE 256 -304 0 -304
WIRE 320 -304 256 -304
WIRE 512 -304 480 -304
WIRE 816 -304 512 -304
WIRE 1056 -304 976 -304
WIRE 1280 -304 1120 -304
WIRE 1328 -304 1280 -304
WIRE 1520 -304 1392 -304
WIRE 1520 -288 1520 -304
WIRE -272 -272 -336 -272
WIRE -208 -272 -272 -272
WIRE 0 -272 -112 -272
WIRE 256 -272 64 -272
WIRE 320 -272 256 -272
WIRE 608 -272 480 -272
WIRE 816 -272 608 -272
WIRE 1120 -272 976 -272
WIRE 1280 -272 1184 -272
WIRE 1328 -272 1280 -272
WIRE -272 -240 -272 -272
WIRE 64 -240 -112 -240
WIRE 256 -240 128 -240
WIRE 320 -240 256 -240
WIRE 704 -240 480 -240
WIRE 816 -240 704 -240
WIRE 1184 -240 976 -240
WIRE 1280 -240 1248 -240
WIRE 1296 -240 1280 -240
WIRE 1328 -240 1296 -240
WIRE 1424 -240 1392 -240
WIRE 320 -208 272 -208
WIRE 800 -208 480 -208
WIRE 816 -208 800 -208
WIRE 1072 -208 1072 -288
WIRE 1136 -208 1136 -256
WIRE 1200 -208 1200 -224
WIRE 1424 -208 1424 -240
WIRE 1520 -208 1520 -224
WIRE -48 -160 -48 -288
WIRE 16 -160 16 -256
WIRE 80 -160 80 -224
WIRE 976 -144 976 -208
WIRE 1296 -144 1296 -240
WIRE 1328 -144 1296 -144
WIRE 1424 -144 1392 -144
WIRE 1520 -144 1424 -144
WIRE 512 -112 512 -304
WIRE 1888 -112 1840 -112
WIRE 2000 -112 1968 -112
WIRE 2416 -112 2368 -112
WIRE 2528 -112 2496 -112
WIRE 1328 -80 1312 -80
WIRE 1424 -80 1392 -80
WIRE 1920 -80 1840 -80
WIRE 2448 -80 2368 -80
WIRE 2000 -64 2000 -112
WIRE 2528 -64 2528 -112
WIRE 1424 -48 1424 -80
WIRE 1520 -48 1520 -64
WIRE 1312 -32 1312 -80
WIRE 1888 -32 1840 -32
WIRE 2000 -32 1968 -32
WIRE 2128 -32 2080 -32
WIRE 2416 -32 2368 -32
WIRE 2528 -32 2496 -32
WIRE 2656 -32 2608 -32
WIRE 608 0 608 -272
WIRE 1920 0 1840 0
WIRE 2448 0 2368 0
WIRE 1888 48 1840 48
WIRE 2000 48 2000 0
WIRE 2000 48 1968 48
WIRE 2416 48 2368 48
WIRE 2528 48 2528 0
WIRE 2528 48 2496 48
WIRE 1920 80 1840 80
WIRE 2448 80 2368 80
WIRE 704 112 704 -240
WIRE 512 224 512 -32
WIRE 608 224 608 80
WIRE 608 224 512 224
WIRE 704 224 704 192
WIRE 704 224 608 224
WIRE 800 224 800 -208
WIRE 800 224 704 224
WIRE -112 304 -144 304
WIRE 32 304 0 304
WIRE 400 304 336 304
WIRE 528 304 464 304
WIRE 1184 304 1008 304
WIRE 1328 304 1264 304
WIRE -112 336 -144 336
WIRE 32 336 0 336
WIRE 880 336 848 336
WIRE 1008 336 1008 304
WIRE 1008 336 992 336
WIRE 1216 336 1152 336
WIRE -112 368 -144 368
WIRE 32 368 0 368
WIRE 880 368 848 368
WIRE 1184 368 992 368
WIRE 1328 368 1264 368
WIRE 304 384 272 384
WIRE 464 384 304 384
WIRE 592 384 544 384
WIRE -80 400 -80 384
WIRE 880 400 848 400
WIRE 1008 400 992 400
WIRE 1152 400 1152 336
WIRE 1216 400 1152 400
WIRE 304 432 304 384
WIRE 336 432 304 432
WIRE 496 432 496 416
WIRE 496 432 448 432
WIRE 912 432 912 416
WIRE 1008 432 1008 400
WIRE 1184 432 1008 432
WIRE 1328 432 1264 432
WIRE -80 448 -80 400
WIRE -80 448 -128 448
WIRE 1152 464 1152 400
WIRE 1216 464 1152 464
WIRE 1152 496 1152 464
WIRE 400 592 336 592
WIRE 528 592 464 592
FLAG 256 -304 a
FLAG 256 -272 b
FLAG 256 -240 c
FLAG -336 -272 nul
FLAG 1104 -288 0
FLAG 1072 -208 ia
FLAG 1168 -256 0
FLAG 1136 -208 ib
FLAG 1232 -224 0
FLAG 1200 -208 ic
FLAG -144 304 ia
FLAG -144 336 ib
FLAG -144 368 ic
FLAG 32 304 d
FLAG 32 336 q
FLAG 32 368 O
FLAG 272 384 q
FLAG 336 304 d
FLAG 336 592 O
FLAG 592 384 q`
FLAG 528 304 d`
FLAG 528 592 O`
FLAG 1328 304 ia`
FLAG 1328 368 ib`
FLAG 1328 432 ic`
FLAG 464 -96 ia`
FLAG 560 16 ib`
FLAG 656 128 ic`
FLAG 464 -48 0
FLAG 560 64 0
FLAG 656 176 0
FLAG 512 -304 PCC1
FLAG 608 -272 PCC2
FLAG 704 -240 PCC3
FLAG 272 -208 nul
FLAG 976 -144 COM
FLAG 800 -208 PCCN
FLAG -272 -176 0
FLAG -80 400 wt
FLAG 912 432 wt
FLAG 1312 -32 COM
FLAG 336 464 0
FLAG 1152 576 0
FLAG 1520 -48 0
FLAG 848 336 d`
FLAG 848 368 q`
FLAG 848 400 O`
FLAG 1424 -48 0
FLAG 1520 -208 0
FLAG 1424 -208 0
FLAG 2128 -32 power_in
FLAG 2656 -32 power_out
FLAG 1840 -112 a
FLAG 1840 -80 ina
FLAG 1840 -32 b
FLAG 1840 0 inb
FLAG 1840 48 c
FLAG 1840 80 inc
FLAG 2032 -64 0
FLAG 2032 0 0
FLAG 2368 -112 _a
FLAG 2368 -32 _b
FLAG 2368 48 _c
FLAG 2560 -64 0
FLAG 2560 0 0
FLAG 2368 -80 ia
FLAG 2368 0 ib
FLAG 2368 80 ic
FLAG -16 -288 0
FLAG -48 -160 ina
FLAG 48 -256 0
FLAG 16 -160 inb
FLAG 112 -224 0
FLAG 80 -160 inc
FLAG 1280 -304 _a
FLAG 1280 -272 _b
FLAG 1280 -240 _c
SYMBOL 3ph_gen -160 -272 R0
SYMATTR InstName U1
SYMATTR Value sym=0 f={f} amp=325 phi=0 Ro=0.1 N=7
SYMATTR SpiceLine2 a=1 b=1 c=3 d=0 e=0 p=1 q=0 xp=1.618 xq=1
SYMBOL Isense 1088 -304 R0
SYMATTR InstName U7
SYMBOL Misc\\jumper 432 240 R0
WINDOW 0 1 71 Invisible 2
SYMATTR InstName X1
SYMBOL Misc\\jumper 432 528 R0
WINDOW 0 1 71 Invisible 2
SYMATTR InstName X2
SYMBOL g 512 -128 R0
WINDOW 0 5 8 Left 2
WINDOW 3 9 103 Left 2
SYMATTR InstName Ga
SYMATTR Value 1
SYMBOL g 608 -16 R0
WINDOW 0 6 6 Left 2
WINDOW 3 5 102 Left 2
SYMATTR InstName Gb
SYMATTR Value 1
SYMBOL g 704 96 R0
WINDOW 0 3 1 Left 2
WINDOW 3 8 99 Left 2
SYMATTR InstName Gc
SYMATTR Value 1
SYMBOL Cable 400 -256 R0
SYMATTR InstName U34
SYMATTR SpiceLine phi=2m  f=50  len=1  CuAl=1
SYMATTR SpiceLine2 Space=5m  Dins=6m  TriPlan=1  T=27
SYMBOL Cable 896 -256 R0
SYMATTR InstName U35
SYMATTR SpiceLine phi=2m f=50 len=20 CuAl=1
SYMATTR SpiceLine2 Space=5m Dins=6m TriPlan=1 T=27
SYMBOL BrdgRect 1360 -112 R0
SYMATTR InstName U36
SYMATTR SpiceLine2 Rs=10meg Cs=1n
SYMBOL cap -256 -240 M0
SYMATTR InstName C7
SYMATTR Value 1n
SYMATTR SpiceLine Rser=1 Rpar=1e6
SYMBOL Filter 400 432 R0
SYMATTR SpiceLine2 G=1 Asc=3 Ap=1 As=40 N=4
SYMATTR SpiceLine f0=10k fp1=20 fs1=200 fp2=0 fs2=0
SYMATTR InstName U15
SYMBOL Transforms -64 336 R0
SYMATTR SpiceModel abc/dq0
SYMATTR InstName U4
SYMBOL Transforms 928 368 R0
SYMATTR SpiceModel dq0/abc
SYMATTR InstName U5
SYMBOL Math2r 496 384 R0
SYMATTR InstName U12
SYMBOL Math2r 1216 304 R0
SYMATTR SpiceModel x
SYMATTR InstName U11
SYMBOL Math2r 1216 368 R0
SYMATTR SpiceModel x
SYMATTR InstName U13
SYMBOL Math2r 1216 432 R0
SYMATTR SpiceModel x
SYMATTR InstName U14
SYMBOL voltage 1152 480 R0
SYMATTR InstName V1
SYMATTR Value pulse 0 1 {start} 0.1m rser=1 cpar=0.1m
SYMBOL wt -144 448 R0
SYMATTR SpiceLine f={f} phi=0
SYMATTR InstName U2
SYMBOL Isense 1152 -272 R0
SYMATTR InstName U3
SYMBOL Isense 1216 -240 R0
SYMATTR InstName U9
SYMBOL diode 1408 -80 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL ind 1504 -160 R0
SYMATTR InstName L1
SYMATTR Value 100m rser=10
SYMATTR SpiceLine Rpar=10k
SYMBOL BrdgRect 1360 -272 R0
SYMATTR InstName U6
SYMATTR SpiceLine2 Rs=10meg Cs=1n
SYMBOL cap 1504 -288 R0
SYMATTR InstName C3
SYMATTR Value 1m rser=1 rpar=20
SYMBOL Math2r 1920 -112 R0
SYMATTR SpiceModel x
SYMATTR InstName U10
SYMBOL Math2r 1920 -32 R0
SYMATTR SpiceModel x
SYMATTR InstName U16
SYMBOL Math2r 1920 48 R0
SYMATTR SpiceModel x
SYMATTR InstName U17
SYMBOL Math2r 2448 -112 R0
SYMATTR SpiceModel x
SYMATTR InstName U18
SYMBOL Math2r 2448 -32 R0
SYMATTR SpiceModel x
SYMATTR InstName U19
SYMBOL Math2r 2448 48 R0
SYMATTR SpiceModel x
SYMATTR InstName U20
SYMBOL Math5 2032 -32 R0
SYMATTR InstName U21
SYMBOL Math5 2560 -32 R0
SYMATTR InstName U22
SYMBOL Isense -32 -304 R0
SYMATTR InstName U8
SYMBOL Isense 32 -272 R0
SYMATTR InstName U23
SYMBOL Isense 96 -240 R0
SYMATTR InstName U24
TEXT -104 -520 Left 2 !.param f=50 start=96m
TEXT -104 -560 Left 2 !.tran .2
TEXT -432 -112 Left 2 ;Grid side. 3rd, 5th and 7th\nharmonics present. Add\ndifferent unbalance\nconditions to see how the\nresult is affected.
TEXT 328 -384 Left 2 ;1m of cables from\ngrid to APF...
TEXT 736 -376 Left 2 ;...the rest 20m go\naround the house.
TEXT 232 80 Left 2 ;Since this is a cvasi-\nideal schematic,\nreactive storage\ndevices or switching\nbridges are represented\nby current sources.
TEXT 1048 192 Left 2 ;An unbalanced, linear\nand nonlinear load.
TEXT -176 696 Left 2 ;The Park matrix\nfor currents.
TEXT 216 648 Left 2 ;Selection of powers to be\ncompensated. Here, only\noscillating real power is chosen.\nThe .ic is needed for the filter.
TEXT 696 672 Left 2 ;Inverse matrix for compensated\ncurrents. The conditional B-source\ndetermines the start for the APF
TEXT 688 -648 Left 5 ;Shunt Active Power Filter
TEXT 688 -576 Left 2 ;(based on the d-q theory, compensation of power; it can fully\ncompensate the power, instead it is sensitive to imbalance and distortions)
TEXT 248 488 Left 2 ;Bessel for lowest overshoot
TEXT 1208 104 Left 2 !.model d d ron=0.1 roff=10meg vfwd=0.7 vrev=1k\n+ epsilon=0.1 revepsilon=0.1
LINE Normal 1728 256 -256 256
LINE Normal 1536 304 1536 272
LINE Normal 1488 304 1536 304
LINE Normal 1488 432 1488 304
LINE Normal 1536 432 1488 432
LINE Normal 1536 464 1536 432
LINE Normal 1632 368 1536 464
LINE Normal 1536 272 1632 368
LINE Normal 80 80 80 48
LINE Normal 32 80 80 80
LINE Normal 32 208 32 80
LINE Normal 80 208 32 208
LINE Normal 80 240 80 208
LINE Normal 176 144 80 240
LINE Normal 80 48 176 144
RECTANGLE Normal 192 32 -448 -464 2
RECTANGLE Normal 1008 -192 208 -464 2
RECTANGLE Normal 1008 240 208 -176 2
RECTANGLE Normal 1704 240 1024 -464 2
RECTANGLE Normal 192 752 -240 272 2
RECTANGLE Normal 672 752 208 272 2
RECTANGLE Normal 1472 752 688 272 2
