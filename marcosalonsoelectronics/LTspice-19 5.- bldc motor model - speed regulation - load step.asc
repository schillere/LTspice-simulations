Version 4
SHEET 1 3328 1812
WIRE -368 -416 -640 -416
WIRE -96 -416 -368 -416
WIRE 160 -416 -96 -416
WIRE -368 -352 -368 -416
WIRE -288 -352 -368 -352
WIRE -96 -352 -96 -416
WIRE -16 -352 -96 -352
WIRE 160 -352 160 -416
WIRE 240 -352 160 -352
WIRE -288 -336 -288 -352
WIRE -16 -336 -16 -352
WIRE 240 -336 240 -352
WIRE -416 -304 -448 -304
WIRE -144 -304 -176 -304
WIRE 112 -304 80 -304
WIRE -288 -256 -288 -272
WIRE -288 -256 -368 -256
WIRE -16 -256 -16 -272
WIRE -16 -256 -96 -256
WIRE 240 -256 240 -272
WIRE 240 -256 160 -256
WIRE 1200 -256 1008 -256
WIRE 1232 -256 1200 -256
WIRE -368 -224 -368 -256
WIRE -320 -224 -368 -224
WIRE -224 -224 -320 -224
WIRE 656 -224 -192 -224
WIRE 1200 -224 1008 -224
WIRE 1232 -224 1200 -224
WIRE 656 -176 512 -176
WIRE 1200 -176 1008 -176
WIRE 1328 -176 1200 -176
WIRE 1472 -176 1392 -176
WIRE -640 -144 -640 -416
WIRE -240 -144 -272 -144
WIRE -208 -144 -208 -208
WIRE -208 -144 -240 -144
WIRE 656 -128 576 -128
WIRE 1200 -128 1008 -128
WIRE 1232 -128 1200 -128
WIRE -96 -96 -96 -256
WIRE -16 -96 -96 -96
WIRE 64 -96 -16 -96
WIRE 512 -96 512 -176
WIRE 512 -96 96 -96
WIRE 1200 -96 1008 -96
WIRE 1232 -96 1200 -96
WIRE 656 -80 624 -80
WIRE 48 -48 16 -48
WIRE 80 -48 80 -80
WIRE 80 -48 48 -48
WIRE 160 32 160 -256
WIRE 272 32 160 32
WIRE 368 32 272 32
WIRE 576 32 576 -128
WIRE 576 32 400 32
WIRE -368 64 -368 -224
WIRE -288 64 -368 64
WIRE -96 64 -96 -96
WIRE -32 64 -96 64
WIRE 160 64 160 32
WIRE 224 64 160 64
WIRE -288 80 -288 64
WIRE -32 80 -32 64
WIRE 224 80 224 64
WIRE 352 80 304 80
WIRE 384 80 384 48
WIRE 384 80 352 80
WIRE -416 112 -448 112
WIRE -144 112 -176 112
WIRE 112 112 80 112
WIRE -288 160 -288 144
WIRE -288 160 -368 160
WIRE -32 160 -32 144
WIRE -32 160 -96 160
WIRE 224 160 224 144
WIRE 224 160 160 160
WIRE 352 160 304 160
WIRE 624 160 624 -80
WIRE 624 160 432 160
WIRE 720 208 688 208
WIRE 752 208 720 208
WIRE 688 224 688 208
WIRE -640 240 -640 -64
WIRE -368 240 -368 160
WIRE -368 240 -640 240
WIRE -96 240 -96 160
WIRE -96 240 -368 240
WIRE 160 240 160 160
WIRE 160 240 -96 240
WIRE 688 256 608 256
WIRE 720 256 720 208
WIRE 752 256 752 208
WIRE 848 256 848 -64
WIRE 880 256 880 -64
WIRE 912 256 912 -64
WIRE -96 304 -96 240
WIRE 224 432 -288 432
WIRE 304 432 304 160
WIRE 304 432 224 432
WIRE 512 464 432 464
WIRE 848 464 848 448
WIRE 848 464 576 464
WIRE -288 480 -288 432
WIRE 720 480 720 448
WIRE 720 480 576 480
WIRE 416 544 288 544
WIRE 224 560 128 560
WIRE 320 560 288 560
WIRE 416 560 416 544
WIRE 512 560 416 560
WIRE 880 560 880 448
WIRE 880 560 576 560
WIRE 752 576 752 448
WIRE 752 576 576 576
WIRE -288 608 -288 560
WIRE 512 656 432 656
WIRE 912 656 912 448
WIRE 912 656 576 656
WIRE 880 672 880 560
WIRE 880 672 576 672
WIRE -288 736 -288 688
WIRE 416 736 288 736
WIRE 224 752 128 752
WIRE 320 752 320 560
WIRE 320 752 288 752
WIRE 416 752 416 736
WIRE 512 752 416 752
WIRE 720 752 720 480
WIRE 720 752 576 752
WIRE 688 768 688 448
WIRE 688 768 576 768
WIRE 512 848 432 848
WIRE 752 848 752 576
WIRE 752 848 576 848
WIRE 688 864 688 768
WIRE 688 864 576 864
WIRE 416 928 288 928
WIRE 224 944 128 944
WIRE 320 944 320 752
WIRE 320 944 288 944
WIRE 416 944 416 928
WIRE 512 944 416 944
WIRE 912 944 912 656
WIRE 912 944 576 944
WIRE 848 960 848 464
WIRE 848 960 576 960
WIRE 688 1008 688 864
WIRE 720 1008 720 752
WIRE 752 1008 752 848
WIRE 784 1008 784 448
WIRE 816 1008 816 448
WIRE 848 1008 848 960
WIRE 880 1008 880 672
WIRE 912 1008 912 944
WIRE 608 1120 480 1120
WIRE 656 1120 608 1120
WIRE 320 1136 320 944
WIRE 368 1136 320 1136
WIRE 416 1136 368 1136
WIRE 544 1152 480 1152
WIRE 576 1152 544 1152
WIRE 896 1200 768 1200
WIRE 1088 1200 976 1200
WIRE 768 1280 768 1200
WIRE 800 1280 768 1280
WIRE 976 1280 864 1280
WIRE 1088 1280 1088 1200
WIRE 1088 1280 1056 1280
WIRE 1088 1328 1088 1280
WIRE 1088 1328 960 1328
WIRE 1152 1328 1088 1328
WIRE 1392 1328 1232 1328
WIRE 1472 1328 1472 -176
WIRE 1472 1328 1392 1328
WIRE 576 1344 576 1152
WIRE 608 1344 576 1344
WIRE 768 1344 768 1280
WIRE 768 1344 672 1344
WIRE 800 1344 768 1344
WIRE 896 1344 800 1344
WIRE 1088 1360 960 1360
WIRE 1088 1424 1088 1360
WIRE 1168 1424 1088 1424
WIRE 1280 1424 1168 1424
FLAG -96 304 0
FLAG 688 224 0
FLAG -320 -224 Pha
FLAG -16 -96 Phb
FLAG 272 32 Phc
FLAG 1200 -256 nr
FLAG 1200 -176 wrpm
FLAG 1200 -224 thetarot
FLAG -240 -144 ia
FLAG 1200 -128 w
FLAG 1200 -96 Te
FLAG 432 464 g0
IOPIN 432 464 Out
FLAG 128 560 g1
IOPIN 128 560 Out
FLAG 432 656 g2
IOPIN 432 656 Out
FLAG 128 752 g3
IOPIN 128 752 Out
FLAG 432 848 g4
IOPIN 432 848 Out
FLAG 128 944 g5
IOPIN 128 944 Out
FLAG -448 112 g0
IOPIN -448 112 In
FLAG -448 -304 g1
IOPIN -448 -304 In
FLAG -176 -304 g3
IOPIN -176 -304 In
FLAG 80 -304 g5
IOPIN 80 -304 In
FLAG -176 112 g2
IOPIN -176 112 In
FLAG 80 112 g4
IOPIN 80 112 In
FLAG 224 432 Tload
FLAG 48 -48 ib
FLAG 352 80 ic
FLAG 368 1136 pwm
FLAG 1392 1328 sens
FLAG 1168 1424 ref
FLAG 544 1152 comp
FLAG 608 1120 tri
FLAG 800 1344 opa
FLAG -288 736 0
SYMBOL Control\\switch -368 -304 R0
WINDOW 0 -62 -39 Left 2
SYMATTR InstName Us1
SYMBOL Control\\switch -368 112 R0
WINDOW 0 -69 -36 Left 2
SYMATTR InstName Us0
SYMBOL Control\\switch -96 -304 R0
WINDOW 0 -59 -46 Left 2
SYMATTR InstName Us3
SYMBOL Control\\switch -96 112 R0
WINDOW 0 -65 -43 Left 2
SYMATTR InstName Us2
SYMBOL Control\\switch 160 -304 R0
WINDOW 0 -66 -45 Left 2
SYMATTR InstName Us5
SYMBOL Control\\switch 160 112 R0
WINDOW 0 -67 -50 Left 2
SYMATTR InstName Us4
SYMBOL voltage -640 -160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vdc
SYMATTR Value 10
SYMBOL 74HC\\74hc138 976 352 R90
SYMATTR InstName U5
SYMBOL Control\\constant 576 256 R0
WINDOW 3 -5 68 Bottom 2
WINDOW 0 -15 -42 Bottom 2
SYMATTR Value K=5
SYMATTR InstName U3
SYMBOL Digital\\and 544 544 R180
WINDOW 0 3 109 Left 2
SYMATTR InstName A0
SYMBOL Digital\\and 544 640 R180
WINDOW 0 -2 115 Left 2
SYMATTR InstName A1
SYMBOL Control\\idiode -272 -272 R180
SYMATTR InstName Ud1
SYMBOL Control\\idiode -272 144 R180
SYMATTR InstName Ud0
SYMBOL Control\\idiode -16 144 R180
SYMATTR InstName Ud2
SYMBOL Control\\idiode 0 -272 R180
SYMATTR InstName Ud3
SYMBOL Control\\idiode 256 -272 R180
SYMATTR InstName Ud5
SYMBOL Control\\idiode 240 144 R180
SYMATTR InstName Ud4
SYMBOL BLDCM\\bldcm 800 -176 R0
WINDOW 3 6 -192 Bottom 2
WINDOW 123 4 -160 Bottom 2
WINDOW 39 28 -125 Bottom 2
WINDOW 0 -69 -78 Bottom 2
WINDOW 38 86 -81 Bottom 2
SYMATTR InstName U2
SYMBOL Control\\isense -208 -224 R0
WINDOW 0 28 -13 Bottom 2
WINDOW 3 32 36 Bottom 2
SYMATTR InstName U1
SYMBOL Digital\\and 544 736 R180
WINDOW 0 -2 115 Left 2
SYMATTR InstName A2
SYMBOL Digital\\and 544 832 R180
WINDOW 0 -2 115 Left 2
SYMATTR InstName A3
SYMBOL Digital\\and 544 928 R180
WINDOW 0 -2 115 Left 2
SYMATTR InstName A4
SYMBOL Digital\\and 544 1024 R180
WINDOW 0 -2 115 Left 2
SYMATTR InstName A5
SYMBOL Control\\isense 80 -96 R0
WINDOW 0 28 -13 Bottom 2
WINDOW 3 32 36 Bottom 2
SYMATTR InstName U6
SYMBOL Control\\isense 384 32 R0
WINDOW 0 28 -13 Bottom 2
WINDOW 3 32 36 Bottom 2
SYMATTR InstName U7
SYMBOL Control\\sawtooth 688 1120 M0
WINDOW 3 -139 -5 Bottom 2
WINDOW 123 -91 32 Bottom 2
SYMATTR Value2 f=10k
SYMATTR InstName U9
SYMBOL Control\\comp 448 1136 R180
WINDOW 3 25 -53 Left 2
WINDOW 123 25 -81 Left 2
SYMATTR Value Vhigh=1
SYMATTR Value2 Vlow=0
SYMATTR InstName U10
SYMBOL Digital\\and 256 608 R180
WINDOW 0 3 109 Left 2
SYMATTR InstName A6
SYMBOL Digital\\and 256 800 R180
WINDOW 0 3 109 Left 2
SYMATTR InstName A7
SYMBOL Digital\\and 256 992 R180
WINDOW 0 3 109 Left 2
SYMATTR InstName A8
SYMBOL Control\\gain 1360 -176 R0
WINDOW 3 3 71 Bottom 2
SYMATTR Value A=1e-3
SYMATTR InstName U12
SYMBOL MyOpamp 928 1344 R180
WINDOW 39 50 -63 Center 2
WINDOW 40 58 -86 Center 2
WINDOW 0 3 37 Left 2
WINDOW 38 16 -32 Left 2
SYMATTR InstName U8
SYMBOL cap 864 1264 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 10n
SYMBOL res 1072 1264 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 24.9k
SYMBOL res 1248 1312 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 13.3k
SYMBOL Control\\constant 1312 1424 M0
WINDOW 38 -95 -35 Bottom 2
WINDOW 3 -85 10 Bottom 2
SYMATTR Value K=1.7
SYMATTR InstName U11
SYMBOL Control\\limiter 640 1344 M0
WINDOW 0 56 39 Bottom 2
WINDOW 38 -22 -37 Bottom 2
WINDOW 3 -10 69 Bottom 2
WINDOW 123 3 97 Bottom 2
SYMATTR InstName U13
SYMATTR Value vth=0.95
SYMBOL res 992 1184 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 500k
SYMBOL res 448 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 1
SYMBOL voltage -288 464 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 45 32 Left 2
WINDOW 3 43 70 Left 2
SYMATTR InstName Tload1
SYMATTR Value 0.1
SYMBOL voltage -288 592 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 39 27 Left 2
WINDOW 3 40 65 Left 2
SYMATTR InstName Tstep1
SYMATTR Value PULSE(0 0.1 20m 0.1m 0.1m 1 2)
TEXT 344 -376 Left 2 !.tran 0 40m 0 uic
TEXT 960 368 Left 2 !.inc 74HC.lib
TEXT 344 -344 Left 2 !.options reltol=1
TEXT 744 360 Left 2 ;74HC138
