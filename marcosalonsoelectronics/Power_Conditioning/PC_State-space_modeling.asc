Version 4
SHEET 1 4544 680
WIRE 496 -400 416 -400
WIRE 560 -400 496 -400
WIRE 416 -352 416 -400
WIRE 496 -352 496 -400
WIRE 368 -336 304 -336
WIRE 368 -288 288 -288
WIRE -64 -240 -192 -240
WIRE 112 -240 16 -240
WIRE 304 -240 304 -336
WIRE 304 -240 208 -240
WIRE 320 -240 304 -240
WIRE 416 -240 416 -272
WIRE 416 -240 400 -240
WIRE 496 -240 496 -288
WIRE 496 -240 416 -240
WIRE 656 -240 496 -240
WIRE 1184 -240 768 -240
WIRE 1232 -240 1184 -240
WIRE 416 -208 416 -240
WIRE 496 -208 496 -240
WIRE 304 -192 304 -240
WIRE 368 -192 304 -192
WIRE 288 -144 288 -288
WIRE 368 -144 288 -144
WIRE 416 -96 416 -128
WIRE 496 -96 496 -144
WIRE 496 -96 416 -96
WIRE 560 -96 496 -96
WIRE -32 -64 -32 -208
WIRE 1040 -64 -32 -64
WIRE 1184 -64 1184 -240
WIRE 1184 -64 1120 -64
WIRE 496 0 416 0
WIRE 560 0 496 0
WIRE 416 32 416 0
WIRE 368 48 304 48
WIRE 496 48 496 0
WIRE 288 96 288 -144
WIRE 368 96 288 96
WIRE -192 144 -192 -240
WIRE -64 144 -192 144
WIRE 112 144 16 144
WIRE 304 144 304 48
WIRE 304 144 208 144
WIRE 320 144 304 144
WIRE 416 144 416 112
WIRE 416 144 400 144
WIRE 496 144 496 112
WIRE 496 144 416 144
WIRE 672 144 496 144
WIRE 816 144 752 144
WIRE 976 144 816 144
WIRE 1184 144 976 144
WIRE 1232 144 1184 144
WIRE 816 160 816 144
WIRE 976 160 976 144
WIRE 416 176 416 144
WIRE 304 192 304 144
WIRE 368 192 304 192
WIRE 496 192 496 144
WIRE 288 240 288 96
WIRE 368 240 288 240
WIRE 816 256 816 224
WIRE 976 256 976 240
WIRE 416 288 416 256
WIRE 496 288 496 256
WIRE 496 288 416 288
WIRE 560 288 496 288
WIRE -32 320 -32 176
WIRE 1040 320 -32 320
WIRE 1184 320 1184 144
WIRE 1184 320 1120 320
WIRE -192 416 -192 144
WIRE -192 448 -192 416
WIRE 832 448 800 448
WIRE 1072 448 1040 448
WIRE 288 464 288 240
FLAG -192 528 0
FLAG 816 256 0
FLAG 976 256 0
FLAG 1232 144 x
IOPIN 1232 144 Out
FLAG 1232 -240 y
IOPIN 1232 -240 Out
FLAG 288 544 0
FLAG 800 528 0
FLAG 832 448 DC+
FLAG 1040 528 0
FLAG 1072 448 DC-
FLAG 560 0 DC+
FLAG 560 288 DC-
FLAG 560 -400 DC+
FLAG 560 -96 DC-
FLAG -192 416 in
SYMBOL Math2r -32 -240 R0
SYMATTR InstName U1
SYMBOL PID 160 -240 R0
SYMATTR InstName U3
SYMATTR SpiceLine Kp=Kp  Ki=Ki
SYMBOL Math2r -32 144 R0
SYMATTR InstName U6
SYMBOL PID 160 144 R0
SYMATTR InstName U8
SYMATTR SpiceLine Kp=Kp  Ki=Ki
SYMBOL ind 656 160 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
WINDOW 39 -51 60 VTop 2
SYMATTR InstName L
SYMATTR Value {L} ic=0
SYMATTR SpiceLine Rser={RL}
SYMBOL cap 800 160 R0
WINDOW 0 43 2 Left 2
WINDOW 3 41 30 Left 2
WINDOW 39 23 63 Left 2
SYMATTR InstName C
SYMATTR Value {C} ic=0
SYMATTR SpiceLine Rser={RC}
SYMBOL res 960 144 R0
SYMATTR InstName R
SYMATTR Value {R}
SYMBOL voltage 288 448 R0
WINDOW 0 37 33 Left 2
WINDOW 3 18 12 Left 2
SYMATTR InstName V1
SYMATTR Value pulse -10 10 0 50u 50u 0 .1m
SYMBOL StateSpace 720 -240 R0
WINDOW 3 -70 49 Left 2
WINDOW 123 -71 79 Left 2
WINDOW 40 -73 110 Left 2
SYMATTR Value A11=0  A12=1  B11=0
SYMATTR Value2 A21=a21  A22=a22  B21=1
SYMATTR SpiceLine2 C11=c11 C12=c12 D11=0 ic1=0 ic2=0
SYMATTR SpiceLine A31=0  A32=0  A33=0  B31=0
SYMATTR SpiceModel 2nd
SYMATTR InstName U2
SYMBOL sw 416 128 M180
SYMATTR InstName S1p
SYMBOL sw 416 160 R0
SYMATTR InstName S1n
SYMBOL sw 416 -256 M180
SYMATTR InstName S2p
SYMBOL sw 416 -224 R0
SYMATTR InstName S2n
SYMBOL res 304 -224 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -26 58 VTop 2
SYMATTR InstName Rac1
SYMATTR Value 1Meg ac 1m
SYMBOL res 304 160 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -26 58 VTop 2
SYMATTR InstName Rac2
SYMATTR Value 1Meg ac 1m
SYMBOL voltage 800 432 R0
WINDOW 0 19 104 Left 2
WINDOW 3 -22 134 Left 2
SYMATTR InstName V2
SYMATTR Value 24 rser=1m cpar=1m
SYMBOL voltage 1040 432 R0
WINDOW 0 19 104 Left 2
WINDOW 3 -22 134 Left 2
SYMATTR InstName V3
SYMATTR Value -24 rser=1m cpar=1m
SYMBOL bi2 -192 448 R0
WINDOW 3 -63 110 Left 2
WINDOW 0 39 56 Left 2
WINDOW 123 32 81 Left 2
SYMATTR Value I=if(time<25m,cos(200*pi*time)/2,-cos(200*pi*time))
SYMATTR InstName B1
SYMATTR Value2 Rpar=20 Cpar=10p
SYMBOL voltage 1024 -64 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 VBottom 2
SYMATTR InstName V4
SYMATTR Value ac 1
SYMBOL voltage 1024 320 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 VBottom 2
SYMATTR InstName V5
SYMATTR Value ac 1
SYMBOL diode 480 -288 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL diode 480 -144 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMBOL diode 480 112 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMBOL diode 480 256 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
TEXT 1328 -416 Left 2 !.tran 50m uic
TEXT 1328 -360 Left 2 !.param  L=.64m  C=30u  R=10\n+  RL=0.1  RC=0.5\n+  Kp=5  Ki=5000
TEXT 1328 -248 Left 2 ;The Laplace transform is (counting only series parasitic resistances\nfor the reactive components):\n \n                     s*RC*R*C + R\n--------------------------------------------------------------------------\ns^2*( R*L*C + RC*L*C ) + s*( R*RC*C + L + RL*R*C + RL*RC*C ) + ( R + RL )\n(it can be done by hand but software like QsapecNG do help a lot)\n \nor, in terms of the general formula:\n \n      a1*s+a0\n---------------------\nb2*s^2+b1*s+b0\n \nSince this is a strictly-proper transfer function, we can use the first canonical form, for\nwhich the terms are, after dividing each with b2:
TEXT 1328 224 Left 2 !.param a21=- ( R+RL ) / ( L*C*( R+RC ) )\n.param a22=- ( R*C*( RC+RL) + L + RL*RC*C ) / ( L*C*( R+RC ) )\n.param c11=R/( L*C*( R+RC ) )\n.param c12=(Rc*R)/( L*(R+RC) )
TEXT 1328 -448 Left 2 ;.ac dec 1k 1 100k
TEXT 1328 352 Left 2 ;After running the simulation it can be seen that the two waveforms coincide, the minor\ndifferences being the real output impedance of the comparator directly driving the LC\nstage for the lower section, compared to the floating input of the state-space form of the\nother -- e.g. it's voltage-, not current-driven.\nIt can also be seen that the parasitic resistances are fortunate in that they behave like\ndamping devices to help stability -- albeit at a greater loss across the reactive elements.
TEXT 584 -608 Center 4 ;State-space modelling
TEXT 592 -568 Center 2 ;(a simple approach of an inverter's LC output filter)
TEXT -80 -440 Left 2 ;PI controller and\npower switch,\ncommon for both\nstages.
TEXT 624 -440 Left 2 ;State-space equivalent of an LC low-pass filter with load R.\nIt's a 2nd order transfer function, therefore the only valid\nparameters are:  [[A11,A12],[A21,A22]] , [[B11],[B21]],\n[C11,C12] and D11 (ic[1,2]=0 for this case).
TEXT 616 368 Left 2 ;The normal LC implementation.
TEXT -96 336 Left 2 !.model sw sw ron=1m roff=1meg vt=0 vh=-1m\n.model d d vfwd=0.7 ron=1m roff=1meg epsilon=0.1
TEXT 144 408 Left 2 ;(vh=0.1V =>\n1us dead-time)
TEXT 1680 -360 Left 2 ;L, C, R = filter's and load parameters\nRL, RC = parasitic resistances for L and C\nKp, Ki = proportional and integral gains of the PI(D) controllers
TEXT 1328 -488 Left 2 ;.save V(x) V(y) V(i)
RECTANGLE Normal 1296 16 608 -464 2
RECTANGLE Normal 1296 392 608 32 2
RECTANGLE Normal 592 392 -96 -464 2
