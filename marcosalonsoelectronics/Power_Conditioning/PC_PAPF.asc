Version 4
SHEET 1 5908 1172
WIRE 1504 -320 1392 -320
WIRE 1648 -320 1584 -320
WIRE 1776 -320 1648 -320
WIRE 1984 -320 1856 -320
WIRE 1648 -304 1648 -320
WIRE 1504 -256 1456 -256
WIRE 1520 -208 1520 -224
WIRE 1552 -208 1520 -208
WIRE -32 -96 -32 -224
WIRE -16 -96 -16 -192
WIRE 0 -96 0 -176
WIRE 16 -96 16 -144
WIRE 48 -96 48 -192
WIRE 64 -96 64 -160
WIRE 864 -96 864 -224
WIRE 880 -96 880 -192
WIRE 896 -96 896 -176
WIRE 912 -96 912 -144
WIRE 944 -96 944 -192
WIRE 960 -96 960 -160
WIRE 4112 -80 3824 -80
WIRE 4160 -80 4112 -80
WIRE -96 -64 -144 -64
WIRE -48 -64 -96 -64
WIRE 160 -64 80 -64
WIRE 240 -64 160 -64
WIRE 384 -64 320 -64
WIRE 560 -64 384 -64
WIRE 640 -64 560 -64
WIRE 848 -64 720 -64
WIRE 1024 -64 976 -64
WIRE 1280 -64 1088 -64
WIRE 1392 -64 1392 -320
WIRE 1392 -64 1280 -64
WIRE 1472 -64 1392 -64
WIRE 1504 -64 1472 -64
WIRE 3392 -64 3312 -64
WIRE 3520 -64 3488 -64
WIRE -48 -48 -48 -64
WIRE -16 -48 -48 -48
WIRE 848 -48 848 -64
WIRE 880 -48 848 -48
WIRE 3824 -48 3824 -80
WIRE -352 -32 -416 -32
WIRE -288 -32 -352 -32
WIRE -240 -32 -288 -32
WIRE -96 -32 -144 -32
WIRE 176 -32 -96 -32
WIRE 240 -32 176 -32
WIRE 416 -32 320 -32
WIRE 576 -32 416 -32
WIRE 640 -32 576 -32
WIRE 1088 -32 720 -32
WIRE 1296 -32 1152 -32
WIRE 1424 -32 1424 -288
WIRE 1424 -32 1296 -32
WIRE 1472 -32 1424 -32
WIRE 1504 -32 1472 -32
WIRE 1600 -32 1568 -32
WIRE 1648 -32 1600 -32
WIRE 1680 -32 1648 -32
WIRE 1776 -32 1744 -32
WIRE 3392 -32 3312 -32
WIRE 4160 -32 4160 -80
WIRE -352 -16 -352 -32
WIRE 1776 -16 1776 -32
WIRE 4080 -16 4064 -16
WIRE 4288 -16 4208 -16
WIRE 4480 -16 4368 -16
WIRE 4736 -16 4544 -16
WIRE -96 0 -144 0
WIRE 192 0 -96 0
WIRE 240 0 192 0
WIRE 448 0 320 0
WIRE 592 0 448 0
WIRE 640 0 592 0
WIRE 1152 0 720 0
WIRE 1312 0 1216 0
WIRE 1456 0 1456 -256
WIRE 1456 0 1312 0
WIRE 1472 0 1456 0
WIRE 1504 0 1472 0
WIRE 1648 0 1648 -32
WIRE 3392 0 3344 0
WIRE 3520 0 3488 0
WIRE 4080 0 4032 0
WIRE 1392 16 1392 -64
WIRE 48 32 48 -48
WIRE 240 32 48 32
WIRE 480 32 320 32
WIRE 512 32 480 32
WIRE 640 32 512 32
WIRE 944 32 944 -48
WIRE 944 32 720 32
WIRE 1040 32 1040 -48
WIRE 1104 32 1104 -16
WIRE 1168 32 1168 16
WIRE 3440 32 3440 16
WIRE 3440 32 3376 32
WIRE 4080 32 4064 32
WIRE 4288 32 4208 32
WIRE 4544 32 4368 32
WIRE 4736 32 4608 32
WIRE 1280 48 1280 -64
WIRE 1296 48 1296 -32
WIRE 1312 48 1312 0
WIRE 1424 48 1424 -32
WIRE 3728 48 3696 48
WIRE 3824 48 3824 16
WIRE 3824 48 3728 48
WIRE 4080 48 4032 48
WIRE -352 64 -352 48
WIRE 384 64 384 -64
WIRE 416 64 416 -32
WIRE 448 64 448 0
WIRE 480 64 480 32
WIRE 160 80 160 -64
WIRE 176 80 176 -32
WIRE 192 80 192 0
WIRE 560 80 560 -64
WIRE 576 80 576 -32
WIRE 592 80 592 0
WIRE 1456 80 1456 0
WIRE 3728 80 3728 48
WIRE 3824 80 3824 48
WIRE 4080 80 4064 80
WIRE 4288 80 4208 80
WIRE 4608 80 4368 80
WIRE 4736 80 4672 80
WIRE 3392 96 3312 96
WIRE 3520 96 3488 96
WIRE 4080 96 4032 96
WIRE 3392 128 3312 128
WIRE 4496 128 4496 0
WIRE 4560 128 4560 48
WIRE 4624 128 4624 96
WIRE 944 160 944 32
WIRE 1296 160 1296 112
WIRE 1296 160 944 160
WIRE 1392 160 1392 80
WIRE 1392 160 1296 160
WIRE 1424 160 1424 112
WIRE 1424 160 1392 160
WIRE 1456 160 1456 144
WIRE 1456 160 1424 160
WIRE 1600 160 1600 -32
WIRE 1600 160 1456 160
WIRE 3344 160 3344 0
WIRE 3392 160 3344 160
WIRE 3520 160 3488 160
WIRE -288 176 -288 -32
WIRE 48 176 48 32
WIRE 48 176 -288 176
WIRE 176 176 176 144
WIRE 176 176 48 176
WIRE 512 176 512 32
WIRE 576 176 576 144
WIRE 576 176 512 176
WIRE 3728 176 3728 144
WIRE 3824 176 3824 144
WIRE 4112 176 3824 176
WIRE 4160 176 4160 112
WIRE 4160 176 4112 176
WIRE 3376 192 3376 32
WIRE 3440 192 3440 176
WIRE 3440 192 3376 192
WIRE 3392 256 3312 256
WIRE 3520 256 3488 256
WIRE 3392 288 3312 288
WIRE -1056 320 -1072 320
WIRE 1888 320 1856 320
WIRE 2016 320 1968 320
WIRE 2160 320 2096 320
WIRE 2400 320 2240 320
WIRE 3344 320 3344 160
WIRE 3392 320 3344 320
WIRE 3520 320 3488 320
WIRE -768 336 -800 336
WIRE -624 336 -656 336
WIRE 2784 336 2752 336
WIRE 2960 336 2896 336
WIRE -1056 352 -1072 352
WIRE -336 352 -384 352
WIRE -208 352 -256 352
WIRE -80 352 -128 352
WIRE -32 352 -80 352
WIRE 144 352 80 352
WIRE 208 352 144 352
WIRE 288 352 208 352
WIRE 400 352 368 352
WIRE 736 352 688 352
WIRE 864 352 816 352
WIRE 976 352 944 352
WIRE 1024 352 976 352
WIRE 1136 352 1104 352
WIRE 1312 352 1136 352
WIRE 1488 352 1392 352
WIRE 1648 352 1568 352
WIRE 3376 352 3376 192
WIRE 3440 352 3440 336
WIRE 3440 352 3376 352
WIRE -768 368 -800 368
WIRE -624 368 -656 368
WIRE 1920 368 1920 352
WIRE 1920 368 1856 368
WIRE 2784 368 2752 368
WIRE 2960 368 2896 368
WIRE 3344 384 3344 320
WIRE -1056 400 -1072 400
WIRE -768 400 -800 400
WIRE -624 400 -656 400
WIRE -304 400 -304 384
WIRE -304 400 -352 400
WIRE 320 400 320 384
WIRE 320 400 272 400
WIRE 768 400 768 384
WIRE 768 400 688 400
WIRE 1520 400 1520 384
WIRE 1520 400 1472 400
WIRE 2192 400 2192 352
WIRE 2192 400 2128 400
WIRE 2784 400 2752 400
WIRE 2960 400 2896 400
WIRE 3696 400 3664 400
WIRE 3792 400 3760 400
WIRE 1136 416 1136 352
WIRE 1168 416 1136 416
WIRE 1344 416 1344 384
WIRE 1344 416 1280 416
WIRE 1888 416 1856 416
WIRE 2048 416 2048 352
WIRE 2048 416 1968 416
WIRE 4160 416 4128 416
WIRE 4336 416 4240 416
WIRE 4464 416 4384 416
WIRE 4656 416 4544 416
WIRE 4784 416 4656 416
WIRE -1056 432 -1072 432
WIRE 3376 432 3376 352
WIRE 3696 432 3680 432
WIRE -336 448 -384 448
WIRE -176 448 -176 384
WIRE -176 448 -256 448
WIRE 208 448 208 352
WIRE 288 448 208 448
WIRE 400 448 368 448
WIRE 736 448 688 448
WIRE 896 448 896 384
WIRE 896 448 816 448
WIRE 4192 448 4128 448
WIRE 1920 464 1920 448
WIRE 1920 464 1856 464
WIRE 3680 464 3680 432
WIRE 3680 464 3664 464
WIRE 4656 464 4656 416
WIRE -1056 480 -1072 480
WIRE -768 480 -800 480
WIRE -624 480 -656 480
WIRE 4496 480 4496 448
WIRE -304 496 -304 480
WIRE -304 496 -352 496
WIRE 320 496 320 480
WIRE 320 496 272 496
WIRE 768 496 768 480
WIRE 768 496 688 496
WIRE 3680 496 3680 464
WIRE 3696 496 3680 496
WIRE 3792 496 3760 496
WIRE -1056 512 -1072 512
WIRE -768 512 -800 512
WIRE -624 512 -656 512
WIRE 1888 512 1856 512
WIRE 2016 512 1968 512
WIRE 2160 512 2096 512
WIRE 2400 512 2240 512
WIRE 3696 528 3664 528
WIRE -768 544 -800 544
WIRE -624 544 -656 544
WIRE 736 560 688 560
WIRE 864 560 816 560
WIRE 976 560 944 560
WIRE 1024 560 976 560
WIRE 1344 560 1104 560
WIRE 1648 560 1408 560
WIRE 1920 560 1920 544
WIRE 1920 560 1856 560
WIRE 2128 592 2128 400
WIRE 2192 592 2192 544
WIRE 2192 592 2128 592
WIRE 768 608 768 592
WIRE 768 608 688 608
WIRE 1888 608 1856 608
WIRE 2048 608 2048 544
WIRE 2048 608 1968 608
WIRE -320 624 -352 624
WIRE -80 624 -224 624
WIRE 1344 640 1152 640
WIRE 1600 640 1408 640
WIRE -176 656 -224 656
WIRE -80 656 -128 656
WIRE 736 656 688 656
WIRE 896 656 896 592
WIRE 896 656 816 656
WIRE 1920 656 1920 640
WIRE 1920 656 1856 656
WIRE 4256 688 4096 688
WIRE 4400 688 4336 688
WIRE 4512 688 4480 688
WIRE 4576 688 4512 688
WIRE 4736 688 4672 688
WIRE 768 704 768 688
WIRE 768 704 688 704
WIRE -176 720 -224 720
WIRE 4096 720 4096 688
WIRE 1888 736 1856 736
WIRE 2000 736 1952 736
WIRE -176 752 -224 752
WIRE 4512 752 4512 688
WIRE 2032 768 2000 736
WIRE 4288 768 4288 720
WIRE 4288 768 4256 768
WIRE 4432 768 4432 720
WIRE 4432 768 4384 768
WIRE 3600 784 3472 784
WIRE 1888 800 1856 800
WIRE 2032 800 1952 800
WIRE 2128 800 2128 592
WIRE 2128 800 2112 800
WIRE 3472 800 3472 784
WIRE 4512 832 4512 816
WIRE 1888 864 1856 864
WIRE 2000 864 2032 832
WIRE 2000 864 1952 864
FLAG -992 352 0
FLAG -96 -64 a
FLAG -96 -32 b
FLAG -96 0 c
FLAG -416 -32 nul
FLAG -1072 320 a
FLAG -1072 352 nul
FLAG -992 432 0
FLAG -1072 432 nul
FLAG -992 512 0
FLAG -1072 512 nul
FLAG -1072 400 b
FLAG -1072 480 c
FLAG -800 336 v_a
FLAG -800 368 v_b
FLAG -800 400 v_c
FLAG -624 336 v_alpha
FLAG -624 368 v_beta
FLAG -624 400 v_zero
FLAG -992 320 v_a
FLAG -992 400 v_b
FLAG -992 480 v_c
FLAG 1648 0 COM
FLAG 1072 -48 0
FLAG 1040 32 i_a
FLAG 1136 -16 0
FLAG 1104 32 i_b
FLAG 1200 16 0
FLAG 1168 32 i_c
FLAG -800 480 i_a
FLAG -800 512 i_b
FLAG -800 544 i_c
FLAG -624 480 i_alpha
FLAG -624 512 i_beta
FLAG -624 544 i_zero
FLAG 688 352 v_alpha*
FLAG 688 400 i_alpha
FLAG 688 448 v_beta*
FLAG 688 496 i_beta
FLAG 688 656 v_alpha*
FLAG 688 608 i_alpha
FLAG 688 560 v_beta*
FLAG 688 704 i_beta
FLAG 1024 352 p
FLAG 1024 560 q
FLAG 1104 352 p
FLAG 1104 560 q
FLAG 1152 640 i_zero
FLAG 1648 352 p*
FLAG 1648 560 q*
FLAG 1600 640 i_zero*
FLAG 1856 320 p*
FLAG 1856 416 q*
FLAG 1856 512 p*
FLAG 1856 608 q*
FLAG 2752 400 i_zero*
FLAG 2752 336 i_alpha*
FLAG 2752 368 i_beta*
FLAG 2400 512 i_beta*
FLAG 2400 320 i_alpha*
FLAG 2960 336 i_a*
FLAG 2960 368 i_b*
FLAG 2960 400 i_c*
FLAG 3472 880 0
FLAG 384 64 pcc1
IOPIN 384 64 BiDir
FLAG 416 64 pcc2
IOPIN 416 64 BiDir
FLAG 448 64 pcc3
IOPIN 448 64 BiDir
FLAG 480 64 pccn
IOPIN 480 64 BiDir
FLAG -352 64 0
FLAG -384 352 v_alpha
FLAG -352 624 v_alpha
FLAG -80 352 tmp
FLAG -384 448 v_beta
FLAG -80 624 i`a
FLAG -80 656 i`b
FLAG -352 400 i`a
FLAG -352 496 i`b
FLAG 144 352 v_filt
FLAG 272 400 i`a
FLAG 272 496 i`b
FLAG 400 352 v_alpha*
FLAG 400 448 v_beta*
FLAG 1856 368 v_alpha*
FLAG 1856 464 v_beta*
FLAG 1856 560 v_beta*
FLAG 1856 656 v_alpha*
FLAG 1856 736 v_alpha*
FLAG 1856 800 v_beta*
FLAG 4064 -16 ca
FLAG 3520 -64 ca
FLAG 4032 0 _ca
FLAG 3520 0 _ca
FLAG 4064 32 cb
FLAG 4032 48 _cb
FLAG 4064 80 cc
FLAG 4032 96 _cc
FLAG 3520 96 cb
FLAG 3520 160 _cb
FLAG 3520 256 cc
FLAG 3520 320 _cc
FLAG 4736 -16 pcc1
IOPIN 4736 -16 BiDir
FLAG 4736 32 pcc2
IOPIN 4736 32 BiDir
FLAG 4736 80 pcc3
IOPIN 4736 80 BiDir
FLAG 4112 -80 DC+
FLAG 4112 176 DC-
FLAG 3696 48 pccn
IOPIN 3696 48 BiDir
FLAG 3664 464 pccn
FLAG 3664 400 DC+
FLAG 3664 528 DC-
FLAG 3760 432 0
FLAG 3760 528 0
FLAG 3792 400 dc1
FLAG 3792 496 dc2
FLAG 4128 448 dc2
FLAG 4128 416 dc1
FLAG 4496 560 0
FLAG 3312 -64 i_a*
FLAG 3312 96 i_b*
FLAG 3312 256 i_c*
FLAG 4528 0 0
FLAG 4496 128 if_a
FLAG 4592 48 0
FLAG 4560 128 if_b
FLAG 4656 96 0
FLAG 4624 128 if_c
FLAG 3312 -32 if_a
FLAG 3312 128 if_b
FLAG 3312 288 if_c
FLAG 4784 416 err
FLAG 3344 384 err
FLAG 1472 400 p_loss
FLAG 4384 768 dc2
FLAG 4256 768 dc1
FLAG 4736 688 p_loss
FLAG 1856 864 v_zero
FLAG 3728 176 0
FLAG 2064 768 0
FLAG 2064 832 0
FLAG 3376 432 _EN
FLAG 3600 784 _EN
FLAG 4096 800 0
FLAG -32 384 0
FLAG 976 416 0
FLAG 976 624 0
FLAG 1776 -16 0
FLAG 1584 -256 0
FLAG 1648 -240 0
FLAG 1472 -64 _a
FLAG 1472 -32 _b
FLAG 1472 0 _c
FLAG 1552 -208 x[1:6]
FLAG 1984 -256 0
FLAG 4656 528 0
FLAG -176 752 theta
FLAG 4512 832 0
FLAG -176 720 freq
FLAG 0 384 freq
FLAG 1168 448 0
FLAG 1200 448 freq
FLAG -32 -224 Si
FLAG -16 -192 Pi
FLAG 0 -176 Qi
FLAG 16 -144 PFi
FLAG 48 -192 Vi
FLAG 64 -160 Ii
FLAG 864 -224 So
FLAG 880 -192 Po
FLAG 896 -176 Qo
FLAG 912 -144 PFo
FLAG 944 -192 Vo
FLAG 960 -160 Io
SYMBOL 3ph_gen -192 -32 R0
SYMATTR InstName U1
SYMATTR Value sym=1 f={f} amp=325 phi=0 Ro=0.1 N=1
SYMBOL Vsense -1040 336 R0
SYMATTR SpiceLine G=1/kv Cout={Cout}
SYMATTR InstName U2
SYMBOL RLC 1536 -32 R0
WINDOW 39 -55 57 Left 2
WINDOW 40 -53 91 Left 2
SYMATTR SpiceLine V=400 f={f} NUL=1 DY=1 SP=0
SYMATTR SpiceLine2 P=5k QL=3k QC=0 Rd=5
SYMATTR InstName U6
SYMBOL Isense 1056 -64 R0
SYMATTR SpiceLine G=1/ki Cout={Cout}
SYMATTR InstName U7
SYMBOL Misc\\jumper 1376 496 R0
WINDOW 0 1 71 Invisible 2
SYMATTR InstName X1
SYMBOL Misc\\jumper 1376 576 R0
WINDOW 0 1 71 Invisible 2
SYMATTR InstName X2
SYMBOL PLL -272 688 R0
SYMATTR InstName U39
SYMATTR SpiceLine f={f} kp=6.1 ki=81
SYMBOL Gain -160 656 R0
SYMATTR InstName U42
SYMBOL 3ph_br_vm 4144 48 R0
WINDOW 0 -33 -95 Left 2
SYMATTR InstName U48
SYMATTR SpiceLine Ron=250m Roff=10meg Vfwd=1.5
SYMBOL ind 4272 0 R270
WINDOW 0 15 -6 VTop 2
WINDOW 3 26 106 VRight 2
SYMATTR InstName L1
SYMATTR Value {Lf}
SYMATTR SpiceLine Rser=0.1 Rpar=10k
SYMBOL Vsense 3712 416 R0
SYMATTR SpiceLine G=1/300 Cout={Cout}
SYMATTR InstName U50
SYMBOL cap 3808 -48 R0
SYMATTR InstName C1
SYMATTR Value 900u
SYMATTR SpiceLine Rser=0.5 Rpar=560k
SYMATTR SpiceLine2 Lser=0 RLshunt=0 Cpar=0
SYMBOL Vsense 3712 512 R0
SYMATTR SpiceLine G=1/300 Cout={Cout}
SYMATTR InstName U51
SYMBOL Isense 4512 -16 R0
SYMATTR SpiceLine G=1/ki Cout={Cout}
SYMATTR InstName U54
SYMBOL PID 4624 688 R0
WINDOW 39 2 42 Center 2
SYMATTR SpiceLine Kp=3 Ki=20
SYMATTR InstName U59
SYMBOL cap 3712 80 R0
SYMATTR InstName C3
SYMATTR Value 1n
SYMATTR SpiceLine Rser=1 Rpar=1e6
SYMBOL ind 4272 48 R270
WINDOW 0 15 -6 VTop 2
WINDOW 3 26 106 VRight 2
SYMATTR InstName L2
SYMATTR Value {Lf}
SYMATTR SpiceLine Rser=0.1 Rpar=10k
SYMBOL ind 4272 96 R270
WINDOW 0 15 -6 VTop 2
WINDOW 3 26 106 VRight 2
SYMATTR InstName L3
SYMATTR Value {Lf}
SYMATTR SpiceLine Rser=0.1 Rpar=10k
SYMBOL cap -368 -16 R0
SYMATTR InstName C5
SYMATTR Value 1n
SYMATTR SpiceLine Rser=1 Rpar=1e6
SYMBOL Filter 32 352 R0
WINDOW 38 -7 -39 Center 2
SYMATTR SpiceModel MAFv
SYMATTR SpiceLine f0=0 fp1=20 fs1=100 fp2=0 fs2=0
SYMATTR InstName U23
SYMATTR SpiceLine2 G=1 Asc=3 Ap=1 As=40 N=0
SYMBOL Math1 1920 736 R0
WINDOW 39 0 28 Center 2
SYMATTR SpiceModel pwr
SYMATTR InstName U36
SYMBOL Math1 1920 800 R0
WINDOW 39 0 28 Center 2
SYMATTR SpiceModel pwr
SYMATTR InstName U37
SYMBOL Math1 1920 864 R0
WINDOW 39 0 28 Center 2
SYMATTR SpiceModel pwr
SYMATTR InstName U38
SYMBOL Transforms -720 368 R0
SYMATTR InstName U60
SYMBOL Transforms -720 512 R0
SYMATTR InstName U5
SYMBOL Transforms 2832 368 R0
SYMATTR SpiceModel AB0/abc
SYMATTR InstName U8
SYMBOL Math2r -304 352 R0
SYMATTR SpiceModel x
SYMATTR InstName U17
SYMBOL Math2r -176 352 R0
SYMATTR SpiceModel +
SYMATTR InstName U22
SYMBOL Math2r -304 448 R0
SYMATTR SpiceModel x
SYMATTR InstName U21
SYMBOL Math2r 320 352 R0
SYMATTR SpiceModel x
SYMATTR InstName U11
SYMBOL Math2r 320 448 R0
SYMATTR SpiceModel x
SYMATTR InstName U12
SYMBOL Math2r 768 352 R0
SYMATTR SpiceModel x
SYMATTR InstName U13
SYMBOL Math2r 896 352 R0
SYMATTR SpiceModel +
SYMATTR InstName U14
SYMBOL Math2r 768 448 R0
SYMATTR SpiceModel x
SYMATTR InstName U18
SYMBOL Math2r 768 560 R0
SYMATTR SpiceModel x
SYMATTR InstName U15
SYMBOL Math2r 896 560 R0
SYMATTR InstName U16
SYMBOL Math2r 768 656 R0
SYMATTR SpiceModel x
SYMATTR InstName U19
SYMBOL Math2r 1344 352 R0
SYMATTR InstName U20
SYMBOL Math2r 1520 352 R0
SYMATTR InstName U24
SYMBOL Math2r 1920 320 R0
SYMATTR SpiceModel x
SYMATTR InstName U25
SYMBOL Math2r 2048 320 R0
SYMATTR SpiceModel +
SYMATTR InstName U26
SYMBOL Math2r 1920 416 R0
SYMATTR SpiceModel x
SYMATTR InstName U28
SYMBOL Math2r 2192 320 R0
WINDOW 0 0 28 Center 2
SYMATTR InstName U29
SYMATTR SpiceModel /
SYMATTR SpiceLine2 min=100m
SYMBOL Math2r 1920 512 R0
SYMATTR SpiceModel x
SYMATTR InstName U30
SYMBOL Math2r 2048 512 R0
SYMATTR InstName U31
SYMBOL Math2r 1920 608 R0
SYMATTR SpiceModel x
SYMATTR InstName U32
SYMBOL Math2r 2192 512 R0
WINDOW 0 0 28 Center 2
SYMATTR InstName U33
SYMATTR SpiceModel /
SYMATTR SpiceLine2 min=100m
SYMBOL Math2r 4192 416 R0
SYMATTR InstName U43
SYMBOL Math2r 4496 416 R0
SYMATTR SpiceModel +
SYMATTR InstName U53
SYMBOL Math2r 4288 688 R0
SYMATTR InstName U44
SYMBOL Math2r 4432 688 R0
SYMATTR InstName U49
SYMBOL Math5r 2064 800 R0
SYMATTR InstName U27
SYMBOL voltage 4496 464 R0
WINDOW 3 31 91 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value {err}
SYMATTR InstName Verr
SYMBOL voltage 4096 704 R0
WINDOW 3 31 91 Left 2
WINDOW 123 0 0 Left 2
SYMATTR Value {Vref}
SYMATTR InstName Vref
SYMATTR SpiceLine Rser=1
SYMBOL voltage 3472 784 R0
SYMATTR InstName V_start
SYMATTR Value pulse 1 0 {start} 1u rser=1 cpar=1u
SYMBOL Vsense -1040 416 R0
SYMATTR SpiceLine G=1/kv Cout={Cout}
SYMATTR InstName U3
SYMBOL Vsense -1040 496 R0
SYMATTR SpiceLine G=1/kv Cout={Cout}
SYMATTR InstName U4
SYMBOL Isense 1120 -32 R0
SYMATTR SpiceLine G=1/ki Cout={Cout}
SYMATTR InstName U9
SYMBOL Isense 1184 0 R0
SYMATTR SpiceLine G=1/ki Cout={Cout}
SYMATTR InstName U10
SYMBOL cap 960 352 R0
SYMATTR InstName C2
SYMATTR Value 100p
SYMBOL cap 960 560 R0
SYMATTR InstName C9
SYMATTR Value 100p
SYMBOL Isense 4576 32 R0
SYMATTR SpiceLine G=1/ki Cout={Cout}
SYMATTR InstName U46
SYMBOL Isense 4640 80 R0
SYMATTR SpiceLine G=1/ki Cout={Cout}
SYMATTR InstName U47
SYMBOL cap 1680 -16 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C7
SYMATTR Value 1n
SYMATTR SpiceLine Rser=1 Rpar=1e6
SYMBOL ind 1760 -304 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L4
SYMATTR Value 10m rser=0.1 rpar=10k
SYMBOL BrdgRectThy 1552 -288 R0
SYMATTR InstName U40
SYMATTR SpiceLine2 f=50 phi=0 ang=-pi/3 lvl=1
SYMBOL ind2 224 -48 R270
WINDOW 0 19 115 VTop 2
WINDOW 3 5 56 Invisible 2
SYMATTR InstName Lg1
SYMATTR Value {Lg} Rser={Rg} Rpar={Rgp}
SYMATTR Type ind
SYMBOL ind2 224 -16 R270
WINDOW 0 19 115 VTop 2
WINDOW 3 5 56 Invisible 2
SYMATTR InstName Lg2
SYMATTR Value {Lg} Rser={Rg} Rpar={Rgp}
SYMATTR Type ind
SYMBOL ind2 224 16 R270
WINDOW 0 19 115 VTop 2
WINDOW 3 5 56 Invisible 2
SYMATTR InstName Lg3
SYMATTR Value {Lg} Rser={Rg} Rpar={Rgp}
SYMATTR Type ind
SYMBOL ind2 224 48 R270
WINDOW 0 19 115 VTop 2
WINDOW 3 5 56 Invisible 2
SYMATTR InstName Lg4
SYMATTR Value {Lg} Rser={Rg} Rpar={Rgp}
SYMATTR Type ind
SYMBOL cap 2000 -320 M0
SYMATTR InstName C8
SYMATTR Value 1m rser=1 rpar=100
SYMBOL HystComp 3440 -32 R0
SYMATTR InstName U34
SYMATTR SpiceLine Vhigh=1 Vlow=0 err={err}
SYMBOL HystComp 3440 128 R0
SYMATTR InstName U41
SYMATTR SpiceLine Vhigh=1 Vlow=0 err={err}
SYMBOL HystComp 3440 288 R0
SYMATTR InstName U45
SYMATTR SpiceLine Vhigh=1 Vlow=0 err={err}
SYMBOL cap 4640 464 R0
SYMATTR InstName C4
SYMATTR Value 10m
SYMBOL Lim 4368 416 R0
WINDOW 39 -6 38 Center 2
WINDOW 40 -6 60 Center 2
SYMATTR SpiceLine Min=0 Max=err*10
SYMATTR InstName U52
SYMBOL cap 3808 80 R0
SYMATTR InstName C6
SYMATTR Value 1100u
SYMATTR SpiceLine Rser=0.7 Rpar=530k
SYMATTR SpiceLine2 Lser=0 RLshunt=0 Cpar=0
SYMBOL Wattmeter 16 -64 R0
SYMATTR InstName U55
SYMBOL Wattmeter 912 -64 R0
SYMATTR InstName U56
SYMBOL cap 4496 752 R0
SYMATTR InstName C10
SYMATTR Value 10m
SYMBOL Filter 1232 416 R0
WINDOW 38 -7 -39 Center 2
SYMATTR SpiceModel MAFv
SYMATTR SpiceLine f0=0 fp1=20 fs1=100 fp2=0 fs2=0
SYMATTR InstName U35
SYMATTR SpiceLine2 G=1 Asc=3 Ap=1 As=40 N=0
SYMBOL ind2 624 -48 R270
WINDOW 0 19 115 VTop 2
WINDOW 3 5 56 Invisible 2
SYMATTR InstName Lo1
SYMATTR Value {Lo} Rser={Rg} Rpar={Rgp}
SYMATTR Type ind
SYMBOL diode 1632 -240 M180
WINDOW 0 24 64 Left 2
WINDOW 3 37 7 Left 2
SYMATTR InstName D1
SYMBOL ind2 624 -16 R270
WINDOW 0 19 115 VTop 2
WINDOW 3 5 56 Invisible 2
SYMATTR InstName Lo2
SYMATTR Value {Lo} Rser={Rg} Rpar={Rgp}
SYMATTR Type ind
SYMBOL ind2 624 16 R270
WINDOW 0 19 115 VTop 2
WINDOW 3 5 56 Invisible 2
SYMATTR InstName Lo3
SYMATTR Value {Lo} Rser={Rg} Rpar={Rgp}
SYMATTR Type ind
SYMBOL ind2 624 48 R270
WINDOW 0 19 115 VTop 2
WINDOW 3 5 56 Invisible 2
SYMATTR InstName Lo4
SYMATTR Value {Lo} Rser={Rg} Rpar={Rgp}
SYMATTR Type ind
SYMBOL TVSdiode 1376 16 R0
WINDOW 0 24 -2 Invisible 2
WINDOW 3 24 65 Invisible 2
SYMATTR InstName Dtvs1
SYMATTR Value tvs
SYMBOL TVSdiode 1408 48 R0
WINDOW 0 24 -2 Invisible 2
WINDOW 3 24 65 Invisible 2
SYMATTR InstName Dtvs2
SYMATTR Value tvs
SYMBOL TVSdiode 1440 80 R0
WINDOW 0 24 -2 Invisible 2
WINDOW 3 24 65 Invisible 2
SYMATTR InstName Dtvs3
SYMATTR Value tvs
SYMBOL 3ph_snub 176 112 R0
SYMATTR InstName U57
SYMATTR SpiceLine R=270 C=1u
SYMBOL 3ph_snub 576 112 R0
SYMATTR InstName U58
SYMATTR SpiceLine R=270 C=1u
SYMBOL 3ph_snub 1296 80 R0
SYMATTR InstName U61
SYMATTR SpiceLine R=270 C=1u
TEXT 2152 64 Left 2 !.param kv=250  ki=25\n+  f=50\n+  start=0.105\n+  Vref=2.5\n+  err=50m\n+  Lf=5m\n+ sim=0.3\n+ Cout=1u
TEXT 2160 -96 Left 2 !.tran {sim} uic
TEXT 2432 64 Left 2 ;kv,ki - attenuation factors for voltage and currents\nf - grid frequency\nstart - the moment the APF starts\nVref - reference voltage for the PI controller\nerr - error band for the hysteresis controller\nLf - inductance of the filtering inductor\nsim - the simulation time.\nCout - optional output capacitance for aid in convergence
TEXT -864 888 Left 2 ;Clarke matrices for\nvoltage and currents.
TEXT 576 888 Left 2 ;The power calculations as defined\nby Akagi.
TEXT 1072 872 Left 2 ;Selection of powers to be compensated.\nIn addition, p_loss is added which\nrepresents the losses in the APF.
TEXT 1752 920 Left 2 ;Inverse power matrices for alpha/beta components.
TEXT 2576 856 Left 2 ;Inverse matrix for compensated\ncurrents. The conditional B-source\ndetermines the start for the APF
TEXT 312 -488 Center 5 ;Shunt Active Power Filter
TEXT 328 -416 Center 2 ;(based on the p-q theory, sinusoidal strategy)
TEXT -8 632 Left 2 ;(-cos because Clarke matrix\nneeds sin/-cos, while the PLL\noutputs sin/cos)
TEXT -464 888 Left 2 ;Extraction of the positive-sequence components.\nThe filtering is done with an adaptive moving average.
TEXT 3264 528 Left 2 ;For simplicity and\nspeed, a hysteresis\ncontroller with a\ndynamic band.
TEXT 3608 288 Left 2 ;The DC link capacitors are different to view the effect of the dynamic hysteresis\nband reducing the voltage difference between them.
TEXT 3592 576 Left 2 ;Differential voltage sensors\nfor the DC link...
TEXT 4048 600 Left 2 ;...which feed the dynamic hysteresis band...
TEXT 4040 896 Left 2 ;...and the PI regulator to keep the voltage on the capacitors\naround an imposed limit.
TEXT 2544 -472 Left 2 !.meas Pina avg I(Lg1)*V(a,nul) trig time=sim-4/f\n.meas Pinb avg I(Lg2)*V(b,nul) trig time=sim-4/f\n.meas Pinc avg I(Lg3)*V(c,nul) trig time=sim-4/f\n.meas Pouta avg I(Lo1)*V(_a,com) trig time=sim-4/f\n.meas Poutb avg I(Lo2)*V(_b,com) trig time=sim-4/f\n.meas Poutc avg I(Lo3)*V(_c,com) trig time=sim-4/f\n.meas Iina rms I(Lg1) trig time=sim-4/f\n.meas Iinb rms I(Lg2) trig time=sim-4/f\n.meas Iinc rms I(Lg3) trig time=sim-4/f\n.meas Iouta rms I(Lo1) trig time=sim-4/f\n.meas Ioutc rms I(Lo2) trig time=sim-4/f\n.meas Ioutb rms I(Lo3) trig time=sim-4/f\n.meas Vina rms V(a,nul) trig time=sim-4/f\n.meas Vinb rms V(b,nul) trig time=sim-4/f\n.meas Vinc rms V(c,nul) trig time=sim-4/f\n.meas Vouta rms V(_a,com) trig time=sim-4/f\n.meas Voutb rms V(_b,com) trig time=sim-4/f\n.meas Voutc rms V(_c,com) trig time=sim-4/f\n.meas Sin param Vina*Iina+Vinb*Iinb+Vinc*Iinc\n.meas Sout param Vouta*Iouta+Voutb*Ioutb+Voutc*Ioutc\n.meas eff_in param (Pina+Pinb+Pinc)/Sin\n.meas eff_out param (Pouta+Poutb+Poutc)/Sout
TEXT 2152 0 Left 2 !.param tripdv=0 tripdt=0
TEXT 200 -136 Left 2 !.param Rg=0.1 Lg=1m Lo=0.1m Rgp=10k
TEXT 1520 -184 Left 2 !.model d d ron=0.1 roff=10meg vfwd=0.7 vrev=1k\n+ epsilon=0.1 revepsilon=0.1
TEXT 1336 192 Left 2 !.model tvs d ron=0.1 roff=10meg vfwd=500 vrev=500\n+ epsilon=1 revepsilon=1
TEXT 272 -192 Left 2 !kg lg1 lg2 lg3 lg4 0.9\nko lo1 lo2 lo3 lo4 0.9
TEXT 832 -432 Left 2 ;The load is a linear series RL and a thyristor bridge\nwith an L filtered parallel RC load. The unbalance is\ncreated by connected to two of the phases, only.
TEXT 160 -256 Left 2 ;Wattmeters on one phase show the in vs out measurements.
LINE Normal 3216 256 -1120 256
LINE Normal 3216 960 3216 -128
LINE Normal 3216 960 3216 960 2
RECTANGLE Normal 792 232 128 -112 2
RECTANGLE Normal 2072 232 816 -464 2
RECTANGLE Normal -496 944 -880 288 2
RECTANGLE Normal 1040 944 560 288 2
RECTANGLE Normal 1728 944 1056 288 2
RECTANGLE Normal 2544 944 1744 288 2
RECTANGLE Normal 3184 944 2560 288 2
RECTANGLE Normal 544 944 -480 288 2
RECTANGLE Normal 3568 624 3248 -112 2
RECTANGLE Normal 4832 336 3584 -112 2
RECTANGLE Normal 4016 624 3584 352 2
RECTANGLE Normal 4832 624 4032 352 2
RECTANGLE Normal 4832 944 4032 640 2
RECTANGLE Normal 104 232 -480 -112 2
