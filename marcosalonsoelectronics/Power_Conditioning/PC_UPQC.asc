Version 4
SHEET 1 4096 1476
WIRE 1392 0 1344 0
WIRE 1520 0 1456 0
WIRE 1392 64 1376 64
WIRE 1520 64 1456 64
WIRE 96 112 48 112
WIRE 160 112 96 112
WIRE 352 112 320 112
WIRE 592 112 416 112
WIRE 800 112 768 112
WIRE 992 112 960 112
WIRE 1344 112 1344 0
WIRE 1344 112 1056 112
WIRE 1392 112 1344 112
WIRE -112 144 -176 144
WIRE -48 144 -112 144
WIRE 96 144 48 144
WIRE 160 144 96 144
WIRE 416 144 320 144
WIRE 592 144 480 144
WIRE 800 144 768 144
WIRE 1056 144 960 144
WIRE 1360 144 1360 32
WIRE 1360 144 1120 144
WIRE 1392 144 1360 144
WIRE 1504 144 1456 144
WIRE -112 160 -112 144
WIRE 96 176 48 176
WIRE 160 176 96 176
WIRE 480 176 320 176
WIRE 592 176 544 176
WIRE 800 176 768 176
WIRE 1120 176 960 176
WIRE 1376 176 1376 64
WIRE 1376 176 1184 176
WIRE 1392 176 1376 176
WIRE 1504 176 1504 144
WIRE 2992 176 2944 176
WIRE 3232 176 3056 176
WIRE 3296 176 3232 176
WIRE 160 208 112 208
WIRE 672 208 320 208
WIRE 800 208 672 208
WIRE 2992 208 2976 208
WIRE 3248 224 3168 224
WIRE 3280 224 3248 224
WIRE 368 240 368 128
WIRE 432 240 432 160
WIRE 496 240 496 192
WIRE 1008 240 1008 128
WIRE 1072 240 1072 160
WIRE 1136 240 1136 192
WIRE 960 256 960 208
WIRE 1680 368 1616 368
WIRE 1808 368 1760 368
WIRE -64 384 -112 384
WIRE 32 384 0 384
WIRE 1104 384 656 384
WIRE 1328 384 1184 384
WIRE 1408 384 1328 384
WIRE 256 400 224 400
WIRE 416 400 368 400
WIRE 480 400 416 400
WIRE 656 400 656 384
WIRE 656 400 592 400
WIRE 1408 400 1408 384
WIRE 1440 400 1408 400
WIRE 1616 400 1616 368
WIRE 1616 400 1552 400
WIRE 1712 400 1648 400
WIRE -64 416 -80 416
WIRE 256 432 224 432
WIRE 416 432 368 432
WIRE 480 432 416 432
WIRE 624 432 592 432
WIRE 656 432 624 432
WIRE 848 432 656 432
WIRE 1040 432 928 432
WIRE 1296 432 1120 432
WIRE 1440 432 1296 432
WIRE 1680 432 1552 432
WIRE 1808 432 1760 432
WIRE 1296 448 1296 432
WIRE 1328 448 1328 384
WIRE 256 464 224 464
WIRE 416 464 368 464
WIRE 1440 464 1424 464
WIRE 1616 464 1552 464
WIRE 1648 464 1648 400
WIRE 1712 464 1648 464
WIRE -64 480 -112 480
WIRE 32 480 0 480
WIRE 656 496 656 432
WIRE 736 496 656 496
WIRE 880 496 880 464
WIRE 880 496 848 496
WIRE 1616 496 1616 464
WIRE 1680 496 1616 496
WIRE 1808 496 1760 496
WIRE -64 512 -80 512
WIRE 512 512 512 480
WIRE 1472 512 1472 480
WIRE 1648 528 1648 464
WIRE 1648 528 1600 528
WIRE 1712 528 1648 528
WIRE 2080 544 2016 544
WIRE 2256 544 2160 544
WIRE 2464 544 2400 544
WIRE 2640 544 2544 544
WIRE 2848 544 2784 544
WIRE 3024 544 2928 544
WIRE 416 560 416 464
WIRE 1264 560 416 560
WIRE 1424 560 1424 464
WIRE 1424 560 1344 560
WIRE -64 576 -112 576
WIRE 32 576 0 576
WIRE -64 608 -80 608
WIRE 480 608 224 608
WIRE 1136 608 1136 416
WIRE 1136 608 592 608
WIRE 480 640 224 640
WIRE 624 640 592 640
WIRE 640 640 624 640
WIRE 848 640 640 640
WIRE 1072 640 1072 464
WIRE 1072 640 928 640
WIRE 480 672 224 672
WIRE 624 672 592 672
WIRE 1664 688 1584 688
WIRE 640 704 640 640
WIRE 736 704 640 704
WIRE 880 704 880 672
WIRE 880 704 848 704
WIRE 512 720 512 688
WIRE 624 752 624 672
WIRE 1296 752 1296 592
WIRE 1296 752 624 752
WIRE -80 864 -112 864
WIRE 64 864 16 864
WIRE 1680 864 1616 864
WIRE 1824 864 1760 864
WIRE 2176 864 2176 768
WIRE 2480 864 2480 768
WIRE 2784 864 2784 768
WIRE 48 896 16 896
WIRE 480 896 224 896
WIRE 1328 896 592 896
WIRE 1440 896 1328 896
WIRE 1616 896 1616 864
WIRE 1616 896 1552 896
WIRE 1712 896 1648 896
WIRE 480 928 224 928
WIRE 624 928 592 928
WIRE 640 928 624 928
WIRE 848 928 640 928
WIRE 1296 928 928 928
WIRE 1440 928 1296 928
WIRE 1680 928 1552 928
WIRE 1824 928 1760 928
WIRE 1296 944 1296 928
WIRE 1328 944 1328 896
WIRE 32 960 16 960
WIRE 480 960 224 960
WIRE 624 960 592 960
WIRE 1440 960 1408 960
WIRE 1616 960 1552 960
WIRE 1648 960 1648 896
WIRE 1712 960 1648 960
WIRE 48 992 16 992
WIRE 640 992 640 928
WIRE 736 992 640 992
WIRE 880 992 880 960
WIRE 880 992 848 992
WIRE 1616 992 1616 960
WIRE 1680 992 1616 992
WIRE 1824 992 1760 992
WIRE 512 1008 512 976
WIRE 1472 1008 1472 976
WIRE 2176 1008 2176 944
WIRE 2176 1008 2096 1008
WIRE 2480 1008 2480 944
WIRE 2480 1008 2176 1008
WIRE 2784 1008 2784 944
WIRE 2784 1008 2480 1008
WIRE 1648 1024 1648 960
WIRE 1648 1024 1600 1024
WIRE 1712 1024 1648 1024
WIRE 624 1072 624 960
WIRE 1408 1072 1408 960
WIRE 1408 1072 624 1072
FLAG -176 144 nul
FLAG -112 224 0
FLAG 96 112 a
FLAG 96 144 b
FLAG 96 176 c
FLAG 112 208 nul
FLAG 592 112 pcc1
FLAG 592 144 pcc2
FLAG 592 176 pcc3
FLAG 672 208 pcc0
FLAG 768 112 pcc1*
FLAG 768 144 pcc2*
FLAG 768 176 pcc3*
FLAG 400 128 0
FLAG 464 160 0
FLAG 528 192 0
FLAG 368 240 iSa
FLAG 432 240 iSb
FLAG 496 240 iSc
FLAG 1040 128 0
FLAG 1104 160 0
FLAG 1168 192 0
FLAG 1008 240 iLa
FLAG 1072 240 iLb
FLAG 1136 240 iLc
FLAG -112 384 pcc1
FLAG -80 416 pcc0
FLAG 0 416 0
FLAG 32 384 vSa
FLAG -80 512 pcc0
FLAG 0 512 0
FLAG 32 480 vSb
FLAG -80 608 pcc0
FLAG 0 608 0
FLAG 32 576 vSc
FLAG -112 480 pcc2
FLAG -112 576 pcc3
FLAG 416 400 v_alfa
FLAG 416 432 v_beta
FLAG -112 864 v_alfa
FLAG 224 400 vSa
FLAG 224 432 vSb
FLAG 224 464 vSc
FLAG 512 512 wt
FLAG 48 992 wt
FLAG 1472 512 wt
FLAG 224 608 iSa
FLAG 224 640 iSb
FLAG 224 672 iSc
FLAG 512 720 wt
FLAG 1664 688 start/stop
FLAG 1600 528 start/stop
FLAG 512 1008 wt
FLAG 1472 1008 wt
FLAG 224 896 iLa
FLAG 224 928 iLb
FLAG 224 960 iLc
FLAG 1808 368 vSa*
FLAG 1808 432 vSb*
FLAG 1808 496 vSc*
FLAG 1824 864 iLa*
FLAG 1824 928 iLb*
FLAG 1824 992 iLc*
FLAG 2128 928 0
FLAG 2128 880 iLa*
FLAG 2176 768 pcc1*
FLAG 2096 1008 pcc0
FLAG 2432 928 0
FLAG 2480 768 pcc2*
FLAG 2736 928 0
FLAG 2784 768 pcc3*
FLAG 2144 592 0
FLAG 2096 592 vSa*
FLAG 2016 544 pcc1
FLAG 2256 544 pcc1*
FLAG 2640 544 pcc2*
FLAG 3024 544 pcc3*
FLAG 2528 592 0
FLAG 2912 592 0
FLAG 2784 544 pcc3
FLAG 2400 544 pcc2
FLAG 2480 592 vSb*
FLAG 2864 592 vSc*
FLAG 2432 880 iLb*
FLAG 2736 880 iLc*
FLAG 624 432 qvS
FLAG 624 640 qiS
FLAG 624 928 qiL
FLAG 2944 176 pcc1*
FLAG 2976 208 pcc0
FLAG 3056 208 0
FLAG 3232 176 Vtest
FLAG 3248 224 iSa
FLAG 1600 1024 start/stop
FLAG 960 256 COM
FLAG 1504 176 COM
FLAG 1296 512 0
FLAG 1328 512 0
FLAG 1296 1008 0
FLAG 1328 1008 0
FLAG 736 528 0
FLAG 736 736 0
FLAG 736 1024 0
FLAG 1584 768 0
SYMBOL 3ph_gen 0 144 R0
SYMATTR InstName U1
SYMATTR SpiceLine h1=0 h2=0 h3=0 phi1=0 phi2=0 phi3=0.2
SYMATTR SpiceLine2 a=1 b=1/3 c=-pi/3 d=1/5 e=pi/5 p=1 q=0 xp=2 xq=1
SYMATTR Value sym=0 f=f amp=325 phi=0 Ro=1 N=9
SYMATTR Value2 dc1=0 dc2=0 dc3=10 A1=1.1 A2=1 A3=1
SYMBOL cap -128 160 R0
SYMATTR InstName C1
SYMATTR Value 1n
SYMATTR SpiceLine Rser=1 Rpar=1e6
SYMBOL Cable 240 160 R0
SYMATTR InstName U2
SYMATTR SpiceLine phi=2m  f=f  len=10  CuAl=1
SYMATTR SpiceLine2 Space=5m  Dins=6m  TriPlan=1  T=27
SYMBOL Cable 880 160 R0
SYMATTR InstName U3
SYMATTR SpiceLine phi=2m  f=f  len=1  CuAl=2
SYMATTR SpiceLine2 Space=5m  Dins=6m  TriPlan=2  T=27
SYMBOL Isense 384 112 R0
SYMATTR SpiceLine G=1/ki
SYMATTR InstName U4
SYMBOL Isense 448 144 R0
SYMATTR SpiceLine G=1/ki
SYMATTR InstName U5
SYMBOL Isense 512 176 R0
SYMATTR SpiceLine G=1/ki
SYMATTR InstName U6
SYMBOL Isense 1024 112 R0
SYMATTR SpiceLine G=1/ki
SYMATTR InstName U7
SYMBOL Isense 1088 144 R0
SYMATTR SpiceLine G=1/ki
SYMATTR InstName U8
SYMBOL Isense 1152 176 R0
SYMATTR SpiceLine G=1/ki
SYMATTR InstName U9
SYMBOL RLC 1424 144 R0
SYMATTR SpiceLine V=400  f=f  NUL=1  DY=1  SP=0
SYMATTR SpiceLine2 P=10k  QL=5k  QC=1k  Rd=1
SYMATTR InstName U10
SYMBOL BrdgRect 1424 32 R0
SYMATTR InstName U11
SYMBOL cap 1504 0 R0
WINDOW 39 24 84 Left 2
SYMATTR SpiceLine Rser=1 Rpar=100
SYMATTR InstName C2
SYMATTR Value 1m
SYMBOL Vsense -48 400 R0
SYMATTR SpiceLine G=1/kv
SYMATTR InstName U12
SYMBOL Vsense -48 496 R0
SYMATTR SpiceLine G=1/kv
SYMATTR InstName U13
SYMBOL Vsense -48 592 R0
SYMATTR SpiceLine G=1/kv
SYMATTR InstName U14
SYMBOL PLL -32 928 R0
SYMATTR InstName U17
SYMATTR SpiceLine f=f  tau1=0.25m  tau2=25m
SYMBOL g 2176 848 R0
WINDOW 0 10 8 Left 2
WINDOW 3 11 105 Left 2
SYMATTR InstName G1
SYMATTR Value {ki}
SYMBOL g 2480 848 R0
WINDOW 0 10 8 Left 2
WINDOW 3 11 105 Left 2
SYMATTR InstName G2
SYMATTR Value {ki}
SYMBOL g 2784 848 R0
WINDOW 0 10 8 Left 2
WINDOW 3 11 105 Left 2
SYMATTR InstName G3
SYMATTR Value {ki}
SYMBOL e 2176 544 M270
WINDOW 0 19 91 VRight 2
WINDOW 3 20 18 VLeft 2
SYMATTR InstName E1
SYMATTR Value {kv}
SYMBOL e 2560 544 M270
WINDOW 0 19 91 VRight 2
WINDOW 3 20 18 VLeft 2
SYMATTR InstName E2
SYMATTR Value {kv}
SYMBOL e 2944 544 M270
WINDOW 0 19 91 VRight 2
WINDOW 3 20 18 VLeft 2
SYMATTR InstName E3
SYMATTR Value {kv}
SYMBOL Vsense 3008 192 R0
SYMATTR SpiceLine G=1/kv
SYMATTR InstName U36
SYMBOL Filter 800 496 R0
SYMATTR SpiceLine2 G=1 Asc=3 Ap=1 As=60 N=4
SYMATTR SpiceLine f0=10k fc=0 BWp=20 VWs=200
SYMATTR InstName U18
SYMBOL Filter 800 704 R0
SYMATTR SpiceLine2 G=1 Asc=3 Ap=1 As=60 N=1
SYMATTR SpiceLine f0=10k fc=0 BWp=50 BWs=200
SYMATTR InstName U21
SYMBOL Filter 800 992 R0
SYMATTR SpiceLine2 G=1 Asc=3 Ap=1 As=60 N=2
SYMATTR SpiceLine f0=10k fc=0 BWp=20 BWs=200
SYMATTR InstName U22
SYMBOL Transforms 304 432 R0
SYMATTR InstName U15
SYMBOL Transforms 528 432 R0
SYMATTR SpiceModel AB/dq
SYMATTR InstName U16
SYMBOL Transforms 1488 432 R0
SYMATTR SpiceModel dq0/abc
SYMATTR InstName U19
SYMBOL Transforms 528 640 R0
SYMATTR SpiceModel abc/dq0
SYMATTR InstName U20
SYMBOL Transforms 528 928 R0
SYMATTR SpiceModel abc/dq0
SYMATTR InstName U23
SYMBOL Transforms 1488 928 R0
SYMATTR SpiceModel dq0/abc
SYMATTR InstName U24
SYMBOL Math2r 880 432 R0
SYMATTR InstName U25
SYMBOL Math2r 880 640 R0
SYMATTR InstName U26
SYMBOL Math2r 1136 384 R0
SYMATTR SpiceModel +
SYMATTR InstName U27
SYMBOL Math2r 1072 432 R0
SYMATTR SpiceModel +
SYMATTR InstName U28
SYMBOL Math2r 1712 368 R0
SYMATTR SpiceModel x
SYMATTR InstName U29
SYMBOL Math2r 1712 432 R0
SYMATTR SpiceModel x
SYMATTR InstName U30
SYMBOL Math2r 1712 496 R0
SYMATTR SpiceModel x
SYMATTR InstName U31
SYMBOL Math2r 880 928 R0
SYMATTR InstName U32
SYMBOL Math2r 1712 864 R0
SYMATTR SpiceModel x
SYMATTR InstName U33
SYMBOL Math2r 1712 928 R0
SYMATTR SpiceModel x
SYMATTR InstName U34
SYMBOL Math2r 1712 992 R0
SYMATTR SpiceModel x
SYMATTR InstName U35
SYMBOL cap 1312 944 M0
SYMATTR InstName C4
SYMATTR Value 20p
SYMBOL cap 1312 944 R0
SYMATTR InstName C5
SYMATTR Value 10p
SYMBOL cap 1312 448 M0
SYMATTR InstName C6
SYMATTR Value 10p
SYMBOL cap 1312 448 R0
SYMATTR InstName C7
SYMATTR Value 20p
SYMBOL voltage 1584 672 R0
SYMATTR InstName V1
SYMATTR Value pulse 0 1 {start} 1u 1u {stop-start} rser=1 cpar=1u
SYMBOL Math2r 1296 560 R0
SYMATTR SpiceModel +
SYMATTR InstName U37
TEXT 1944 136 Left 2 !.param  f=50\n+  kv=250  ki=25\n+  start=0.305 stop=0.795
TEXT 1944 -32 Left 2 !.tran 1
TEXT 304 864 Left 2 ;.ic v(qvS)=0 v(qiS)=0 v(qiL)=0
TEXT -216 -24 Left 2 ;Grid side, heavyly polluted with\n3rd, 5th, 7th and 9th harmonics.
TEXT 408 -256 Left 4 ;Universal Power Quality Conditioner
TEXT 480 -208 Left 2 ;(based on the synchronous reference frame)
TEXT 600 -8 Left 2 ;Point of common\ncoupling for shunt\nand series active\nfilters.
TEXT 1248 216 Left 2 ;Loads:\n- linear RLC load, Y with neutral\n- nonlinear diode bridge rectifier with RC load
TEXT -216 1072 Left 2 ;PLL generating the\nreference angle.
TEXT 160 552 Left 2 ;Source voltages and currents calculation\nfor the series active filter.
TEXT 160 1064 Left 2 ;Load currents calculation\nfor the parallel active filter.
TEXT 696 1152 Left 2 ;Filtering of harmonics, selection of the non-oscillating\npowers. The filter plays an important role as the whole\nsystem's transient response is affected by it, so not\nonly the filtering part is needed. Therefore, there is a\ncompromise between the filter's order and the corner\nfrequency (and type). Here, the imposed choices of\nno over-shoot, minimal  delays and settling times are\nbalanced with a <1% p-p ripple.\nNote that the filters only work as expected when the\nUPQC is active, else their response is irrelevant.
TEXT 1504 656 Left 2 ;Start/stop control
TEXT 1240 1072 Left 2 ;Inverse transformation matrix for the\ncompensating voltages/currents.
TEXT 3408 920 Right 2 ;The power stage for series\ntransformers and current\ntransformers (here, voltage\nsources, up, and current\nsources, down, since this\nis an idealized case).
TEXT 2872 -8 Left 2 ;Considered as the pinnacle in power-conditioning, with regard to the consumer,\nthe UPQC combines the power of the series and parallel active power filters to\nprovide voltage filtering for the critical loads that need clean waveforms or no dips\nand current harmonics removal.
TEXT 2248 136 Left 2 ;f = frequency\nkv, ki = voltage and current attenuations for sensors\nstart, stop = start and stop times for the UPQC
TEXT 1944 8 Left 2 ;;.opt reltol=5m\n.opt trtol=7
TEXT 2864 264 Left 2 ;Plot these two above and then zoom in on the\nfiltered portion for a better view of the effect.
TEXT 704 552 Left 2 ;For the load voltage:\n4th order, 20Hz Bessel
TEXT 696 768 Left 2 ;For the source current:\na simple 1st order.\n(after the currents have been compensated, the ripple is\nminimal so there's no need to waste space on the DSP)
TEXT 1256 656 Left 2 ;(C4...7 help\nconvergence)
TEXT 1944 80 Left 2 ;.param tripdv=1 tripdt=10n
TEXT 2248 80 Left 2 ;<- uncomment this for higher resolution waveforms
TEXT 696 1064 Left 2 ;For the load current:\n2nd order, 20Hz Bessel
LINE Normal 3440 320 -256 320
LINE Normal 3072 672 1936 672 2
RECTANGLE Normal 128 304 -224 -48 2
RECTANGLE Normal 1216 304 144 -48 2
RECTANGLE Normal 1888 304 1232 -48 2
RECTANGLE Normal 128 1120 -224 784 2
RECTANGLE Normal 672 768 144 336 2
RECTANGLE Normal 672 1120 144 784 2
RECTANGLE Normal 1216 1120 688 336 2
RECTANGLE Normal 128 768 -224 336 2
RECTANGLE Normal 1888 1120 1232 336 2
RECTANGLE Normal 3424 1120 1904 336 1
RECTANGLE Normal 800 288 560 -32 1
