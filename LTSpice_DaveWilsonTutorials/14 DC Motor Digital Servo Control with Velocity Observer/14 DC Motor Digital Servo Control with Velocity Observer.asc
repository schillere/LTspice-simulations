Version 4
SHEET 1 4612 4564
WIRE -3856 928 -3904 928
WIRE -3456 928 -3712 928
WIRE -3024 928 -3296 928
WIRE -2592 960 -3200 960
WIRE -976 960 -1424 960
WIRE 448 992 400 992
WIRE -1424 1008 -1424 960
WIRE -3776 1024 -3776 992
WIRE -3776 1024 -3920 1024
WIRE -3024 1024 -3024 928
WIRE 400 1024 400 992
WIRE 448 1024 448 992
WIRE -3200 1040 -3200 960
WIRE -1680 1072 -1712 1072
WIRE -1504 1072 -1536 1072
WIRE -1312 1072 -1360 1072
WIRE -1168 1072 -1312 1072
WIRE -976 1072 -976 960
WIRE -976 1072 -1008 1072
WIRE -3632 1104 -3712 1104
WIRE -3280 1104 -3488 1104
WIRE -3104 1104 -3136 1104
WIRE -2912 1104 -2944 1104
WIRE -2816 1104 -2912 1104
WIRE -2592 1104 -2592 960
WIRE -2592 1104 -2656 1104
WIRE -1168 1104 -1248 1104
WIRE -2160 1120 -2368 1120
WIRE -1824 1120 -1968 1120
WIRE -2816 1136 -2848 1136
WIRE -1568 1136 -1568 1104
WIRE -1568 1136 -1648 1136
WIRE -1568 1152 -1568 1136
WIRE -3520 1168 -3520 1136
WIRE -3520 1168 -3600 1168
WIRE -3520 1184 -3520 1168
WIRE -2032 1232 -2032 1200
WIRE 400 1264 400 1104
WIRE -2720 1280 -2800 1280
WIRE 352 1280 304 1280
WIRE -3408 1296 -3488 1296
WIRE -3232 1296 -3264 1296
WIRE -3024 1296 -3024 1184
WIRE -3024 1296 -3072 1296
WIRE 304 1296 304 1280
WIRE -2720 1328 -2720 1280
WIRE 352 1328 304 1328
WIRE -2032 1344 -2032 1312
WIRE -5056 1360 -5104 1360
WIRE -3712 1360 -3712 1104
WIRE -3664 1360 -3712 1360
WIRE -2800 1360 -2800 1280
WIRE -1712 1360 -1712 1072
WIRE -1648 1360 -1712 1360
WIRE 112 1424 16 1424
WIRE 304 1424 304 1328
WIRE 304 1424 256 1424
WIRE 400 1424 400 1344
WIRE 592 1424 400 1424
WIRE -2720 1456 -2720 1408
WIRE -2672 1456 -2720 1456
WIRE -2048 1456 -2208 1456
WIRE -1824 1456 -1824 1120
WIRE -1824 1456 -2048 1456
WIRE -2720 1520 -2720 1456
WIRE 400 1520 400 1424
WIRE -2912 1536 -2912 1104
WIRE -2208 1536 -2208 1456
WIRE -1312 1536 -1312 1072
WIRE 304 1536 304 1424
WIRE 352 1536 304 1536
WIRE 192 1584 192 1488
WIRE 352 1584 304 1584
WIRE -5472 1600 -5616 1600
WIRE -5296 1600 -5472 1600
WIRE -5104 1600 -5104 1360
WIRE -5104 1600 -5152 1600
WIRE -5024 1600 -5104 1600
WIRE -4832 1600 -4880 1600
WIRE -4384 1600 -4672 1600
WIRE -4240 1600 -4384 1600
WIRE -4048 1600 -4096 1600
WIRE -3712 1600 -3712 1360
WIRE -3712 1600 -3760 1600
WIRE -3632 1600 -3712 1600
WIRE -3328 1600 -3328 1360
WIRE -3328 1600 -3488 1600
WIRE -3152 1600 -3328 1600
WIRE -2992 1600 -3152 1600
WIRE -2800 1600 -2848 1600
WIRE -2416 1600 -2640 1600
WIRE -2288 1600 -2416 1600
WIRE -2048 1600 -2144 1600
WIRE -1712 1600 -1712 1360
WIRE -1712 1600 -1760 1600
WIRE -1680 1600 -1712 1600
WIRE -1392 1600 -1536 1600
WIRE -1008 1600 -1248 1600
WIRE -512 1600 -848 1600
WIRE -192 1600 -224 1600
WIRE 16 1600 16 1424
WIRE 16 1600 -32 1600
WIRE -5616 1648 -5616 1600
WIRE -4048 1648 -4080 1648
WIRE -2048 1648 -2112 1648
WIRE -512 1648 -544 1648
WIRE 304 1648 304 1584
WIRE -4912 1664 -4912 1632
WIRE -4912 1664 -4992 1664
WIRE -3520 1664 -3520 1632
WIRE -3520 1664 -3600 1664
WIRE -1568 1664 -1568 1632
WIRE -1568 1664 -1648 1664
WIRE -4912 1680 -4912 1664
WIRE -3520 1680 -3520 1664
WIRE -1568 1680 -1568 1664
WIRE 192 1696 192 1664
WIRE 400 1728 400 1600
WIRE -2720 1744 -2720 1680
WIRE -2672 1744 -2720 1744
WIRE -4080 1776 -4080 1648
WIRE -4032 1776 -4080 1776
WIRE -5616 1792 -5616 1728
WIRE -2720 1792 -2720 1744
WIRE -2112 1792 -2112 1648
WIRE -2064 1792 -2112 1792
WIRE -544 1792 -544 1648
WIRE -4080 1840 -4080 1776
WIRE -2112 1840 -2112 1792
WIRE 400 1840 400 1808
WIRE -544 1904 -544 1872
WIRE -2720 1936 -2720 1872
WIRE -4080 1952 -4080 1920
WIRE -2112 1952 -2112 1920
WIRE -4160 2048 -4160 1664
WIRE -1616 2048 -4160 2048
WIRE -1552 2048 -1616 2048
WIRE 608 2128 528 2128
WIRE 208 2272 160 2272
WIRE 528 2272 528 2128
WIRE 528 2272 352 2272
WIRE 576 2272 528 2272
WIRE 848 2272 736 2272
WIRE -3616 2320 -4064 2320
WIRE -2720 2320 -3168 2320
WIRE -1824 2320 -2272 2320
WIRE -1328 2336 -1504 2336
WIRE -1184 2336 -1248 2336
WIRE -1024 2336 -1072 2336
WIRE -816 2336 -880 2336
WIRE -4064 2368 -4064 2320
WIRE -3168 2368 -3168 2320
WIRE -2272 2368 -2272 2320
WIRE -1184 2368 -1184 2336
WIRE 288 2384 288 2336
WIRE -912 2400 -912 2368
WIRE -912 2400 -992 2400
WIRE -912 2416 -912 2400
WIRE -4320 2432 -4352 2432
WIRE -4144 2432 -4176 2432
WIRE -3952 2432 -4000 2432
WIRE -3808 2432 -3952 2432
WIRE -3616 2432 -3616 2320
WIRE -3616 2432 -3648 2432
WIRE -3424 2432 -3456 2432
WIRE -3248 2432 -3280 2432
WIRE -2912 2432 -3104 2432
WIRE -2720 2432 -2720 2320
WIRE -2720 2432 -2752 2432
WIRE -2528 2432 -2560 2432
WIRE -2352 2432 -2384 2432
WIRE -2176 2432 -2208 2432
WIRE -2016 2432 -2176 2432
WIRE -1824 2432 -1824 2320
WIRE -1824 2432 -1856 2432
WIRE -3808 2464 -3888 2464
WIRE -2912 2464 -2992 2464
WIRE -2016 2464 -2096 2464
WIRE -496 2464 -528 2464
WIRE -304 2464 -352 2464
WIRE -128 2464 -160 2464
WIRE 80 2464 16 2464
WIRE 160 2464 160 2272
WIRE 160 2464 80 2464
WIRE 528 2464 160 2464
WIRE -4208 2496 -4208 2464
WIRE -4208 2496 -4288 2496
WIRE -3312 2496 -3312 2464
WIRE -3312 2496 -3392 2496
WIRE -2416 2496 -2416 2464
WIRE -2416 2496 -2496 2496
WIRE -1328 2496 -1456 2496
WIRE -1184 2496 -1184 2448
WIRE -1184 2496 -1248 2496
WIRE -4208 2512 -4208 2496
WIRE -3312 2512 -3312 2496
WIRE -2416 2512 -2416 2496
WIRE -1456 2528 -1456 2496
WIRE -192 2528 -192 2496
WIRE -192 2528 -272 2528
WIRE -192 2544 -192 2528
WIRE -1312 2576 -1312 2544
WIRE 80 2576 80 2464
WIRE 112 2576 80 2576
WIRE 528 2576 256 2576
WIRE -528 2592 -528 2464
WIRE -528 2592 -656 2592
WIRE -448 2592 -528 2592
WIRE -416 2592 -416 2528
WIRE -1360 2608 -1488 2608
WIRE -1264 2608 -1264 2544
WIRE -1264 2608 -1360 2608
WIRE -1072 2608 -1072 2336
WIRE -1072 2608 -1264 2608
WIRE -816 2608 -816 2336
WIRE -3952 2624 -3952 2432
WIRE -48 2640 -48 2528
WIRE 224 2640 224 2608
WIRE 224 2640 144 2640
WIRE 224 2656 224 2640
WIRE -1232 2672 -1296 2672
WIRE -1152 2672 -1232 2672
WIRE -896 2672 -1008 2672
WIRE -656 2672 -656 2592
WIRE -656 2672 -752 2672
WIRE -5568 2688 -5616 2688
WIRE -5216 2688 -5216 1664
WIRE -5216 2688 -5280 2688
WIRE -5136 2688 -5216 2688
WIRE -4896 2688 -4896 2528
WIRE -4896 2688 -4992 2688
WIRE -4736 2688 -4896 2688
WIRE -4544 2688 -4544 2656
WIRE -4544 2688 -4592 2688
WIRE -4448 2688 -4544 2688
WIRE -4352 2688 -4352 2432
WIRE -4352 2688 -4448 2688
WIRE -4320 2688 -4352 2688
WIRE -4032 2688 -4176 2688
WIRE -3840 2688 -3888 2688
WIRE -2176 2688 -2176 2432
WIRE -1888 2688 -2176 2688
WIRE -384 2688 -384 2592
WIRE -288 2688 -384 2688
WIRE -1296 2720 -1296 2672
WIRE -5568 2736 -5600 2736
WIRE -5024 2752 -5024 2720
WIRE -5024 2752 -5104 2752
WIRE -4208 2752 -4208 2720
WIRE -4208 2752 -4288 2752
WIRE -384 2752 -384 2688
WIRE -5024 2768 -5024 2752
WIRE -4208 2768 -4208 2752
WIRE -48 2768 -48 2720
WIRE -4656 2784 -4656 2752
WIRE -864 2784 -912 2784
WIRE -688 2784 -784 2784
WIRE -2560 2816 -2560 2432
WIRE -1744 2816 -2560 2816
WIRE -912 2816 -912 2784
WIRE -5600 2848 -5600 2736
WIRE -5552 2848 -5600 2848
WIRE -1296 2848 -1296 2800
WIRE -3840 2864 -3840 2688
WIRE -384 2880 -384 2832
WIRE -128 2880 -128 2464
WIRE 480 2880 -128 2880
WIRE -5600 2912 -5600 2848
WIRE -1360 2912 -1360 2608
WIRE -1264 2912 -1360 2912
WIRE -1072 2912 -1072 2736
WIRE -1072 2912 -1104 2912
WIRE -4320 2928 -4912 2928
WIRE -4032 2928 -4176 2928
WIRE -3920 2928 -4032 2928
WIRE -3744 2928 -3776 2928
WIRE -3456 2928 -3456 2432
WIRE -3456 2928 -3600 2928
WIRE -3344 2928 -3456 2928
WIRE -2320 2928 -2560 2928
WIRE -2128 2928 -2320 2928
WIRE -1952 2928 -1984 2928
WIRE -1744 2928 -1744 2816
WIRE -1744 2928 -1808 2928
WIRE -4208 2992 -4208 2960
WIRE -4208 2992 -4288 2992
WIRE -3632 2992 -3632 2960
WIRE -3632 2992 -3712 2992
WIRE -1840 2992 -1840 2960
WIRE -1840 2992 -1920 2992
WIRE -4208 3008 -4208 2992
WIRE -3632 3008 -3632 2992
WIRE -1840 3008 -1840 2992
WIRE -5600 3024 -5600 2992
WIRE -2320 3024 -2320 2928
WIRE -2272 3024 -2320 3024
WIRE -2048 3024 -2048 2992
WIRE -2048 3024 -2112 3024
WIRE -2272 3056 -2320 3056
WIRE -2720 3072 -2720 2432
WIRE -4448 3136 -4448 2688
WIRE -4320 3136 -4448 3136
WIRE -3648 3136 -4176 3136
WIRE -2800 3136 -3488 3136
WIRE -2560 3136 -2560 2928
WIRE -2560 3136 -2656 3136
WIRE -1616 3136 -1616 2048
WIRE -1616 3136 -2560 3136
WIRE -3648 3168 -3728 3168
WIRE -4208 3200 -4208 3168
WIRE -4208 3200 -4288 3200
WIRE -4208 3216 -4208 3200
FLAG -1504 2336 PWM
FLAG -656 2592 Torque
FLAG -2416 1600 I_command
FLAG -1568 1152 0
FLAG -1568 1680 0
FLAG -2112 1952 0
FLAG -2064 1792 Clk2
FLAG -2368 1120 current
FLAG -1248 1104 Clk2
FLAG -2032 1344 0
FLAG -1648 1360 Current_Error
FLAG -5616 2688 Counts
FLAG -2048 1456 i_sampled
FLAG -4384 1600 Speed_command
FLAG -4912 1680 0
FLAG -5056 1360 Position_Error
FLAG -5616 1792 0
FLAG -5472 1600 Position_Command
FLAG -4544 2656 error_vo
FLAG -4208 2512 0
FLAG -4208 2768 0
FLAG -3888 2464 Clk0
FLAG -4912 2928 i_sampled
FLAG -4208 3008 0
FLAG -3632 3008 0
FLAG -3312 2512 0
FLAG -2992 2464 Clk0
FLAG -4208 3216 0
FLAG -2320 3056 Clk0
FLAG -1840 3008 0
FLAG -2416 2512 0
FLAG -2096 2464 Clk0
FLAG -1888 2688 Pos_vo
FLAG -1552 2048 Speed^
FLAG -5024 2768 0
FLAG -4896 2528 Pos_encoder
FLAG -4656 2784 Pos_vo
FLAG -5600 3024 0
FLAG -5552 2848 Clk0
FLAG -4032 2928 Torque^
FLAG -3344 2928 Acceleration^
FLAG 592 1424 PWM
FLAG -3728 3168 Clk0
FLAG 192 1696 0
FLAG 304 1648 0
FLAG 304 1296 0
FLAG 400 1840 0
FLAG 448 1024 0
FLAG -544 1904 0
FLAG -2800 1360 0
FLAG -2720 1936 0
FLAG -3520 1184 0
FLAG -3520 1680 0
FLAG -4080 1952 0
FLAG -4032 1776 Clk1
FLAG -2848 1136 Clk1
FLAG -3664 1360 Speed_Error
FLAG -3152 1600 P_signal
FLAG -3920 1024 P_signal
FLAG -2672 1456 Max_Limit
FLAG -3904 928 Max_Limit
FLAG -2672 1744 Min_Limit
FLAG -3488 1296 Min_Limit
FLAG -1296 2848 0
FLAG -912 2416 0
FLAG -1312 2576 0
FLAG -1232 2672 Tem
FLAG -1456 2528 0
FLAG -1488 2608 Speed
FLAG -688 2784 current
FLAG -912 2816 0
FLAG 528 2464 Speed
FLAG -48 2768 0
FLAG -384 2880 0
FLAG -288 2688 Load
FLAG 528 2576 RPM
FLAG 224 2656 0
FLAG -192 2544 0
FLAG 288 2384 0
FLAG 608 2128 Position
FLAG 848 2272 Counts
FLAG 480 2880 Acceleration
SYMBOL Subtractor -2208 1600 M180
SYMATTR InstName X20
SYMBOL Adder -1312 1600 M180
SYMATTR InstName X26
SYMBOL Gain -1632 1040 R0
WINDOW 3 -60 -46 Left 2
SYMATTR Value {I_current/Fs_current}
SYMATTR InstName E11
SYMBOL Gain -1632 1568 R0
WINDOW 3 -34 -45 Left 2
SYMATTR Value {P_current}
SYMATTR InstName E12
SYMBOL voltage -2112 1824 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 61 52 Left 2
SYMATTR Value PULSE(-1 1 10uS 0 0 {T_aperture} {1/Fs_current} 100000)
SYMATTR InstName V3
SYMBOL Delay -1088 1072 R0
SYMATTR InstName X3
SYMBOL Adder -1424 1072 M180
SYMATTR InstName X4
SYMBOL S&H -1904 1600 R0
SYMATTR InstName X5
SYMBOL voltage -2032 1216 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -408 165 Left 2
SYMATTR Value PULSE(-1 1 {20uS + p/2 - T_aperture} 0 0 {T_aperture} {p} 100000)
SYMATTR InstName V4
SYMBOL Subtractor -5216 1600 R0
SYMATTR InstName X2
SYMBOL Subtractor -4656 2688 R0
SYMATTR InstName X30
SYMBOL Adder -3952 2688 M180
SYMATTR InstName X31
SYMBOL Gain -4272 2400 R0
WINDOW 3 -60 -46 Left 2
SYMATTR Value {I_vo/Fs_speed}
SYMATTR InstName E6
SYMBOL Gain -4272 2656 R0
WINDOW 3 -34 -45 Left 2
SYMATTR Value {P_vo}
SYMATTR InstName E9
SYMBOL Delay -3728 2432 R0
SYMATTR InstName X33
SYMBOL Adder -4064 2432 M180
SYMATTR InstName X34
SYMBOL Adder -3840 2928 M180
SYMATTR InstName X32
SYMBOL Gain -4272 2896 R0
WINDOW 3 -23 32 Left 2
SYMATTR Value {Kt_est}
SYMATTR InstName E10
SYMBOL Gain -3696 2896 R0
WINDOW 3 -43 -42 Left 2
SYMATTR Value {1/Jt_est}
SYMATTR InstName E13
SYMBOL Gain -3376 2400 R0
WINDOW 3 -60 -46 Left 2
SYMATTR Value {1/Fs_speed}
SYMATTR InstName E14
SYMBOL Delay -2832 2432 R0
SYMATTR InstName X35
SYMBOL Adder -3168 2432 M180
SYMATTR InstName X36
SYMBOL Gain -4272 3104 R0
WINDOW 3 -30 -39 Left 2
SYMATTR Value {B_vo/Jt_est}
SYMATTR InstName E15
SYMBOL Delay -2192 3024 R0
SYMATTR InstName X39
SYMBOL Adder -2048 2928 R0
SYMATTR InstName X40
SYMBOL Gain -1904 2896 R0
WINDOW 3 -10 32 Left 2
SYMATTR Value 0.5
SYMATTR InstName E16
SYMBOL Gain -2480 2400 R0
WINDOW 3 -60 -46 Left 2
SYMATTR Value {1/Fs_speed}
SYMATTR InstName E17
SYMBOL Delay -1936 2432 R0
SYMATTR InstName X41
SYMBOL Adder -2272 2432 M180
SYMATTR InstName X42
SYMBOL Gain -5088 2656 R0
WINDOW 3 -38 -63 Left 2
SYMATTR Value {2*pi/quadcounts}
SYMATTR InstName E18
SYMBOL Adder -2720 3136 M180
SYMATTR InstName X37
SYMBOL voltage -5600 2896 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 37 101 Left 2
SYMATTR Value PULSE(-1 1 0 0 0 {T_aperture} {1/Fs_pos} 100000)
SYMATTR InstName V14
SYMBOL S&H -5424 2688 R0
SYMATTR InstName X38
SYMBOL Gain -4976 1568 R0
WINDOW 3 -81 -53 Left 2
SYMATTR Value {P_pos/quadcounts}
SYMATTR InstName E1
SYMBOL voltage -5616 1632 R0
WINDOW 3 -188 200 Invisible 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value PWL(0 0 0.00499999 0 0.005 {quadcounts})
SYMATTR InstName V7
SYMBOL ADC -2064 1120 R0
WINDOW 39 -123 -72 Left 2
SYMATTR SpiceLine Range={2.2*I_limit}, bits=10
SYMATTR InstName X11
SYMBOL Clamp1 -4752 1600 R0
WINDOW 39 -80 90 Left 2
SYMATTR SpiceLine max={Speed_limit}, min={-Speed_limit}
SYMATTR InstName X43
SYMBOL Clamp1 -928 1600 R0
WINDOW 39 -96 85 Left 2
SYMATTR SpiceLine max=25, min=-25
SYMATTR InstName X10
SYMBOL Delay -3568 3136 R0
SYMATTR InstName X29
SYMBOL Subtractor 192 1424 R0
SYMATTR InstName X44
SYMBOL voltage 192 1568 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -374 206 Left 2
SYMATTR Value PULSE(-24 24 20uS {p/2} {p/2} 0 {p} 100000)
SYMATTR InstName V1
SYMBOL sw 400 1248 R0
WINDOW 3 13 103 Left 2
SYMATTR Value VCS
SYMATTR InstName S3
SYMBOL sw 400 1504 R0
WINDOW 3 13 103 Left 2
SYMATTR Value VCS
SYMATTR InstName S4
SYMBOL voltage 400 1120 R180
WINDOW 0 24 104 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value 24
SYMBOL voltage 400 1824 R180
WINDOW 0 24 104 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V5
SYMATTR Value 24
SYMBOL S&H -368 1600 R0
SYMATTR InstName X45
SYMBOL voltage -544 1776 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 29 103 Left 2
SYMATTR Value PULSE(-1 1 {20uS + p - T_aperture/2} 0 0 {T_aperture} {p} 100000)
SYMATTR InstName V6
SYMBOL Quantize -112 1600 R0
WINDOW 39 -91 106 Left 2
SYMATTR SpiceLine Range=50, levels=760
SYMATTR InstName X46
SYMBOL Subtractor -4160 1600 R0
SYMATTR InstName X6
SYMBOL voltage -2720 1776 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V8
SYMATTR Value {-I_limit}
SYMBOL Clamp -2720 1600 R0
SYMATTR InstName X7
SYMBOL Adder -2912 1600 M180
SYMATTR InstName X12
SYMBOL Gain -3584 1072 R0
WINDOW 3 -74 -46 Left 2
SYMATTR Value {I_speed/Fs_speed}
SYMATTR InstName E19
SYMBOL Gain -3584 1568 R0
WINDOW 3 -36 -57 Left 2
SYMATTR Value {P_speed}
SYMATTR InstName E20
SYMBOL Subtractor -3776 928 R0
SYMATTR InstName X47
SYMBOL Subtractor -3328 1296 R0
SYMATTR InstName X48
SYMBOL Delay -2736 1104 R0
SYMATTR InstName X49
SYMBOL Adder -3200 1104 M180
SYMATTR InstName X50
SYMBOL S&H -3904 1600 R0
SYMATTR InstName X51
SYMBOL Clamp -3024 1104 R0
SYMATTR InstName X52
SYMBOL Clamp1 -3376 928 R0
WINDOW 39 -49 85 Left 2
SYMATTR SpiceLine max=1e8, min=0
SYMATTR InstName X53
SYMBOL Clamp1 -3152 1296 R0
WINDOW 39 -49 85 Left 2
SYMATTR SpiceLine max=0, min=-1e8
SYMATTR InstName X54
SYMBOL voltage -2720 1424 R180
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -123 99 Left 2
SYMATTR Value {I_limit}
SYMATTR InstName V9
SYMBOL voltage -4080 1824 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 49 92 Left 2
SYMATTR Value PULSE(-1 1 {2*T_aperture} 0 0 {T_aperture} {1/Fs_speed} 100000)
SYMATTR InstName V10
SYMBOL res -1200 2352 R0
SYMATTR InstName R2
SYMATTR Value {Rt}
SYMBOL ind -1344 2352 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value {L}
SYMBOL bv -1296 2704 R0
WINDOW 3 44 57 Left 2
SYMATTR Value V=I(L1)*Kt
SYMATTR InstName B3
SYMBOL e -1232 2496 M270
SYMATTR InstName E2
SYMATTR Value {Kemf}
SYMBOL Subtractor -1072 2672 R0
SYMATTR InstName X14
SYMBOL Subtractor -816 2672 M180
SYMATTR InstName X16
SYMBOL Clamp1 -1184 2912 R0
WINDOW 39 -93 83 Left 2
SYMATTR SpiceLine max={Kf}, min={-Kf}
SYMATTR InstName X21
SYMBOL Gain -976 2304 R0
WINDOW 3 -15 32 Left 2
SYMATTR Value {Kd}
SYMATTR InstName E5
SYMBOL bv -768 2784 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName B4
SYMATTR Value V=I(L1)
SYMBOL Subtractor -416 2464 R0
SYMATTR InstName X8
SYMBOL Integrator -48 2464 R0
SYMATTR InstName X9
SYMBOL voltage -48 2624 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V15
SYMATTR Value 0
SYMBOL Jumper -416 2608 M0
SYMATTR InstName X15
SYMBOL Gain 160 2544 R0
WINDOW 3 -27 31 Left 2
SYMATTR Value {30/pi}
SYMATTR InstName E3
SYMBOL Gain -256 2432 R0
WINDOW 3 -66 -34 Left 2
SYMATTR Value {1/(Jmotor + Jload)}
SYMATTR InstName E4
SYMBOL Integrator 288 2272 R0
SYMATTR InstName X22
SYMBOL Encoder 656 2272 R0
WINDOW 39 -135 84 Left 2
SYMATTR SpiceLine quadcounts = {quadcounts}, SWE = 5
SYMATTR InstName X23
SYMBOL voltage -384 2736 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V12
SYMATTR Value PWL(0 0 0.0999999 0 0.1 0.6)
TEXT -4512 296 Left 2 !.tran 0 0.150 0 uic
TEXT -3568 648 Left 2 ;D C   M O T O R   S E R V O   C O N T R O L L E R
TEXT -4512 624 Left 2 !.param Jload = 100E-6
TEXT -4192 624 Left 2 ;Kilograms-Meter^2
TEXT -5416 144 Left 2 !.param I_limit = 15
TEXT -5416 304 Left 2 !.param I_current = 2000
TEXT -5416 272 Left 2 !.param P_current = 10
TEXT -5416 240 Left 2 !.param I_speed = 50
TEXT -5416 208 Left 2 !.param P_speed  = 0.5
TEXT -2288 824 Left 2 ;CURRENT REGULATOR
TEXT -5416 432 Left 2 !.param Fs_speed = 2E3
TEXT -5416 528 Left 2 !.param T_aperture = 100E-9
TEXT -5416 496 Left 2 !.param Fs_current = 10E3
TEXT -5416 656 Left 2 !.model VCS SW(Ron=0.00001 Roff=1T Vt=0)
TEXT -5416 560 Left 2 !.param p = 50uS
TEXT -1984 1272 Left 2 ;ADC Trigger
TEXT -1736 888 Left 2 ;INTEGRATOR
TEXT -4512 400 Left 2 !.param Kt = 0.071
TEXT -4512 592 Left 2 !.param Jmotor = 37E-6
TEXT -4512 432 Left 2 !.param Kemf = 0.071
TEXT -4192 400 Left 2 ;Newton-Meters/Amp
TEXT -4192 432 Left 2 ;Volts/(radian/sec)
TEXT -4512 464 Left 2 !.param Kf = 0.014
TEXT -4192 464 Left 2 ;Newton-Meters
TEXT -4512 496 Left 2 !.param Kd = 13E-6
TEXT -4192 496 Left 2 ;Newton-Meters/(radian/sec)
TEXT -4512 528 Left 2 !.param Rt = 0.84
TEXT -4512 560 Left 2 !.param L = 1.36E-3
TEXT -4192 592 Left 2 ;Kilograms-Meter^2
TEXT -4192 560 Left 2 ;Henries
TEXT -4192 528 Left 2 ;Ohms
TEXT -5416 464 Left 2 !.param Fs_pos = 2E3
TEXT -5416 112 Left 2 !.param Speed_limit = 300
TEXT -4456 1624 Left 2 ;Radians/sec
TEXT -5304 816 Left 2 ;POSITION REGULATOR
TEXT -4512 328 Left 2 !.options method = gear
TEXT -4376 2248 Left 2 ;INTEGRATOR
TEXT -3480 2248 Left 2 ;INTEGRATOR
TEXT -2584 2248 Left 2 ;INTEGRATOR
TEXT -4768 2152 Left 2 ;VELOCITY OBSERVER
TEXT -5416 336 Left 2 !.param P_vo =10
TEXT -5416 368 Left 2 !.param I_vo = 20
TEXT -4792 408 Left 2 !.param Kt_est = 0.071
TEXT -4792 504 Left 2 !.param Kd_est = 13E-6
TEXT -4792 624 Left 2 !.param Jt_est = 137E-6
TEXT -5416 400 Left 2 !.param B_vo =0.035
TEXT -5416 592 Left 2 !.param quadcounts = 2000
TEXT -5416 176 Left 2 !.param P_pos = 400
TEXT -552 840 Left 2 ;MODULATION
TEXT 32 1664 Left 2 ;PWM Carrier
TEXT -472 1512 Left 2 ;PWM Module Reload
TEXT -4240 816 Left 2 ;SPEED REGULATOR
TEXT -1416 2192 Left 2 ;Motor Model (Pittman DC Servo Motor\nModel 14206 with 24V Winding)
TEXT -1064 2872 Left 2 ;Friction\nMotor Bearings and Brushes
TEXT -792 2376 VRight 2 ;Damping Losses
TEXT -560 2192 Left 2 ;LOAD
TEXT -472 2616 Left 2 ;lock\nrotor
TEXT -368 2616 Left 2 ;load\ntorque
TEXT -552 2912 Left 2 ;To put motor on a dyno, set jumper to "lock rotor"\nand then use the "Speed Override" voltage source\nto specify dyno speed.
TEXT -16 2696 Left 2 ;Speed Override
TEXT 400 2240 Left 2 ;Radians
TEXT 392 2432 Left 2 ;Radians/sec
TEXT -5616 3120 Left 2 ;D A V E    W I L S O N\nK A P P A   E L E C T R O N I C S   L L C\ndave@kappaiq.com\nwww.kappaiq.com
RECTANGLE Normal -656 1984 -2320 784
RECTANGLE Normal -896 1200 -1760 848 2
RECTANGLE Normal -4544 1984 -5328 784
RECTANGLE Normal -3536 2560 -4400 2208 2
RECTANGLE Normal -2640 2560 -3504 2208 2
RECTANGLE Normal -1744 2560 -2608 2208 2
RECTANGLE Normal -1696 3312 -4800 2112
RECTANGLE Normal 544 1984 -608 792
RECTANGLE Normal -2528 1968 -4272 784
RECTANGLE Normal -720 3024 -1432 2160
RECTANGLE Normal 384 3024 -568 2168
