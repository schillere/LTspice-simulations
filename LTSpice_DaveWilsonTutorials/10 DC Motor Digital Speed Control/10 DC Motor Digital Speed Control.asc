Version 4
SHEET 1 4612 3492
WIRE -3376 848 -3424 848
WIRE -2976 848 -3232 848
WIRE -2544 848 -2816 848
WIRE -2112 880 -2720 880
WIRE -512 880 -960 880
WIRE -960 928 -960 880
WIRE -3296 944 -3296 912
WIRE -3296 944 -3440 944
WIRE -2544 944 -2544 848
WIRE -2720 960 -2720 880
WIRE -1216 992 -1248 992
WIRE -1040 992 -1072 992
WIRE -848 992 -896 992
WIRE -704 992 -848 992
WIRE -512 992 -512 880
WIRE -512 992 -544 992
WIRE -3152 1024 -3232 1024
WIRE -2800 1024 -3008 1024
WIRE -2624 1024 -2656 1024
WIRE -2432 1024 -2464 1024
WIRE -2336 1024 -2432 1024
WIRE -2112 1024 -2112 880
WIRE -2112 1024 -2176 1024
WIRE -704 1024 -784 1024
WIRE -1696 1040 -1904 1040
WIRE -1360 1040 -1504 1040
WIRE -2336 1056 -2368 1056
WIRE -1104 1056 -1104 1024
WIRE -1104 1056 -1184 1056
WIRE -1104 1072 -1104 1056
WIRE -3040 1088 -3040 1056
WIRE -3040 1088 -3120 1088
WIRE -3040 1104 -3040 1088
WIRE -1568 1152 -1568 1120
WIRE -2240 1200 -2320 1200
WIRE -2928 1216 -3008 1216
WIRE -2752 1216 -2784 1216
WIRE -2544 1216 -2544 1104
WIRE -2544 1216 -2592 1216
WIRE -2240 1248 -2240 1200
WIRE -1568 1264 -1568 1232
WIRE -3232 1280 -3232 1024
WIRE -3184 1280 -3232 1280
WIRE -2320 1280 -2320 1200
WIRE -1248 1280 -1248 992
WIRE -1184 1280 -1248 1280
WIRE -2240 1376 -2240 1328
WIRE -2192 1376 -2240 1376
WIRE -1552 1376 -1744 1376
WIRE -1360 1376 -1360 1040
WIRE -1360 1376 -1552 1376
WIRE -2240 1440 -2240 1376
WIRE -2432 1456 -2432 1024
WIRE -1744 1456 -1744 1376
WIRE -848 1456 -848 992
WIRE -3904 1520 -4016 1520
WIRE -3760 1520 -3904 1520
WIRE -3568 1520 -3616 1520
WIRE -3232 1520 -3232 1280
WIRE -3232 1520 -3280 1520
WIRE -3152 1520 -3232 1520
WIRE -2848 1520 -2848 1280
WIRE -2848 1520 -3008 1520
WIRE -2672 1520 -2848 1520
WIRE -2512 1520 -2672 1520
WIRE -2320 1520 -2368 1520
WIRE -1952 1520 -2160 1520
WIRE -1824 1520 -1952 1520
WIRE -1584 1520 -1680 1520
WIRE -1248 1520 -1248 1280
WIRE -1248 1520 -1296 1520
WIRE -1216 1520 -1248 1520
WIRE -928 1520 -1072 1520
WIRE -752 1520 -784 1520
WIRE -352 1520 -592 1520
WIRE -4016 1568 -4016 1520
WIRE -3568 1568 -3600 1568
WIRE -1584 1568 -1648 1568
WIRE -3040 1584 -3040 1552
WIRE -3040 1584 -3120 1584
WIRE -1104 1584 -1104 1552
WIRE -1104 1584 -1184 1584
WIRE -3040 1600 -3040 1584
WIRE -1104 1600 -1104 1584
WIRE -1648 1648 -1648 1568
WIRE -1600 1648 -1648 1648
WIRE -2240 1664 -2240 1600
WIRE -2192 1664 -2240 1664
WIRE -4016 1696 -4016 1648
WIRE -3600 1696 -3600 1568
WIRE -3552 1696 -3600 1696
WIRE -1648 1696 -1648 1648
WIRE -2240 1712 -2240 1664
WIRE -3600 1760 -3600 1696
WIRE -3680 1792 -3680 1584
WIRE -3680 1792 -3872 1792
WIRE -1648 1808 -1648 1776
WIRE -2240 1856 -2240 1792
WIRE -3600 1872 -3600 1840
WIRE -2720 1968 -2768 1968
WIRE -2768 2000 -2768 1968
WIRE -2720 2000 -2720 1968
WIRE -2400 2112 -2592 2112
WIRE -2256 2112 -2320 2112
WIRE -2096 2112 -2144 2112
WIRE -1888 2112 -1952 2112
WIRE -2768 2144 -2768 2080
WIRE -2256 2144 -2256 2112
WIRE -2816 2160 -2864 2160
WIRE -2864 2176 -2864 2160
WIRE -1984 2176 -1984 2144
WIRE -1984 2176 -2064 2176
WIRE -1984 2192 -1984 2176
WIRE -2816 2208 -2864 2208
WIRE -2400 2272 -2528 2272
WIRE -2256 2272 -2256 2224
WIRE -2256 2272 -2320 2272
WIRE -1696 2272 -1760 2272
WIRE -1552 2272 -1696 2272
WIRE -1520 2272 -1552 2272
WIRE -1328 2272 -1376 2272
WIRE -1152 2272 -1184 2272
WIRE -944 2272 -1008 2272
WIRE -752 2272 -944 2272
WIRE -3056 2304 -3152 2304
WIRE -2864 2304 -2864 2208
WIRE -2864 2304 -2912 2304
WIRE -2768 2304 -2768 2224
WIRE -2592 2304 -2592 2112
WIRE -2592 2304 -2768 2304
WIRE -2528 2304 -2528 2272
WIRE -1216 2336 -1216 2304
WIRE -1216 2336 -1296 2336
WIRE -2384 2352 -2384 2320
WIRE -1216 2352 -1216 2336
WIRE -2432 2384 -2560 2384
WIRE -2336 2384 -2336 2320
WIRE -2336 2384 -2432 2384
WIRE -2144 2384 -2144 2112
WIRE -2144 2384 -2336 2384
WIRE -1888 2384 -1888 2112
WIRE -944 2384 -944 2272
WIRE -912 2384 -944 2384
WIRE -704 2384 -768 2384
WIRE -2768 2400 -2768 2304
WIRE -1552 2400 -1552 2272
WIRE -1472 2400 -1552 2400
WIRE -1440 2400 -1440 2336
WIRE -2864 2416 -2864 2304
WIRE -2816 2416 -2864 2416
WIRE -2304 2448 -2368 2448
WIRE -2224 2448 -2304 2448
WIRE -1968 2448 -2080 2448
WIRE -1760 2448 -1760 2272
WIRE -1760 2448 -1824 2448
WIRE -1072 2448 -1072 2336
WIRE -800 2448 -800 2416
WIRE -800 2448 -880 2448
WIRE -2976 2464 -2976 2368
WIRE -2816 2464 -2864 2464
WIRE -800 2464 -800 2448
WIRE -3680 2480 -3856 2480
WIRE -3360 2480 -3392 2480
WIRE -3152 2480 -3152 2304
WIRE -3152 2480 -3200 2480
WIRE -2368 2496 -2368 2448
WIRE -1408 2496 -1408 2400
WIRE -1312 2496 -1408 2496
WIRE -3680 2528 -3712 2528
WIRE -2864 2528 -2864 2464
WIRE -2768 2560 -2768 2480
WIRE -1936 2560 -1984 2560
WIRE -1760 2560 -1856 2560
WIRE -1408 2560 -1408 2496
WIRE -2976 2576 -2976 2544
WIRE -1072 2576 -1072 2528
WIRE -1984 2592 -1984 2560
WIRE -3712 2608 -3712 2528
WIRE -2368 2624 -2368 2576
WIRE -2768 2672 -2768 2640
WIRE -2432 2688 -2432 2384
WIRE -2336 2688 -2432 2688
WIRE -2144 2688 -2144 2512
WIRE -2144 2688 -2176 2688
WIRE -1408 2688 -1408 2640
WIRE -3712 2720 -3712 2688
FLAG -1696 2272 Torque
FLAG -752 2272 Speed
FLAG -1072 2576 0
FLAG -1408 2688 0
FLAG -1312 2496 Load
FLAG -704 2384 RPM
FLAG -4016 1696 0
FLAG -3872 1792 Speed
FLAG -1952 1520 I_command
FLAG -2320 1280 0
FLAG -2240 1856 0
FLAG -1104 1072 0
FLAG -1104 1600 0
FLAG -3040 1104 0
FLAG -3040 1600 0
FLAG -3904 1520 Speed_command
FLAG -3600 1872 0
FLAG -3552 1696 Clk1
FLAG -1648 1808 0
FLAG -1600 1648 Clk2
FLAG -2976 2576 0
FLAG -2864 2528 0
FLAG -2864 2176 0
FLAG -2768 2672 0
FLAG -2720 2000 0
FLAG -1904 1040 current
FLAG -2368 1056 Clk1
FLAG -784 1024 Clk2
FLAG -3712 2720 0
FLAG -1568 1264 0
FLAG -3184 1280 Speed_Error
FLAG -1184 1280 Current_Error
FLAG -1552 1376 I_sampled
FLAG -2368 2624 0
FLAG -1984 2192 0
FLAG -2384 2352 0
FLAG -2304 2448 Tem
FLAG -2528 2304 0
FLAG -2560 2384 Speed
FLAG -1760 2560 current
FLAG -1984 2592 0
FLAG -800 2464 0
FLAG -1216 2352 0
FLAG -352 1520 PWM_Value
FLAG -3856 2480 PWM_Value
FLAG -2672 1520 P_signal
FLAG -3440 944 P_signal
FLAG -2192 1376 Max_Limit
FLAG -3424 848 Max_Limit
FLAG -2192 1664 Min_Limit
FLAG -3008 1216 Min_Limit
SYMBOL Subtractor -1440 2272 R0
SYMATTR InstName X17
SYMBOL Integrator -1072 2272 R0
SYMATTR InstName X18
SYMBOL voltage -1408 2544 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V12
SYMATTR Value PWL(0 0 0.0199999 0 0.02 0.5)
SYMBOL voltage -1072 2432 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V13
SYMATTR Value 0
SYMBOL Jumper -1440 2416 M0
SYMATTR InstName X19
SYMBOL Subtractor -1744 1520 M180
SYMATTR InstName X20
SYMBOL Adder -848 1520 M180
SYMATTR InstName X26
SYMBOL Subtractor -3680 1520 R0
SYMATTR InstName X27
SYMBOL voltage -4016 1552 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -234 186 Invisible 2
SYMATTR Value PWL(0 0 0.0499999 0 0.05 120 0.1199999 120 0.12 -60)
SYMATTR InstName V14
SYMBOL voltage -2240 1696 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V16
SYMATTR Value {-I_limit}
SYMBOL Clamp -2240 1520 R0
SYMATTR InstName X28
SYMBOL Gain -1168 960 R0
WINDOW 3 -60 -46 Left 2
SYMATTR Value {I_current/Fs_current}
SYMATTR InstName E11
SYMBOL Gain -1168 1488 R0
WINDOW 3 -34 -45 Left 2
SYMATTR Value {P_current}
SYMATTR InstName E12
SYMBOL Adder -2432 1520 M180
SYMATTR InstName X30
SYMBOL Gain -3104 992 R0
WINDOW 3 -74 -46 Left 2
SYMATTR Value {I_speed/Fs_speed}
SYMATTR InstName E15
SYMBOL Gain -3104 1488 R0
WINDOW 3 -36 -57 Left 2
SYMATTR Value {P_speed}
SYMATTR InstName E16
SYMBOL Subtractor -3296 848 R0
SYMATTR InstName X32
SYMBOL Subtractor -2848 1216 R0
SYMATTR InstName X33
SYMBOL voltage -3600 1744 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 55 83 Left 2
SYMATTR Value PULSE(-1 1 0 0 0 {T_aperture} {1/Fs_speed} 100000)
SYMATTR InstName V1
SYMBOL voltage -1648 1680 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 49 101 Left 2
SYMATTR Value PULSE(-1 1 10uS 0 0 {T_aperture} {1/Fs_current} 100000)
SYMATTR InstName V3
SYMBOL Subtractor -2976 2304 R0
SYMATTR InstName X7
SYMBOL voltage -2976 2448 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -408 191 Left 2
SYMATTR Value PULSE(-24 24 20uS {p/2} {p/2} 0 {p} 100000)
SYMATTR InstName V8
SYMBOL sw -2768 2128 R0
WINDOW 3 13 103 Left 2
SYMATTR Value VCS
SYMATTR InstName S1
SYMBOL sw -2768 2384 R0
WINDOW 3 13 103 Left 2
SYMATTR Value VCS
SYMATTR InstName S2
SYMBOL voltage -2768 2096 R180
WINDOW 0 24 104 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V9
SYMATTR Value 24
SYMBOL voltage -2768 2656 R180
WINDOW 0 24 104 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V10
SYMATTR Value 24
SYMBOL Delay -2256 1024 R0
SYMATTR InstName X10
SYMBOL Adder -2720 1024 M180
SYMATTR InstName X11
SYMBOL S&H -3424 1520 R0
SYMATTR InstName X2
SYMBOL Clamp -2544 1024 R0
SYMATTR InstName X1
SYMBOL Delay -624 992 R0
SYMATTR InstName X3
SYMBOL Adder -960 992 M180
SYMATTR InstName X4
SYMBOL S&H -1440 1520 R0
SYMATTR InstName X5
SYMBOL S&H -3536 2480 R0
SYMATTR InstName X6
SYMBOL voltage -3712 2592 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -29 170 Left 2
SYMATTR Value PULSE(-1 1 {20uS + p - T_aperture/2} 0 0 {T_aperture} {p} 100000)
SYMATTR InstName V2
SYMBOL voltage -1568 1136 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -419 174 Invisible 2
SYMATTR Value PULSE(-1 1 {20uS + p/2 - T_aperture} 0 0 {T_aperture} {p} 100000)
SYMATTR InstName V4
SYMBOL ADC -1600 1040 R0
WINDOW 39 -73 -72 Left 2
SYMATTR SpiceLine Range={2.2*I_limit}, bits=10
SYMATTR InstName X12
SYMBOL Quantize -3280 2480 R0
WINDOW 39 -91 97 Left 2
SYMATTR SpiceLine Range=50, levels=760
SYMATTR InstName X13
SYMBOL Clamp1 -672 1520 R0
WINDOW 39 -49 85 Left 2
SYMATTR SpiceLine max=25, min=-25
SYMATTR InstName X15
SYMBOL Clamp1 -2896 848 R0
WINDOW 39 -49 85 Left 2
SYMATTR SpiceLine max=1e8, min=0
SYMATTR InstName X16
SYMBOL Clamp1 -2672 1216 R0
WINDOW 39 -49 85 Left 2
SYMATTR SpiceLine max=0, min=-1e8
SYMATTR InstName X21
SYMBOL res -2272 2128 R0
SYMATTR InstName R1
SYMATTR Value {Rt}
SYMBOL ind -2416 2128 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L2
SYMATTR Value {L}
SYMBOL bv -2368 2480 R0
WINDOW 3 44 57 Left 2
SYMATTR Value V=I(L2)*Kt
SYMATTR InstName B2
SYMBOL e -2304 2272 M270
SYMATTR InstName E1
SYMATTR Value {Kemf}
SYMBOL Subtractor -2144 2448 R0
SYMATTR InstName X22
SYMBOL Subtractor -1888 2448 M180
SYMATTR InstName X23
SYMBOL Clamp1 -2256 2688 R0
WINDOW 39 -93 83 Left 2
SYMATTR SpiceLine max={Kf}, min={-Kf}
SYMATTR InstName X24
SYMBOL Gain -2048 2080 R0
WINDOW 3 -15 32 Left 2
SYMATTR Value {Kd}
SYMATTR InstName E2
SYMBOL bv -1840 2560 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName B4
SYMATTR Value V=I(L2)
SYMBOL Gain -864 2352 R0
WINDOW 3 -27 31 Left 2
SYMATTR Value {30/pi}
SYMATTR InstName E3
SYMBOL Gain -1280 2240 R0
WINDOW 3 -66 -34 Left 2
SYMATTR Value {1/(Jmotor + Jload)}
SYMATTR InstName E4
SYMBOL voltage -2240 1344 R180
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -123 99 Left 2
SYMATTR Value {I_limit}
SYMATTR InstName V5
TEXT -600 1992 Left 2 !.tran 0 0.175 0 uic
TEXT -2048 656 Left 2 ;D C    M O T O R    S P E E D    C O N T R O L L E R
TEXT -600 2328 Left 2 !.param Jload = 200E-6
TEXT -328 2328 Left 2 ;Kilograms-Meter^2
TEXT -600 2360 Left 2 !.param I_limit = 15
TEXT -600 2488 Left 2 !.param I_current = 2000
TEXT -600 2456 Left 2 !.param P_current = 20
TEXT -600 2424 Left 2 !.param I_speed = 1500
TEXT -600 2392 Left 2 !.param P_speed  = 3
TEXT -1616 1960 Left 2 ;LOAD
TEXT -768 2304 Left 2 ;Radians/sec
TEXT -1496 2424 Left 2 ;lock\nrotor
TEXT -1392 2424 Left 2 ;load\ntorque
TEXT -1576 2720 Left 2 ;To put motor on a dyno, set jumper to "lock rotor"\nand then use the "Speed Override" voltage source\nto specify dyno speed.
TEXT -3760 736 Left 2 ;SPEED REGULATOR
TEXT -1824 744 Left 2 ;CURRENT REGULATOR
TEXT -600 2520 Left 2 !.param Fs_speed = 2E3
TEXT -600 2584 Left 2 !.param T_aperture = 0.25E-6
TEXT -600 2552 Left 2 !.param Fs_current = 10E3
TEXT -600 2696 Left 2 !.model VCS SW(Ron=0.00001 Roff=1T Vt=0)
TEXT -3472 1968 Left 2 ;MODULATION
TEXT -600 2616 Left 2 !.param p = 50uS
TEXT -1520 1192 Left 2 ;ADC Trigger
TEXT -3136 2544 Left 2 ;PWM Carrier
TEXT -3640 2392 Left 2 ;PWM Module Reload
TEXT -1272 808 Left 2 ;INTEGRATOR
TEXT -3944 1544 Left 2 ;Radians/sec
TEXT -600 2104 Left 2 !.param Kt = 0.071
TEXT -600 2296 Left 2 !.param Jmotor = 37E-6
TEXT -600 2136 Left 2 !.param Kemf = 0.071
TEXT -328 2104 Left 2 ;Newton-Meters/Amp
TEXT -328 2136 Left 2 ;Volts/(radian/sec)
TEXT -600 2168 Left 2 !.param Kf = 0.014
TEXT -328 2168 Left 2 ;Newton-Meters
TEXT -600 2200 Left 2 !.param Kd = 13E-6
TEXT -328 2200 Left 2 ;Newton-Meters/(radian/sec)
TEXT -600 2232 Left 2 !.param Rt = 0.84
TEXT -600 2264 Left 2 !.param L = 1.36E-3
TEXT -328 2296 Left 2 ;Kilograms-Meter^2
TEXT -328 2264 Left 2 ;Henries
TEXT -328 2232 Left 2 ;Ohms
TEXT -600 2024 Left 2 !.options method = gear
TEXT -2488 1968 Left 2 ;Motor Model (Pittman DC Servo Motor\nModel 14206 with 24V Winding)
TEXT -2136 2648 Left 2 ;Friction\nMotor Bearings and Brushes
TEXT -1864 2152 VRight 2 ;Damping Losses
TEXT -1248 2440 Left 2 ;Speed Override
TEXT -3792 2832 Left 2 ;D A V E    W I L S O N\nK A P P A   E L E C T R O N I C S   L L C\ndave@kappaiq.com\nwww.kappaiq.com
RECTANGLE Normal -976 2800 -1624 1936
RECTANGLE Normal -400 1888 -1856 704
RECTANGLE Normal -2048 1888 -3792 704
RECTANGLE Normal -2656 2800 -3792 1936
RECTANGLE Normal -432 1120 -1296 768
RECTANGLE Normal -1792 2800 -2504 1936
