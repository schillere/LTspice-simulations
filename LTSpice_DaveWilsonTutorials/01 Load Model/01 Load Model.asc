Version 4
SHEET 1 7036 2004
WIRE 5584 -1072 4896 -1072
WIRE 5584 -960 5120 -960
WIRE 5120 -848 5120 -960
WIRE 5360 -848 5120 -848
WIRE 5584 -848 5504 -848
WIRE 5472 -784 5472 -816
WIRE 5472 -784 5392 -784
WIRE 5472 -752 5472 -784
WIRE 3184 -672 2848 -672
WIRE 3392 -672 3328 -672
WIRE 3632 -672 3536 -672
WIRE 4352 -672 3776 -672
WIRE 4576 -672 4496 -672
WIRE 4896 -672 4896 -1072
WIRE 4896 -672 4720 -672
WIRE 4928 -672 4896 -672
WIRE 5120 -672 5120 -848
WIRE 5120 -672 5072 -672
WIRE 5152 -672 5120 -672
WIRE 5328 -672 5296 -672
WIRE 5584 -672 5328 -672
WIRE 4688 -608 4688 -640
WIRE 4688 -608 4608 -608
WIRE 4688 -576 4688 -608
WIRE 5008 -576 5008 -608
WIRE 5328 -576 5328 -672
WIRE 5360 -576 5328 -576
WIRE 5584 -576 5504 -576
WIRE 5232 -560 5232 -608
WIRE 5472 -512 5472 -544
WIRE 5472 -512 5392 -512
WIRE 3712 -496 3712 -608
WIRE 3792 -496 3712 -496
WIRE 3888 -496 3792 -496
WIRE 4224 -496 4128 -496
WIRE 4288 -496 4224 -496
WIRE 4432 -496 4432 -608
WIRE 4432 -496 4368 -496
WIRE 2848 -480 2848 -672
WIRE 5472 -480 5472 -512
WIRE 3072 -432 3040 -432
WIRE 3264 -432 3264 -608
WIRE 3264 -432 3232 -432
WIRE 3472 -432 3472 -608
WIRE 3648 -432 3472 -432
WIRE 3712 -400 3712 -496
WIRE 4128 -400 4128 -496
WIRE 4432 -400 4432 -496
WIRE 4224 -384 4224 -496
WIRE 4384 -384 4224 -384
WIRE 2848 -336 2848 -400
WIRE 4384 -336 4352 -336
WIRE 3456 -304 3408 -304
WIRE 3648 -304 3648 -432
WIRE 3648 -304 3600 -304
WIRE 3568 -240 3568 -272
WIRE 3568 -240 3488 -240
WIRE 4352 -240 4352 -336
WIRE 4432 -240 4432 -320
WIRE 4432 -240 4352 -240
WIRE 3568 -192 3568 -240
WIRE 3712 -192 3712 -320
WIRE 4128 -192 4128 -320
WIRE 4432 -192 4432 -240
WIRE 3040 -96 3040 -432
WIRE 3408 -96 3408 -304
WIRE 3408 -96 3040 -96
WIRE 3920 -96 3408 -96
WIRE 5120 -96 5120 -672
WIRE 5120 -96 3920 -96
WIRE 3920 0 3920 -96
WIRE 3792 64 3792 -496
WIRE 3840 64 3792 64
WIRE 5568 64 3984 64
FLAG 3712 -192 0
FLAG 5232 -560 0
FLAG 4688 -576 0
FLAG 5584 -960 speed1
FLAG 5584 -672 angle1
FLAG 5584 -1072 accel
FLAG 3568 -192 0
FLAG 5472 -480 0
FLAG 5584 -576 angle2
FLAG 5008 -576 0
FLAG 4128 -192 0
FLAG 4432 -192 0
FLAG 2848 -336 0
FLAG 5568 64 load_power
FLAG 5472 -752 0
FLAG 5584 -848 speed2
FLAG 3888 -496 Load_Torque
SYMBOL Subtractor 3472 -672 R0
SYMATTR InstName X1
SYMBOL Subtractor 3712 -672 R0
SYMATTR InstName X2
SYMBOL voltage 3712 -416 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -118 299 Left 2
SYMATTR Value PWL(0 {Tload} 1.499999 {Tload} 1.5 {Tload*1.1})
SYMATTR InstName V1
SYMBOL Integrator 5232 -672 R0
SYMATTR InstName X3
SYMBOL Gain 4624 -704 R0
WINDOW 3 -85 -46 Left 2
SYMATTR Value {1/(Jmotor + Jload)}
SYMATTR InstName E2
SYMBOL Gain 3504 -336 R0
WINDOW 3 -12 32 Left 2
SYMATTR Value {Kd}
SYMATTR InstName E3
SYMBOL Gain 5408 -608 R0
WINDOW 3 -29 30 Left 2
SYMATTR Value {180/pi}
SYMATTR InstName E5
SYMBOL Integrator 5008 -672 R0
SYMATTR InstName X4
SYMBOL bv 4128 -416 R0
WINDOW 3 -127 -143 Left 2
SYMATTR Value V={hardness}*(V(angle1)-{limit})
SYMATTR InstName B7
SYMBOL Subtractor 4432 -672 R0
SYMATTR InstName X5
SYMBOL res 4384 -512 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL sw 4432 -416 R0
WINDOW 3 13 103 Left 2
SYMATTR Value VCS
SYMATTR InstName S3
SYMBOL voltage 2848 -496 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value {TMotor}
SYMBOL Subtractor 3264 -672 R0
SYMATTR InstName X6
SYMBOL Multiplier 3920 64 M180
SYMATTR InstName X7
SYMBOL Gain 5408 -880 R0
WINDOW 3 -29 30 Left 2
SYMATTR Value {30/pi}
SYMATTR InstName E1
SYMBOL Clamp1 3152 -432 R0
WINDOW 39 -49 83 Left 2
SYMATTR SpiceLine max={Kf}, min={-Kf}
SYMATTR InstName X8
TEXT 3344 -1296 Left 2 !.tran 0 3 0 uic
TEXT 3344 -1160 Left 2 !.param Jmotor = 30E-6
TEXT 3344 -1192 Left 2 !.param Kd =500E-6
TEXT 3656 -1192 Left 2 ;Viscous Damping Torque (Newton-Meters/(radian/sec))
TEXT 3656 -1160 Left 2 ;Rotational Inertia of motor shaft (Kilograms-Meter^2)
TEXT 3344 -1128 Left 2 !.param Jload = 100E-6
TEXT 3656 -1128 Left 2 ;Rotational Inertia of Motor Load (Kilograms-Meter^2)
TEXT 3344 -920 Left 2 !.model VCS SW(Ron=1E-9 Roff=10T Vt=0)
TEXT 3344 -1032 Left 2 !.param limit = 1E6
TEXT 3656 -1032 Left 2 ;Hard stop position (radians)
TEXT 3344 -1000 Left 2 !.param hardness = 0.1
TEXT 3656 -1000 Left 2 ;Unitless factor which sets stop hardness.
TEXT 3344 -1064 Left 2 !.param Tload = 0.8
TEXT 3656 -1064 Left 2 ;Load torque (Newton-Meters)
TEXT 3480 -560 Left 2 ;Damping Torque
TEXT 3720 -560 Left 2 ;Load Torque
TEXT 5688 -1072 Left 2 ;radians/sec^2
TEXT 5688 -960 Left 2 ;radians/sec
TEXT 5688 -672 Left 2 ;radians
TEXT 5688 -576 Left 2 ;degrees
TEXT 3344 -1096 Left 2 !.param TMotor = 1
TEXT 2856 -696 Left 2 ;Motor Torque
TEXT 3344 -1224 Left 2 !.param Kf = 0.05
TEXT 3656 -1224 Left 2 ;Friction Torque  (Newton-Meters)
TEXT 3272 -560 Left 2 ;Friction Torque
TEXT 4440 -568 Left 2 ;Limit Torque
TEXT 3656 -1096 Left 2 ;Motor Torque (Newton-Meters)
TEXT 5720 64 Left 2 ;watts
TEXT 5688 -848 Left 2 ;RPM
TEXT 3344 -1272 Left 2 !.options method = gear
TEXT 2840 8 Left 2 ;D A V E    W I L S O N\nK A P P A   E L E C T R O N I C S   L L C\ndave@kappaiq.com\nwww.kappaiq.com
